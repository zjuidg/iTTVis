"use strict";!function(window){function registerModule(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)}var applicationModuleName="mean",service={applicationEnvironment:window.env,applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:["ngResource","ngAnimate","ngMessages","ui.router","ui.bootstrap","ngFileUpload","ngImgCrop","ui-notification","pascalprecht.translate"],registerModule:registerModule};window.ApplicationConfiguration=service,angular.module("ui-notification").config(["NotificationProvider",function(NotificationProvider){NotificationProvider.setOptions({delay:2e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"})}])}(window);
"use strict";!function(app){function bootstrapConfig($compileProvider,$locationProvider,$httpProvider,$logProvider,$translateProvider){$locationProvider.html5Mode({enabled:!0,requireBase:!1}).hashPrefix("!"),$compileProvider.debugInfoEnabled("production"!==app.applicationEnvironment),$logProvider.debugEnabled("production"!==app.applicationEnvironment);var lang=window.localStorage.lang||"en";$translateProvider.preferredLanguage(lang),$translateProvider.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}function init(){if(window.location.hash&&"#_=_"===window.location.hash)if(window.history&&history.pushState)window.history.pushState("",document.title,window.location.pathname);else{var scroll={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=scroll.top,document.body.scrollLeft=scroll.left}angular.bootstrap(document,[app.applicationModuleName])}angular.module(app.applicationModuleName,app.applicationModuleVendorDependencies),angular.module(app.applicationModuleName).config(bootstrapConfig),bootstrapConfig.$inject=["$compileProvider","$locationProvider","$httpProvider","$logProvider","$translateProvider"],angular.element(document).ready(init)}(ApplicationConfiguration);
"use strict";!function(app){app.registerModule("core"),app.registerModule("core.routes",["ui.router"]),app.registerModule("core.animate",["ngAnimate"])}(ApplicationConfiguration);
"use strict";!function(){function routeConfig($stateProvider,$urlRouterProvider){$urlRouterProvider.rule(function($injector,$location){var path=$location.path(),hasTrailingSlash=path.length>1&&"/"===path[path.length-1];if(hasTrailingSlash){var newPath=path.substr(0,path.length-1);$location.replace().path(newPath)}}),$urlRouterProvider.otherwise(function($injector,$location){$injector.get("$state").transitionTo("not-found",null,{location:!1})}),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/client/views/home.client.view.html"}).state("not-found",{url:"/not-found",templateUrl:"modules/core/client/views/404.client.view.html",controller:"ErrorController",controllerAs:"vm",params:{message:["$stateParams",function($stateParams){return $stateParams.message}]},data:{ignoreState:!0,pageTitle:"Not Found"}}).state("bad-request",{url:"/bad-request",templateUrl:"modules/core/client/views/400.client.view.html",controller:"ErrorController",controllerAs:"vm",params:{message:["$stateParams",function($stateParams){return $stateParams.message}]},data:{ignoreState:!0,pageTitle:"Bad Request"}}).state("forbidden",{url:"/forbidden",templateUrl:"modules/core/client/views/403.client.view.html",data:{ignoreState:!0,pageTitle:"Forbidden"}})}angular.module("core.routes").config(routeConfig),routeConfig.$inject=["$stateProvider","$urlRouterProvider"]}();
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var AnimationViewController=function(){function AnimationViewController($timeout){_classCallCheck(this,AnimationViewController),this.config={},this.$timeout=$timeout}return _createClass(AnimationViewController,[{key:"bindSvg",value:function(svg){this.svg=svg}},{key:"bindCallback",value:function(cb){this.callback=cb}},{key:"init",value:function(){var config=this.config;this.svg;config.margin=[30,20,30,20]}},{key:"configure",value:function(){this.svg&&(this.reconfigure(),this.replay())}},{key:"reconfigure",value:function(){var vm=this,svg=vm.svg,config=vm.config,width=svg[0].clientWidth;if(config.xrange=[0,width],config.yrange=[0,svg?svg[0].clientHeight:0],vm.data){var data=vm.data,scale=(config.yrange[1]-config.yrange[0]-config.margin[0]-config.margin[2])/data.tables[0].height,translateX=(config.xrange[0]+config.xrange[1]-scale*data.tables[0].width)/2-data.tables[0].x,translateY=config.yrange[0]+config.margin[0]-data.tables[0].y;config.transform="translate("+translateX+","+translateY+")scale("+scale+")",console.log(scale*data.tables[0].width),console.log(config.transform)}}},{key:"replay",value:function(){var vm=this;if(vm.data){var tables=vm.data.tables,balls=vm.data.balls,techs=vm.data.techs,trajectories=vm.data.trajectories,duration=1500,times=30;vm.table=tables[0],vm.ball=balls[0],vm.tech=techs[0],vm.trajectory=trajectories[0],vm.timers instanceof Array&&vm.timers.forEach(function(d){return vm.$timeout.cancel(d)}),vm.timers=[],balls.forEach(function(d,i){if(0!==i){var newBall=balls[i],oldBall=balls[i-1],newTech=techs[i],oldTech=techs[i-1];d3.range(times+1).forEach(function(j){var timer=vm.$timeout(function(){var ball={},tech={};["cx","cy","r"].forEach(function(d){ball[d]=(newBall[d]-oldBall[d])*(j/times)+oldBall[d]}),j!==times?ball._d_=oldBall._d_:ball._d_=newBall._d_,newTech&&oldTech&&(["x","y"].forEach(function(d){tech[d]=(newTech[d]-oldTech[d])*(j/times)+oldTech[d]}),j!==times?["width","height","_d_","_scale_","src"].forEach(function(d){return tech[d]=oldTech[d]}):["width","height","_d_","_scale_","src"].forEach(function(d){return tech[d]=newTech[d]})),vm.ball=ball,vm.tech=tech,vm.trajectory=trajectories[i-1],vm.table=tables[i-1],i===balls.length-1&&j===times&&(vm.table=tables[i],vm.trajectory=void 0)},(i-1+j/times)*duration);vm.timers.push(timer)})}})}}},{key:"stop",value:function(){var vm=this;vm.timers instanceof Array&&(vm.timers.forEach(function(d){return vm.$timeout.cancel(d)}),vm.timers=[])}}]),AnimationViewController}();angular.module(app.applicationModuleName).controller("AnimationViewController",["$timeout",AnimationViewController])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var AppController=function(){function AppController($scope,Storage,$http,$translate){_classCallCheck(this,AppController);var vm=this;vm.$scope=$scope,vm.$http=$http,vm.$translate=$translate,vm.Storage=Storage,vm.data={},vm.history=[],vm.saveStatus=vm._saveStatus.bind(vm),vm.recoverStatus=vm._recoverStatus.bind(vm),vm.deleteStatus=vm._deleteStatus.bind(vm),vm.filteredStrikes=[],vm.changeFilteredStrikes=vm._changeFilteredStrikes.bind(vm),vm.load=vm._load.bind(vm),vm.setRallies=vm._setRallies.bind(vm),vm.setRally=vm._setRally.bind(vm),vm.setStrikes=vm._setStrikes.bind(vm),vm.setStrikesAnimation=vm._setStrikesAnimation.bind(vm),vm.selectArea=vm._selectArea.bind(vm),vm.safeApply=vm._safeApply.bind(vm),vm.loadDefaultData(),vm.changeLang=vm._changeLang.bind(vm),vm.curLang="cn"===window.localStorage.lang?"简体中文":"English",vm.loadData=vm._loadData.bind(vm)}return _createClass(AppController,[{key:"_changeLang",value:function(lang){var vm=this;"cn"===lang?vm.curLang="简体中文":vm.curLang="English",vm.$translate.use(lang),window.localStorage.lang=lang,window.location.reload()}},{key:"_changeFilteredStrikes",value:function(newStrikesObj){var vm=this;vm.safeApply(function(){vm.filteredStrikes=newStrikesObj})}},{key:"_saveStatus",value:function(oldHistoryArray,historyId){var vm=this;vm.safeApply(function(){var item={};item.id=historyId,item.data={},item.data.games=vm.data.games,item.data.rallies=vm.data.rallies,item.data.rally=vm.data.rally,item.data.strikes=vm.data.strikes,item.data.wholestrikes=vm.data.wholestrikes,item.data.strikesAnimation=vm.data.strikesAnimation,vm.history=oldHistoryArray,vm.history.push(item)})}},{key:"_recoverStatus",value:function(historyId){for(var vm=this,_loop=function(i){if(vm.history[i].id===historyId)return vm.safeApply(function(){vm.data.games=vm.history[i].data.games,vm.data.rallies=vm.history[i].data.rallies,vm.data.rally=vm.history[i].data.rally,vm.data.strikes=vm.history[i].data.strikes,vm.data.wholestrikes=vm.history[i].data.wholestrikes,vm.data.strikesAnimation=vm.history[i].data.strikesAnimation}),"break"},i=0;i<vm.history.length;i++){var _ret=_loop(i);if("break"===_ret)break}}},{key:"_deleteStatus",value:function(historyId){var vm=this,i=0;for(i=0;i<vm.history.length&&vm.history[i].id!==historyId;i++);vm.history.splice(i,1)}},{key:"_safeApply",value:function(fn){var vm=this,phase=vm.$scope.$root.$$phase;"$apply"==phase||"$digest"==phase?fn&&"function"==typeof fn&&fn():vm.$scope.$apply(fn)}},{key:"_load",value:function(){var vm=this;vm.safeApply(function(){vm.data.games=vm.Storage.games,vm.data.rallies=void 0,vm.data.rally=void 0,vm.data.strikes=void 0,vm.data.wholestrikes=vm._wholestrikes(),vm.data.strikesAnimation=void 0})}},{key:"_setRallies",value:function(rallies){var vm=this;vm.safeApply(function(){vm.data.rallies=rallies;rallies&&1===rallies.length?(vm.data.rally=rallies[0],vm.data.strikes=vm.data.rally.strikes):(vm.data.rally=void 0,vm.data.strikes=void 0),vm.data.wholestrikes=vm._wholestrikes()})}},{key:"_setRally",value:function(rally){var vm=this;vm.safeApply(function(){vm.data.rally=rally,vm.data.strikes=void 0===rally?void 0:rally.strikes,vm.data.wholestrikes=vm._wholestrikes()})}},{key:"_setStrikes",value:function(strikes){var vm=this;vm.safeApply(function(){vm.data.strikes=strikes})}},{key:"_setStrikesAnimation",value:function(data){var vm=this;vm.safeApply(function(){vm.data.strikesAnimation=data})}},{key:"_wholestrikes",value:function(){var vm=this,wholestrikes=[];vm.data.rally?vm.data.rally.strikes.forEach(function(strike){wholestrikes.push(strike)}):vm.data.rallies?vm.data.rallies.forEach(function(rally){rally.strikes.forEach(function(strike){wholestrikes.push(strike)})}):vm.data.games&&vm.data.games.forEach(function(game){game.rallies.forEach(function(rally){rally.strikes.forEach(function(strike){wholestrikes.push(strike)})})});for(var ii=0;ii<wholestrikes.length;ii++)if(wholestrikes[ii].strike.NextStrikeTech>=25){var nowStrike=wholestrikes[ii];"A"===nowStrike.player?25==nowStrike.strike.NextStrikeTech?nowStrike.isScore_=!0:1!=nowStrike.strike.StrikeTech&&(wholestrikes[ii-1].isScore_=!0):26==nowStrike.strike.NextStrikeTech?nowStrike.isScore_=!0:2!=nowStrike.strike.StrikeTech&&(wholestrikes[ii-1].isScore_=!0)}return wholestrikes}},{key:"_selectArea",value:function(config){var vm=this,rallies=[];vm.data.games.forEach(function(game){game.rallies.forEach(function(rally){if(rally.winner===config.winner){for(var strike=void 0,i=rally.strikes.length-1;i>=0;i--)if(rally.strikes[i].player===config.winner){strike=rally.strikes[i];break}strike&&(void 0!==config.area&&strike.Ball2Table(strike.ballPosition)!==config.area||void 0!==config.tech&&strike.strikeTechName!==config.tech||void 0!==config.hit&&strike.HitArea(strike.strikePosition)!==config.hit||rallies.push(rally))}})}),vm.safeApply(function(){vm.data.rallies=rallies,rallies&&1===rallies.length?(vm.data.rally=rallies[0],vm.data.strikes=vm.data.rally.strikes):(vm.data.rally=void 0,vm.data.strikes=void 0)})}},{key:"loadDefaultData",value:function(){var vm=this,Storage=vm.Storage;vm.$http.get("modules/core/client/dataset/default.csv").then(function(response){return response.data}).then(function(data){Storage.Load(data).then(Storage.ParseStrike.bind(Storage)).then(Storage.ParseRally.bind(Storage)).then(Storage.ParseGame.bind(Storage)).then(function(){vm.load()}).catch(function(err){console.error(err)})})}},{key:"_loadData",value:function(name){var vm=this,Storage=vm.Storage;vm.$http.get("modules/core/client/dataset/"+name+".csv").then(function(response){return response.data}).then(function(data){Storage.Load(data).then(Storage.ParseStrike.bind(Storage)).then(Storage.ParseRally.bind(Storage)).then(Storage.ParseGame.bind(Storage)).then(function(){vm.load()}).catch(function(err){console.error(err)})})}}]),AppController}();angular.module(app.applicationModuleName).controller("AppController",["$scope","Storage","$http","$translate",AppController])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var STATUS={SCORE:0,DIFF:1},FilterViewController=function(){function FilterViewController(Axis,VElement){_classCallCheck(this,FilterViewController),this.data={},this.config={},this.filters=[],this.status=STATUS.SCORE}return _createClass(FilterViewController,[{key:"init",value:function(){this.filters=[{key:"sphase",label:"Start Phase"},{key:"mphase",label:"Middle Phase"},{key:"ephase",label:"End Phase"},{key:"game1",label:"Game1"},{key:"game2",label:"Game2"},{key:"game3",label:"Game3"},{key:"game4",label:"Game4"},{key:"game5",label:"Game5"},{key:"game6",label:"Game6"},{key:"Awin",label:"Wang wins"},{key:"Bwin",label:"Wu wins"},{key:"Aleads",label:"Wang at Advantage"},{key:"Bleads",label:"Wu at Advantage"},{key:"draw",label:"Draw"},{key:"Aserve",label:"Wang serve"},{key:"Bserve",label:"Wu server"}],this.config.frange=[0,$("#fView").width()-15],this.data.totalRallyLength=d3.sum(this.games,function(d){return d.rallyLength}),this.data.allRally=Object.keys(Array.from({length:this.data.totalRallyLength})).map(function(item){return parseInt(item)}),this.configure()}},{key:"bindCallback",value:function(cb){this.callback=cb}},{key:"bindCallbackRally",value:function(cb){this.callbackRally=cb}},{key:"configure",value:function(){var vm=this,data=vm.data,games=vm.games,maxStrikeLength=0;games.forEach(function(game,i){game.rallies.forEach(function(rally,j){rally.strikeLength>maxStrikeLength&&(maxStrikeLength=rally.strikeLength)})}),data.maxStrikeLength=maxStrikeLength;var _obj=vm.getPhaseRally();vm.data.filterarr={sphase:_obj.phase[0],mphase:_obj.phase[1],ephase:_obj.phase[2],game1:vm.getGameRally(0),game2:vm.getGameRally(1),game3:vm.getGameRally(2),game4:vm.getGameRally(3),game5:vm.getGameRally(4),game6:vm.getGameRally(5),Awin:_obj.winner.A,Bwin:_obj.winner.B,Aleads:_obj.leads[0],Bleads:_obj.leads[1],draw:_obj.leads[2],Aserve:_obj.serve.A,Bserve:_obj.serve.B}}},{key:"getPhaseRally",value:function(){var vm=this,games=vm.games,rallies=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=games[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var game=_step.value;rallies=Array.prototype.concat.apply(rallies,game.rallies)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _phase_arr=[[],[],[]],_winner_arr={A:[],B:[]},_leads_arr=[[],[],[]],_serve_arr={A:[],B:[]};return rallies.forEach(function(rally,i){_phase_arr[rally.phase].push(i),_winner_arr[rally.winner].push(i),_serve_arr[rally.strikes[0].player].push(i);var _ascore=rally.score.A,_bscore=rally.score.B;_ascore-_bscore>=3?_leads_arr[0].push(i):_bscore-_ascore>=3?_leads_arr[1].push(i):_ascore==_bscore&&_leads_arr[2].push(i)}),{phase:_phase_arr,winner:_winner_arr,leads:_leads_arr,serve:_serve_arr}}},{key:"getGameRally",value:function(i){for(var vm=this,start=d3.sum(vm.games.slice(0,i),function(d){return d.rallyLength}),end=d3.sum(vm.games.slice(0,i+1),function(d){return d.rallyLength}),_arr=[],_i=start;_i<end;_i++)_arr.push(_i);return _arr}},{key:"update",value:function(){var vm=this,games=vm.games,filterarr=(vm.config,vm.data.filterarr),filterscale=vm.filterScale(),select_arr=vm.data.allRally,_checkkeys=[];vm.data.totalRallyLength=d3.sum(vm.games,function(d){return d.rallyLength}),vm.data.allRally=Object.keys(Array.from({length:vm.data.totalRallyLength})).map(function(item){return parseInt(item)}),this.configure();var checkboxes=$("#games-view .checkbox");checkboxes.each(function(i,item){$(item).hasClass("checked")&&_checkkeys.push($(item).attr("name"))});var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_loop=function(){var key=_step2.value,filter_arr=filterarr[key];select_arr=select_arr.filter(function(e){return filter_arr.includes(e)})},_iterator2=_checkkeys[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)_loop()}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}this.data.checkkeys=_checkkeys,this.data.select=select_arr;var rallies=[],_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=games[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var game=_step3.value;rallies=Array.prototype.concat.apply(rallies,game.rallies)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}rallies=rallies.filter(function(e,i){return select_arr.includes(i)}),this.callback(rallies),1==rallies.length&&this.callbackRally(rallies[0]);var filters=vm.filters;filters.forEach(function(item,i){var key=item.key,arr=filterarr[key];vm.filters[i].arr=arr.filter(function(e){return select_arr.includes(e)})}),d3.select("#filterSvg").selectAll("rect").remove(),d3.select("#filterSvg").selectAll("rect").data(vm.filters).enter().append("rect").attr("class","fratio").attr("x",29).attr("y",function(item,i){return 27*i+2}).attr("width",function(item){return item.arr?filterscale(item.arr.length):0}).attr("height",22).attr("fill","#777").attr("fill-opacity","0.3")}},{key:"render",value:function(){var vm=this;vm.data.select}},{key:"filterScale",value:function(){var vm=this,config=vm.config,scale=void 0;try{scale=d3.scaleLinear().domain([0,vm.data.totalRallyLength]).range(config.frange)}catch(e){console.error(e)}finally{return scale}}},{key:"clear",value:function(){}},{key:"renderHighlight",value:function(){var vm=this,data=vm.data,_arr=data.select;d3.select("#filterHighlight").selectAll(".fhighlight").remove(),0!=data.checkkeys.length&&d3.select("#filterHighlight").selectAll("rect").data(_arr).enter().append("rect").attr("class","fhighlight").attr("x",function(item){return 500*Math.random()}).attr("y",30).attr("width",function(item){return 20*Math.random()}).attr("height",100).attr("fill","#777").attr("fill-opacity",.3)}},{key:"renderFilter",value:function(){}}]),FilterViewController}();angular.module(app.applicationModuleName).controller("FilterViewController",["Axis","VElement",FilterViewController])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var STATUS={SCORE:0,DIFF:1},GamesViewController=function(){function GamesViewController(Axis,VElement){_classCallCheck(this,GamesViewController),this.config={},this.status=STATUS.SCORE,this.brush=this.brush.bind(this),this.VElement=VElement,this.highlight=this.highlight.bind(this),this.filter=this.filter.bind(this),Axis.call(this)}return _createClass(GamesViewController,[{key:"bindSvg",value:function(svg){this.svg=svg}},{key:"bindCallback",value:function(cb){this.callback=cb}},{key:"bindCallbackRally",value:function(cb){this.callbackRally=cb}},{key:"init",value:function(){var config=this.config,svg=this.svg;config.margin=[5,20,5,20],config.preK=1,config.svgSize=svg?svg[0].clientWidth:0,config.xrange=[0,svg?svg[0].clientWidth:0],config.yrange=[0,svg?svg[0].clientHeight:0],config.yaxisRatio=13/15,config.scaleRatio=.3,config.strikeCircleR=10,config.strikesmarginbottom=3,config.strikerange=[0,150],config.strikemargin=[3,10,3,23],config.strikepadding=[6,8,6,8],config.segment=0,config.rectHeight=4;var yunit=Math.abs(config.yrange[0]-config.yrange[1]),start=config.yrange[0]+config.margin[0],end=start+config.yaxisRatio*(yunit-config.margin[0]-config.margin[2]);config.brushExtent=[[config.xrange[0]+config.margin[3],start-config.rectHeight],[config.xrange[1]-config.margin[1],end]],this.match={totalRallyLength:d3.sum(this.games,function(d){return d.rallyLength})};var games=this.games,maxStrikeLength=0;games.forEach(function(game,i){game.rallies.forEach(function(rally,j){rally.strikeLength>maxStrikeLength&&(maxStrikeLength=rally.strikeLength)})}),this.match.maxStrikeLength=maxStrikeLength}},{key:"configure",value:function(){var vm=this;if(vm.svg){var config=vm.config;vm.match.totalRallyLength=d3.sum(this.games,function(d){return d.rallyLength});var games=this.games,maxStrikeLength=0;games.forEach(function(game,i){game.rallies.forEach(function(rally,j){rally.strikeLength>maxStrikeLength&&(maxStrikeLength=rally.strikeLength)})}),vm.match.maxStrikeLength=maxStrikeLength,config.brushSelection=config.brushSelection||[config.xrange[0]+config.margin[3],config.xrange[0]+config.margin[3]],vm.status===STATUS.SCORE?(vm.configureAxis(vm.strikeScale(),[],vm.scoreScale(),vm.scoreTicks()),vm.configureScoreline()):vm.status===STATUS.DIFF&&(vm.configureAxis(vm.strikeScale(),[],vm.diffScale(),vm.diffTicks()),vm.configureDiffline()),vm.configureBox()}}},{key:"filter",value:function(rallies){var vm=this,config=vm.config,games=vm.games,slice={},scorescale=vm.scoreScale();if(d3.select("#filterHighlight").selectAll(".fhighlight").remove(),rallies&&rallies.length!=vm.match.totalRallyLength){for(var i=0;i<games.length;i++)slice[i+1]=d3.sum(games.slice(0,i),function(d){return d.rallyLength});var select_arr=[];rallies.forEach(function(rally,i){select_arr.push(slice[rally.gameNo]+rally.rallyNo-1)}),d3.select(".brush .selection").attr("fill-opacity",0).attr("stroke-opacity",0),d3.select("#filterHighlight").selectAll("rect").data(select_arr).enter().append("rect").attr("class","fhighlight").attr("x",function(item){return vm.strikeScale(item)}).attr("y",scorescale.range()[0]-config.rectHeight).attr("width",function(item){return vm.strikeScale(item+1)-vm.strikeScale(item)}).attr("height",scorescale.range()[1]-scorescale.range()[0]+config.rectHeight).attr("fill","#777").attr("fill-opacity",.3)}}},{key:"configureAxis",value:function(xscale,xticks,yscale,yticks){var vm=this;if(vm.xaxis=[],vm.yaxis=[],vm.guideline=[],vm.games){var xaxis=vm.createBottomAxis(yscale(0),xscale,xticks),yaxis=vm.createLeftAxis(xscale(0),yscale,yticks);vm.xaxis.push(xaxis),vm.yaxis.push(yaxis),vm.status===STATUS.SCORE&&(vm.guideline.push(vm.createBottomAxis(yscale(4),xscale,[])),vm.guideline.push(vm.createBottomAxis(yscale(8),xscale,[])))}}},{key:"configureDiffline",value:function(){var vm=this;if(vm.difflines=[],vm.scorelines=[],vm.games){var strikeScale=vm.strikeScale(),diffScale=vm.diffScale();vm.games.forEach(function(game,i){var diff=[0].concat(game.diff),pastStrikes=d3.sum(vm.games.slice(0,i+1),function(d){return d.rallyLength});pastStrikes-=game.rallyLength;var line=d3.line().x(function(d,j){return parseInt(strikeScale(pastStrikes+j))}).y(function(d){return parseInt(diffScale(d))}).curve(d3.curveMonotoneX);vm.difflines.push({d:line(diff)})})}}},{key:"configureScoreline",value:function(){var vm=this;if(vm.scorelines=[],vm.difflines=[],vm.games){var scoreScale=vm.scoreScale(),rectHeight=vm.config.rectHeight;vm.games.forEach(function(game,i){vm.scorelines.push([]);var score=game.score,pastStrikes=d3.sum(vm.games.slice(0,i+1),function(d){return d.rallyLength}),scorelines=vm.scorelines[vm.scorelines.length-1];pastStrikes-=game.rallyLength;score.forEach(function(d,i){var index=pastStrikes+i,x1=vm.strikeScale(index)+1,x2=vm.strikeScale(index+1)-1,yA=scoreScale(d.A)-rectHeight,yB=scoreScale(d.B)-rectHeight,height=rectHeight;yA===yB&&(height/=2,score[i-1].A>score[i-1].B?yB+=height:yA+=height),scorelines.push({A:{x:x1,y:yA,width:x2-x1,height:height,opacity:1,player:"A"},B:{x:x1,y:yB,width:x2-x1,height:height,opacity:1,player:"B"},_d_:game.rallies[i]})})})}}},{key:"configureBox",value:function(){var vm=this,config=vm.config;config.svgSize,config.strikeCircleR;if(vm.strikeBoxes=[],vm.phaseBoxes=[],vm.strikes=[],vm.games){var yscale=vm.phaseScale(),circleScale=vm.circleScale();vm.scoreScale();vm.games.forEach(function(game,i){vm.strikeBoxes.push([]),vm.phaseBoxes.push([]);var pastStrikes=d3.sum(vm.games.slice(0,i+1),function(d){return d.rallyLength});pastStrikes-=game.rallyLength,game.rallies.forEach(function(rally,j){var item={},width=vm.strikeScale(pastStrikes+j+1)-vm.strikeScale(pastStrikes+j),height=yscale(1)-yscale(0);item.width=.8*width,item.height=.8*height,item.x=vm.strikeScale(pastStrikes+j)+.5*(width-item.width),item.y=yscale(0)+.5*(height-item.height),item.r=Math.min(circleScale(rally.strikeLength),item.width/2),item.radius=.15*Math.min(width,height),item._d_=rally,item.opacity=1,vm.strikes.push(rally),vm.strikeBoxes[i].push(item)});var phase=game.phase;phase.forEach(function(d,j){var start=d,end=phase[j+1],name=["start","middle","end"];j+1===phase.length&&(end=game.rallyLength);var item={},height=yscale(1)-yscale(0);item.x=vm.strikeScale(pastStrikes+d),item.y=yscale(0),item.width=vm.strikeScale(pastStrikes+end)-vm.strikeScale(pastStrikes+start),item.height=height,item._class_="phase-"+name[j],item._d_=game.rallies.slice(start,end),vm.phaseBoxes[i].push(item)})});var _strikeboxed=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=vm.strikeBoxes[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;_strikeboxed=Array.prototype.concat.apply(_strikeboxed,item)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _tmp=[],_scorelines=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=vm.scorelines[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _item=_step2.value;_tmp=Array.prototype.concat.apply(_tmp,_item)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=_tmp[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var _item2=_step3.value;_scorelines=Array.prototype.concat.apply(_scorelines,[_item2.A,_item2.B])}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}var _phaseboxes=[],_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=vm.phaseBoxes[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var _item3=_step4.value;_phaseboxes=Array.prototype.concat.apply(_phaseboxes,_item3)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}var gamesgroup=d3.select("#gamesgroup");gamesgroup._groups[0][0]||(gamesgroup=d3.select("svg").append("g").attr("id","gamesgroup").attr("class","gamesgroup")),gamesgroup.selectAll("rect").remove(),gamesgroup.selectAll("rect").data(_scorelines).enter().append("rect").attr("class",function(item){return item.player}).attr("x",function(item){return item.x}).attr("y",function(item){return item.y}).attr("width",function(item){return item.width}).attr("height",function(item){return item.height}).attr("opacity",function(item){return item.opacity}).on("click",function(item){});var phasesgroup=d3.select("#phasesgroup");phasesgroup._groups[0][0]||(phasesgroup=d3.select("svg").append("g").attr("id","phasesgroup").attr("class","phasesgroup")),phasesgroup.selectAll("rect").remove(),phasesgroup.selectAll("rect").data(_phaseboxes).enter().append("rect").attr("class",function(item){return item._class_}).attr("x",function(item){return item.x}).attr("y",function(item){return item.y}).attr("width",function(item){return item.width}).attr("height",function(item){return item.height});var boxgroup=d3.select("#boxgroup");boxgroup._groups[0][0]||(boxgroup=d3.select("svg").append("g").attr("id","boxgroup").attr("class","boxgroup")),boxgroup.selectAll("circle").remove(),boxgroup.selectAll("circle").data(_strikeboxed).enter().append("circle").attr("class",function(box){return"game-strike pointer "+box._d_.winner}).attr("cx",function(box){return box.x+.5*box.width}).attr("cy",function(box){return box.y+.5*box.height}).attr("r",function(box){return box.r}).on("click",function(item){vm.callback([item._d_]),vm.callbackRally(item._d_)})}}},{key:"strikeScale",value:function(i){var vm=this,scale=void 0,games=vm.games,config=vm.config,maxlength=(config.scaleRatio,d3.sum(games,function(d){return d.rallyLength})),range=[config.xrange[0]+config.margin[3],config.xrange[1]-config.margin[1]];vm.brushdomain,vm.brushrange;return scale=d3.scaleLinear(),i>=0?(scale.domain([0,maxlength]).range(range),scale(i)):(scale.domain([0,maxlength]).range(range),scale)}},{key:"filterScale",value:function(){var vm=this,scale=void 0;try{scale=d3.scaleLinear().domain([0,vm.match.totalRallyLength]).range([0,$("#filterSvg").width()-15])}catch(e){console.error(e)}finally{return scale}}},{key:"strikeTicks",value:function(){return[]}},{key:"circleScale",value:function(){var vm=this,config=vm.config,match=vm.match,phaseYScale=vm.phaseScale(),height=phaseYScale(1)-phaseYScale(0),totalRallyLength=vm.match.totalRallyLength,brushdomain=vm.brushdomain||[0,totalRallyLength],brushrange=vm.brushrange||[config.margin[3],config.xrange[1]-config.margin[1]],width=(brushrange[1]-brushrange[0])/(brushdomain[1]-brushdomain[0]),max=Math.min(height,width);return d3.scaleLinear().domain([0,match.maxStrikeLength]).range([1,max/2])}},{key:"scoreScale",value:function(){var vm=this,scale=void 0;try{var games=vm.games,config=vm.config,yunit=Math.abs(config.yrange[0]-config.yrange[1])-config.margin[0]-config.margin[2],start=config.yrange[0]+config.margin[0],end=start+config.yaxisRatio*yunit,range=[start,end],domain=[d3.max(games,function(d){return d.maxScore}),0];scale=d3.scaleLinear().domain(domain).range(range)}catch(e){}finally{return scale}}},{key:"scoreTicks",value:function(){var vm=this,ticks=void 0;try{var count=5,start=0,end=d3.max(vm.games,function(d){return d.maxScore});ticks=d3.ticks(start,end,count),ticks[ticks.length-1]<end&&ticks.push(end)}catch(e){}finally{return ticks}}},{key:"diffScale",value:function(){var vm=this,scale=void 0;try{var games=vm.games,config=vm.config,yunit=Math.abs(config.yrange[0]-config.yrange[1])-config.margin[0]-config.margin[2],start=config.yrange[0]+config.margin[0],end=start+config.yaxisRatio*yunit,range=[start,end],domain=[d3.max(games,function(d){return d.maxDiff}),-d3.max(games,function(d){return d.maxDiff})];scale=d3.scaleLinear().domain(domain).range(range)}catch(e){}finally{return scale}}},{key:"diffTicks",value:function(){var vm=this,ticks=void 0;try{var count=2,start=0,end=d3.max(vm.games,function(d){return d.maxDiff});ticks=d3.ticks(start,end,count),ticks[ticks.length-1]<end&&ticks.push(end),ticks=ticks.slice(1).map(function(d){return-d}).reverse().concat(ticks)}catch(e){}finally{return ticks}}},{key:"phaseScale",value:function(){var vm=this,scale=void 0;try{var config=(vm.games,vm.config),yunit=Math.abs(config.yrange[0]-config.yrange[1])-config.margin[0]-config.margin[2],start=config.yrange[0]+config.margin[0]+config.yaxisRatio*yunit+config.segment,end=start+(1-config.yaxisRatio)*yunit-config.segment,range=[start,end],domain=[0,1];scale=d3.scaleLinear().domain(domain).range(range)}catch(e){}finally{return scale}}},{key:"clickBox",value:function(box){var vm=this;box._d_ instanceof Array?vm.callback(box._d_):vm.callback([box._d_]),vm.update(function(){vm.config.brushSelection=[box.x,box.x+box.width]})}},{key:"brush",value:function(extent){var vm=this,config=vm.config,scaleRatio=config.scaleRatio;if(vm.games){if(!extent)return void vm.callback();var scale=vm.strikeScale(),start=Math.floor(vm.getStrikeIndex(extent[0])),end=Math.ceil(vm.getStrikeIndex(extent[1]));start=Math.max(0,start);var data=[];vm.games.forEach(function(game){data=data.concat(game.rallies)});var rallies=data.slice(start,end).filter(function(d){return void 0!==d});void 0===data[start]&&start++,void 0===data[end-1]&&end--,start>end&&(start=end),vm.brushdomain=[start,end],scale=vm.strikeScale();var domain=scale.domain(),range=scale.range();(1-scaleRatio)*(range[1]-range[0])/(domain[1]-end+start);vm.brushrange=[vm.strikeScale(start),vm.strikeScale(end)],vm.update(function(){vm.config.brushSelection=vm.brushrange}),1==rallies.length&&(vm.rally=rallies[0]),rallies.length>0&&vm.configure(),vm.callback(rallies)}}},{key:"getStrikeIndex",value:function(v){var vm=this,strike=(vm.config,vm.strikeScale()),domain=strike.domain(),range=strike.range(),brushdomain=vm.brushdomain,brushrange=vm.brushrange,scale=d3.scaleLinear();return v&&brushdomain&&brushrange?(scale.domain(domain).range(range),scale.invert(v)):strike.invert(v)}},{key:"highlight",value:function(event){var vm=this,config=vm.config,rectHeight=config.rectHeight,strikerange=config.strikerange,strikemargin=config.strikemargin,strikepadding=config.strikepadding,scorescale=(config.strikeCircleR,vm.scoreScale()),scorescalerange=[scorescale.range()[0],scorescale.range()[1]],svg_offset=$(d3.select("svg")._groups[0][0]).offset(),offset=[event.pageX-svg_offset.left,event.pageY-svg_offset.top],strikesmarginbottom=config.strikesmarginbottom;d3.selectAll(".strikeHighlight").remove(),d3.select("#matchTooltip").remove();var index=Math.floor(vm.getStrikeIndex(offset[0]));if(offset[1]<config.brushExtent[1][1]){if(index<0||index>=vm.match.totalRallyLength)return;var rallyscore=vm.strikes[index].score,baseobj=void 0;if(rallyscore[vm.strikes[index].winner]++,offset[1]>=scorescale(rallyscore.A)-rectHeight&&offset[1]<=scorescale(rallyscore.A))baseobj=rallyscore.A;else{if(!(offset[1]>=scorescale(rallyscore.B)-rectHeight&&offset[1]<=scorescale(rallyscore.B)))return;baseobj=rallyscore.B}var tooltip={width:60,height:48,dx:0,triHeight:9,margin:[2,2,2,2],padding:[2,2,2,2]};tooltip.x=.5*vm.strikeScale(index)+.5*vm.strikeScale(index+1)-.5*tooltip.width,tooltip.x<0&&(tooltip.xoverflow=!0,tooltip.dx=tooltip.x),tooltip.x>config.xrange[1]-tooltip.width&&(tooltip.xoverflow=!0,tooltip.dx=tooltip.x-(config.xrange[1]-tooltip.width)),tooltip.x=tooltip.x<0?0:tooltip.x,tooltip.x=tooltip.x>config.xrange[1]-tooltip.width?config.xrange[1]-tooltip.width:tooltip.x,tooltip.y=scorescale(baseobj)-rectHeight-tooltip.height,tooltip.y<0&&(tooltip.yoverflow=!0,tooltip.y=scorescale(baseobj));var tgroup=d3.select("svg").append("g").attr("id","matchTooltip").attr("class","matchTooltip").attr("transform",function(){return"translate("+(tooltip.x+tooltip.dx)+", "+tooltip.y+")"});return tgroup.append("rect").attr("class","match-tooltip").attr("x",0).attr("y",function(){return tooltip.yoverflow?tooltip.triHeight:0}).attr("width",tooltip.width).attr("height",tooltip.height-tooltip.triHeight).attr("style","fill: #000;fill-opacity: 0.8;"),tgroup.append("text").attr("x",0).attr("y",0).attr("transform",function(){return"translate("+.5*tooltip.width+", "+(tooltip.yoverflow?.5*tooltip.height+tooltip.triHeight+1:.5*tooltip.height+1)+")"}).attr("style","font-size: 15px;stroke-width: 0;fill: #fff;text-anchor: middle;").text(function(){return rallyscore.A+" : "+rallyscore.B}),void tgroup.append("polygon").attr("points",function(){return tooltip.yoverflow?.5*tooltip.width+",1 "+(.5*tooltip.width-4)+","+(tooltip.triHeight-1)+" "+(.5*tooltip.width+4)+","+(tooltip.triHeight-1):.5*tooltip.width-4+","+(tooltip.height-tooltip.triHeight+1)+" "+(.5*tooltip.width+4)+","+(tooltip.height-tooltip.triHeight+1)+" "+.5*tooltip.width+","+(tooltip.height-1)}).attr("style","fill: #000;fill-opacity: 0.8;")}if(!(offset[0]>vm.strikeScale().range()[1]||offset[0]-config.margin[3]<config.xrange[0]||offset[0]-config.margin[3]>config.xrange[1]||offset[1]>config.yrange[1]-config.margin[2])){d3.select("svg").append("g").attr("class","strikeHighlight").append("rect").attr("class","rallyHighlight").attr("x",vm.strikeScale(index)).attr("y",scorescale.range()[0]-config.rectHeight).attr("width",vm.strikeScale(index+1)-vm.strikeScale(index)).attr("height",scorescale.range()[1]-scorescale.range()[0]+config.rectHeight).attr("fill","#777").attr("fill-opacity",.3);var x=0;x=vm.strikeScale(index+1)+5+strikerange[1]+strikemargin[1]+strikemargin[3]>vm.strikeScale().range()[1]+1?vm.strikeScale(index)-5-strikerange[1]-strikemargin[1]-strikemargin[3]:vm.strikeScale(index+1)+5;var group={x:x+strikemargin[3],y:scorescalerange[0]+strikemargin[0],width:strikerange[1],height:scorescalerange[1]-scorescalerange[0]-strikemargin[0]-strikemargin[2]-strikesmarginbottom},rally=vm.strikes[index];rally.strikeLength>=14&&(group.width+=80);var strike=vm.getStrike(rally,group);if(strike&&strike.score){d3.select(".strikeHighlight").append("rect").attr("class","strikeContainer").attr("x",x).attr("y",scorescalerange[0]).attr("width",group.width+strikemargin[3]+strikemargin[1]).attr("height",scorescalerange[1]-scorescalerange[0]-strikesmarginbottom).attr("rx",5).attr("ry",5).attr("fill","#ccc").attr("fill-opacity",1),d3.select(".strikeHighlight").append("g").attr("id","strike-circles").attr("class","strike-circles").attr("transform",function(){return"translate("+group.x+", "+group.y+")"}),d3.select(".strike-circles").append("path").attr("d",strike.d).attr("fill","none").attr("stroke","#fff").attr("stroke-width",.75),d3.select(".strike-circles").selectAll(".strike-rect").data(strike.score).enter().append("rect").attr("class",function(item){return"strike-circle smallcircle "+item.player}).attr("x",function(item){return item.cx-.5*item.r}).attr("y",function(item){return item.cy-.5*item.r}).attr("width",function(item){return item.r}).attr("height",function(item){return item.r}),d3.select(".strike-circles").selectAll("text").data(strike.score).enter().append("text").attr("x",function(item){return item.cx}).attr("y",function(item){return item.cy}).attr("style","stroke-width: 0; fill: #fff;text-anchor: middle;").attr("dy","3").attr("font-size",function(item){return item.r+"px"}).text(function(item,i){return i+1});var textscale=d3.scaleLinear().domain([0,strike.levels.length-1]).range([strikepadding[0],group.height-strikepadding[2]]);d3.select(".strike-circles").selectAll(".rect").data(strike.levels).enter().append("rect").attr("class","rect").attr("x",0).attr("y",function(item,i){return textscale(i)}).attr("width",2).attr("height",1).attr("fill","#000"),d3.select(".strike-circles").selectAll(".level-label").data(strike.levels).enter().append("text").attr("class","level-label").attr("x",-strikemargin[3]+5).attr("y",function(item,i){return textscale(i)+4}).attr("style","stroke: #000; stroke-width: 0; fill: #000; font-size: 10px").text(function(item,i){return"L"+(i+1)}),d3.select(".strike-circles").append("line").attr("class","yAxis").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",group.height).attr("stroke","#666").attr("stroke-width",.75),d3.select(".strike-circles").append("line").attr("class","xAxis").attr("x1",0).attr("y1",group.height).attr("x2",group.width).attr("y2",group.height).attr("stroke","#666").attr("stroke-width",.75)}}}},{key:"getStrike",value:function(rally,group){var vm=this,config=vm.config,strikepadding=(config.strikerange,config.strikepadding),strikeCircleR=config.strikeCircleR,scores=[],d="",box_xscale=d3.scaleLinear().domain([0,rally.strikeLength-1]).range([strikepadding[3],group.width-strikepadding[1]]),box_yscale=d3.scaleLinear().domain([1,rally.strikeEffects.length]).range([strikepadding[0],group.height-strikepadding[2]]),max_width=(box_xscale.range()[1]-box_xscale.range()[0])/(box_xscale.domain()[1]-box_xscale.domain()[0]+1)-2;return rally.strikes.forEach(function(strike,k){var obj={cx:box_xscale(k),cy:box_yscale(strike.strikeEffect),r:Math.min(strikeCircleR,max_width),player:strike.player};d+=0===k?"M":"L",d+=obj.cx+" "+obj.cy,scores.push(obj)}),{score:scores,d:d,levels:rally.strikeEffects}}}]),GamesViewController}();angular.module(app.applicationModuleName).controller("GamesViewController",["Axis","VElement",GamesViewController])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var HistoryViewController=function(){function HistoryViewController(Axis,VElement,$timeout){_classCallCheck(this,HistoryViewController),this.config={},this.VElement=VElement,this.$timeout=$timeout,this.strikeInfo={},Axis.call(this)}return _createClass(HistoryViewController,[{key:"bindSaveStatus",value:function(cb){this.saveStatus=cb}},{key:"bindRecoverStatus",value:function(cb){this.recoverStatus=cb}},{key:"bindDeleteStatus",value:function(cb){this.deleteStatus=cb}},{key:"init",value:function(){var vm=this;vm.count=0,vm.history.forEach(function(item){item.name=item.id,item.comment=""})}},{key:"configure",value:function(){var vm=this;if(vm.history.length>vm.count){vm.count++;var newItem=$("#history .history-group li:last");newItem[0].scrollIntoView()}vm.history.forEach(function(item){item.name||(item.name=vm.initName()),item.comment||(item.comment="")})}},{key:"showRename",value:function(id){var dom=$("#item"+id);dom.find(".edit").css("visibility","visible")}},{key:"submitRename",value:function(id){for(var vm=this,dom=$("#item"+id),text=dom.find("input").val(),i=0;i<vm.history.length;i++)if(vm.history[i].id===id){vm.history[i].name=text;break}dom.find(".edit").css("visibility","hidden")}},{key:"editComment",value:function(id){var dom=$("#item"+id);dom.find(".text").css("display","none"),dom.find(".commentEdit").css("display","flex")}},{key:"submitComment",value:function(id){for(var vm=this,dom=$("#item"+id),text=dom.find("textarea").val(),i=0;i<vm.history.length;i++)if(vm.history[i].id===id){vm.history[i].comment=text;break}dom.find(".commentEdit").css("display","none"),dom.find(".text").css("display","block")}},{key:"initName",value:function(){Date.prototype.Format=function(fmt){var o={"y+":this.getFullYear(),"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};for(var k in o)if(new RegExp("("+k+")").test(fmt))if("y+"==k)fmt=fmt.replace(RegExp.$1,(""+o[k]).substr(4-RegExp.$1.length));else if("S+"==k){var lens=RegExp.$1.length;lens=1==lens?3:lens,fmt=fmt.replace(RegExp.$1,("00"+o[k]).substr((""+o[k]).length-1,lens))}else fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length));return fmt};var date=new Date,name=date.Format("yyyyMMdd hh:mm:ss.S");return name}},{key:"genHistoryId",value:function(){var date=new Date,timestamp=date.getTime();return timestamp}}]),HistoryViewController}();angular.module(app.applicationModuleName).controller("HistoryViewController",["Axis","VElement","$timeout",HistoryViewController])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var StatisticViewController=function(){function StatisticViewController(Axis,VElement,T){_classCallCheck(this,StatisticViewController),this.config={},this.VElement=VElement,Axis.call(this),this.T=T,this.servePlayerCond="A",this.switchAttrCond=void 0}return _createClass(StatisticViewController,[{key:"bindSvg",value:function(svg){this.svg=svg}},{key:"bindCallback",value:function(cb){this.callback=cb}},{key:"bindChangefstrikes",value:function(cb){this.changefstrikes=cb}},{key:"init",value:function(){}},{key:"preprocess",value:function(filterCond,params,mergeFilterConds){var labels=params.labels,totalStrikeNum=params.totalStrikeNum,servePlayerCond=params.servePlayerCond,filteredStrikes=[],changefstrikes=this.changefstrikes,totalMatrix={};params.maxCellValue=Number.MIN_SAFE_INTEGER,params.maxTableCellValue=Number.MIN_SAFE_INTEGER,params.maxCellValueS0=Number.MIN_SAFE_INTEGER,params.maxCellValueMerge=Number.MIN_SAFE_INTEGER,params.maxTableCellValueMerge=Number.MIN_SAFE_INTEGER;for(var totalMatrixObj={},_loop=function(){totalMatrix[iter]={},totalMatrixObj[iter]={};var BPRowLabels=labels.BPRowLabels.map(function(d){return d}),BPColLabels=labels.BPColLabels.map(function(d){return d}),BPColLabelsR=labels.BPColLabels.map(function(d){return d}),isOdd=iter%2==1;isOdd||(BPRowLabels=BPRowLabels.reverse(),BPColLabelsR=BPColLabelsR.reverse());for(var STLabels=labels.STLabels,SPLabels=labels.SPLabels,matricesObj={BPMatrixObj:{},ST_BPMatrixObj:{},BP_SPMatrixObj:{},ST_SPMatrixObj:{}},i=0;i<BPRowLabels.length;i++){matricesObj.BPMatrixObj[i]={};for(var j=0;j<BPColLabels.length;j++)matricesObj.BPMatrixObj[i][j]={rowName:BPRowLabels[i],colName:BPColLabels[j],value:0,scoreCount:0}}for(var _i=0;_i<STLabels.length;_i++){matricesObj.ST_BPMatrixObj[_i]={};for(var _j=0;_j<BPColLabels.length;_j++)matricesObj.ST_BPMatrixObj[_i][_j]={rowName:STLabels[_i],colName:BPColLabels[_j],value:0,scoreCount:0}}for(var _i2=0;_i2<BPColLabels.length;_i2++){matricesObj.BP_SPMatrixObj[_i2]={};for(var _j2=0;_j2<SPLabels.length;_j2++)matricesObj.BP_SPMatrixObj[_i2][_j2]={rowName:BPColLabelsR[_i2],colName:SPLabels[_j2],value:0,scoreCount:0}}for(var _i3=0;_i3<STLabels.length;_i3++){matricesObj.ST_SPMatrixObj[_i3]={};for(var _j3=0;_j3<SPLabels.length;_j3++)matricesObj.ST_SPMatrixObj[_i3][_j3]={rowName:STLabels[_i3],colName:SPLabels[_j3],value:0,scoreCount:0}}var matrices={BPMatrix:[],ST_BPMatrix:[],BP_SPMatrix:[],ST_SPMatrix:[]},gameRec=params.gameRec;Object.keys(gameRec).forEach(function(game){Object.keys(gameRec[game]).forEach(function(rally){if(Object.keys(gameRec[game][rally]).length>iter){var _i4=iter,strike=_i4+1,lastStrike=null,BPRow=null;_i4>0&&(lastStrike=gameRec[game][rally][_i4],BPRow=BPRowLabels.indexOf(lastStrike.nbp));var BPCol=BPColLabels.indexOf(gameRec[game][rally][strike].nbp),BPColR=BPColLabelsR.indexOf(gameRec[game][rally][strike].nbp),STRow=STLabels.indexOf(gameRec[game][rally][strike].st),SPCol=SPLabels.indexOf(gameRec[game][rally][strike].sp);if((1==strike||1!=strike&&BPRow!=-1)&&BPCol!=-1&&STRow!=-1&&SPCol!=-1){var mergeFilterFlag=null==mergeFilterConds;null!=mergeFilterConds&&mergeFilterConds.forEach(function(filter){(void 0==gameRec[game][rally][filter.unalteredStrikeNum]||void 0==gameRec[game][rally][filter.unalteredStrikeNum+1]||"nbp"!==filter.filterRowType||"nbp"!==filter.filterColType||""!==filter.filterRow&&filter.filterRow!==gameRec[game][rally][filter.unalteredStrikeNum].nbp||""!==filter.filterCol&&filter.filterCol!==gameRec[game][rally][filter.unalteredStrikeNum+1].nbp)&&(void 0==gameRec[game][rally][filter.unalteredStrikeNum+1]||"nbp"===filter.filterRowType&&"nbp"===filter.filterColType||""!==filter.filterRow&&gameRec[game][rally][filter.unalteredStrikeNum+1][filter.filterRowType]!==filter.filterRow||""!==filter.filterCol&&gameRec[game][rally][filter.unalteredStrikeNum+1][filter.filterColType]!==filter.filterCol)||(mergeFilterFlag=!0)});var normalFilterFlag=!0;null!=filterCond&&filterCond.isFilter&&(void 0==gameRec[game][rally][filterCond.unalteredStrikeNum]||void 0==gameRec[game][rally][filterCond.unalteredStrikeNum+1]||"nbp"!==filterCond.filterRowType||"nbp"!==filterCond.filterColType||""!==filterCond.filterRow&&filterCond.filterRow!==gameRec[game][rally][filterCond.unalteredStrikeNum].nbp||""!==filterCond.filterCol&&filterCond.filterCol!==gameRec[game][rally][filterCond.unalteredStrikeNum+1].nbp)&&(void 0==gameRec[game][rally][filterCond.unalteredStrikeNum+1]||"nbp"===filterCond.filterRowType&&"nbp"===filterCond.filterColType||""!==filterCond.filterRow&&gameRec[game][rally][filterCond.unalteredStrikeNum+1][filterCond.filterRowType]!==filterCond.filterRow||""!==filterCond.filterCol&&gameRec[game][rally][filterCond.unalteredStrikeNum+1][filterCond.filterColType]!==filterCond.filterCol)&&(normalFilterFlag=!1);var clickFilterFlag=!0;if(params.filterConds.forEach(function(filter){filter.isFilter&&(void 0==gameRec[game][rally][filter.unalteredStrikeNum]||void 0==gameRec[game][rally][filter.unalteredStrikeNum+1]||"nbp"!==filter.filterRowType||"nbp"!==filter.filterColType||""!==filter.filterRow&&filter.filterRow!==gameRec[game][rally][filter.unalteredStrikeNum].nbp||""!==filter.filterCol&&filter.filterCol!==gameRec[game][rally][filter.unalteredStrikeNum+1].nbp)&&(void 0==gameRec[game][rally][filter.unalteredStrikeNum+1]||"nbp"===filter.filterRowType&&"nbp"===filter.filterColType||""!==filter.filterRow&&gameRec[game][rally][filter.unalteredStrikeNum+1][filter.filterRowType]!==filter.filterRow||""!==filter.filterCol&&gameRec[game][rally][filter.unalteredStrikeNum+1][filter.filterColType]!==filter.filterCol)&&(clickFilterFlag=!1)}),clickFilterFlag&&normalFilterFlag&&mergeFilterFlag){var servePlayer=gameRec[game][rally][1].player;servePlayerCond.indexOf(servePlayer)!=-1&&(params.highlightCount>0&&filteredStrikes.push(gameRec[game][rally][strike].rawStrike),_i4>0&&(matricesObj.BPMatrixObj[BPRow][BPCol].value++,gameRec[game][rally][strike].isScore&&matricesObj.BPMatrixObj[BPRow][BPCol].scoreCount++),matricesObj.ST_BPMatrixObj[STRow][BPCol].value++,gameRec[game][rally][strike].isScore&&matricesObj.ST_BPMatrixObj[STRow][BPCol].scoreCount++,matricesObj.BP_SPMatrixObj[BPColR][SPCol].value++,gameRec[game][rally][strike].isScore&&matricesObj.BP_SPMatrixObj[BPColR][SPCol].scoreCount++,matricesObj.ST_SPMatrixObj[STRow][SPCol].value++,gameRec[game][rally][strike].isScore&&matricesObj.ST_SPMatrixObj[STRow][SPCol].scoreCount++)}}}})}),Object.keys(matricesObj.BPMatrixObj).forEach(function(row,i){Object.keys(matricesObj.BPMatrixObj[row]).forEach(function(col,j){matrices.BPMatrix.push({row:parseInt(row),col:parseInt(col),value:matricesObj.BPMatrixObj[row][col].value,scoreCount:matricesObj.BPMatrixObj[row][col].scoreCount,rowName:matricesObj.BPMatrixObj[row][col].rowName,colName:matricesObj.BPMatrixObj[row][col].colName})})}),Object.keys(matricesObj.BP_SPMatrixObj).forEach(function(row,i){Object.keys(matricesObj.BP_SPMatrixObj[row]).forEach(function(col,j){matrices.BP_SPMatrix.push({row:parseInt(row),col:parseInt(col),value:matricesObj.BP_SPMatrixObj[row][col].value,scoreCount:matricesObj.BP_SPMatrixObj[row][col].scoreCount,rowName:matricesObj.BP_SPMatrixObj[row][col].rowName,colName:matricesObj.BP_SPMatrixObj[row][col].colName})})}),Object.keys(matricesObj.ST_BPMatrixObj).forEach(function(row,i){Object.keys(matricesObj.ST_BPMatrixObj[row]).forEach(function(col,j){matrices.ST_BPMatrix.push({row:parseInt(row),col:parseInt(col),value:matricesObj.ST_BPMatrixObj[row][col].value,scoreCount:matricesObj.ST_BPMatrixObj[row][col].scoreCount,rowName:matricesObj.ST_BPMatrixObj[row][col].rowName,colName:matricesObj.ST_BPMatrixObj[row][col].colName})})}),Object.keys(matricesObj.ST_SPMatrixObj).forEach(function(row,i){Object.keys(matricesObj.ST_SPMatrixObj[row]).forEach(function(col,j){matrices.ST_SPMatrix.push({row:parseInt(row),col:parseInt(col),value:matricesObj.ST_SPMatrixObj[row][col].value,scoreCount:matricesObj.ST_SPMatrixObj[row][col].scoreCount,rowName:matricesObj.ST_SPMatrixObj[row][col].rowName,colName:matricesObj.ST_SPMatrixObj[row][col].colName})})}),matricesObj.tableMatrixObj={},BPRowLabels.forEach(function(rowLabel,i){matricesObj.tableMatrixObj["row-"+rowLabel]={name:rowLabel,type:"row",value:0,scoreCount:0,row:Math.floor(i/Math.sqrt(BPRowLabels.length)),col:i%Math.sqrt(BPRowLabels.length)}}),BPColLabels.forEach(function(colLabel,i){matricesObj.tableMatrixObj["col-"+colLabel]={name:colLabel,type:"col",value:0,scoreCount:0,row:Math.floor(i/Math.sqrt(BPColLabels.length)),col:i%Math.sqrt(BPColLabels.length)}}),matrices.BPMatrix.forEach(function(cell,i){matricesObj.tableMatrixObj["row-"+BPRowLabels[cell.row]].value+=cell.value,matricesObj.tableMatrixObj["col-"+BPColLabels[cell.col]].value+=cell.value,matricesObj.tableMatrixObj["row-"+BPRowLabels[cell.row]].scoreCount+=cell.scoreCount,matricesObj.tableMatrixObj["col-"+BPColLabels[cell.col]].scoreCount+=cell.scoreCount}),matrices.tableMatrix=[],Object.keys(matricesObj.tableMatrixObj).forEach(function(d){matrices.tableMatrix.push(matricesObj.tableMatrixObj[d])}),totalMatrixObj[iter]=matricesObj,totalMatrix[iter]=matrices;var tmpMax=Math.max.apply(Math,matrices.BPMatrix.concat(matrices.BP_SPMatrix).concat(matrices.ST_BPMatrix).concat(matrices.ST_SPMatrix).map(function(d){return d.value}));0!=iter&&tmpMax>params.maxCellValue&&(params.maxCellValue=tmpMax),0==iter&&tmpMax>params.maxCellValueS0&&(params.maxCellValueS0=tmpMax);var tmpMaxTableCircleValue=Math.max.apply(Math,matrices.tableMatrix.map(function(d){return d.value}));0!=iter&&tmpMaxTableCircleValue>params.maxTableCellValue&&(params.maxTableCellValue=tmpMaxTableCircleValue)},iter=0;iter<totalStrikeNum;iter++)_loop();return params.doFilter&&changefstrikes(0!=params.highlightCount?{fstrikes:filteredStrikes,doFilter:params.doFilter}:{fstrikes:params.vm.strikes,doFilter:params.doFilter}),{totalMatrix:totalMatrix,totalMatrixObj:totalMatrixObj}}},{key:"preprocess_givenGroupNum",value:function(filterCond,params,mergeFilterConds,groupNumIter){var labels=params.labels,servePlayerCond=params.servePlayerCond,updateMatrixObj={};return groupNumIter.forEach(function(iter){if(iter>=0){updateMatrixObj[iter]={};var _BPRowLabels=labels.BPRowLabels.map(function(d){return d}),_BPColLabels=labels.BPColLabels.map(function(d){return d}),_BPColLabelsR=labels.BPColLabels.map(function(d){return d}),isOdd=iter%2==1;isOdd||(_BPRowLabels=_BPRowLabels.reverse(),_BPColLabelsR=_BPColLabelsR.reverse());for(var _STLabels=labels.STLabels,_SPLabels=labels.SPLabels,_matricesObj={BPMatrixObj:{},ST_BPMatrixObj:{},BP_SPMatrixObj:{},ST_SPMatrixObj:{}},i=0;i<_BPRowLabels.length;i++){_matricesObj.BPMatrixObj[i]={};for(var j=0;j<_BPColLabels.length;j++)_matricesObj.BPMatrixObj[i][j]={rowName:_BPRowLabels[i],colName:_BPColLabels[j],value:0,scoreCount:0}}for(var _i5=0;_i5<_STLabels.length;_i5++){_matricesObj.ST_BPMatrixObj[_i5]={};for(var _j4=0;_j4<_BPColLabels.length;_j4++)_matricesObj.ST_BPMatrixObj[_i5][_j4]={rowName:_STLabels[_i5],colName:_BPColLabels[_j4],value:0,scoreCount:0}}for(var _i6=0;_i6<_BPColLabels.length;_i6++){_matricesObj.BP_SPMatrixObj[_i6]={};for(var _j5=0;_j5<_SPLabels.length;_j5++)_matricesObj.BP_SPMatrixObj[_i6][_j5]={rowName:_BPColLabelsR[_i6],colName:_SPLabels[_j5],value:0,scoreCount:0}}for(var _i7=0;_i7<_STLabels.length;_i7++){_matricesObj.ST_SPMatrixObj[_i7]={};for(var _j6=0;_j6<_SPLabels.length;_j6++)_matricesObj.ST_SPMatrixObj[_i7][_j6]={rowName:_STLabels[_i7],colName:_SPLabels[_j6],value:0,scoreCount:0}}for(var _i8=0;_i8<_BPRowLabels.length;_i8++){_matricesObj.BPMatrixObj[_i8]={};for(var _j7=0;_j7<_BPColLabels.length;_j7++)_matricesObj.BPMatrixObj[_i8][_j7]={rowName:_BPRowLabels[_i8],colName:_BPColLabels[_j7],value:0,scoreCount:0}}for(var _i9=0;_i9<_STLabels.length;_i9++){_matricesObj.ST_BPMatrixObj[_i9]={};for(var _j8=0;_j8<_BPColLabels.length;_j8++)_matricesObj.ST_BPMatrixObj[_i9][_j8]={rowName:_STLabels[_i9],colName:_BPColLabels[_j8],value:0,scoreCount:0}}for(var _i10=0;_i10<_BPColLabels.length;_i10++){_matricesObj.BP_SPMatrixObj[_i10]={};for(var _j9=0;_j9<_SPLabels.length;_j9++)_matricesObj.BP_SPMatrixObj[_i10][_j9]={rowName:_BPColLabelsR[_i10],colName:_SPLabels[_j9],value:0,scoreCount:0}}for(var _i11=0;_i11<_STLabels.length;_i11++){_matricesObj.ST_SPMatrixObj[_i11]={};for(var _j10=0;_j10<_SPLabels.length;_j10++)_matricesObj.ST_SPMatrixObj[_i11][_j10]={rowName:_STLabels[_i11],colName:_SPLabels[_j10],value:0,scoreCount:0}}var _gameRec=params.gameRec;Object.keys(_gameRec).forEach(function(game){Object.keys(_gameRec[game]).forEach(function(rally){if(Object.keys(_gameRec[game][rally]).length>iter){var _i12=iter,strike=_i12+1,lastStrike=null,BPRow=null;_i12>0&&(lastStrike=_gameRec[game][rally][_i12],BPRow=_BPRowLabels.indexOf(lastStrike.nbp));var BPCol=_BPColLabels.indexOf(_gameRec[game][rally][strike].nbp),BPColR=_BPColLabelsR.indexOf(_gameRec[game][rally][strike].nbp),STRow=_STLabels.indexOf(_gameRec[game][rally][strike].st),SPCol=_SPLabels.indexOf(_gameRec[game][rally][strike].sp);if((1==strike||1!=strike&&BPRow!=-1)&&BPCol!=-1&&STRow!=-1&&SPCol!=-1){var mergeFilterFlag=null==mergeFilterConds;null!=mergeFilterConds&&mergeFilterConds.forEach(function(filter){(void 0==_gameRec[game][rally][filter.unalteredStrikeNum]||void 0==_gameRec[game][rally][filter.unalteredStrikeNum+1]||"nbp"!==filter.filterRowType||"nbp"!==filter.filterColType||""!==filter.filterRow&&filter.filterRow!==_gameRec[game][rally][filter.unalteredStrikeNum].nbp||""!==filter.filterCol&&filter.filterCol!==_gameRec[game][rally][filter.unalteredStrikeNum+1].nbp)&&(void 0==_gameRec[game][rally][filter.unalteredStrikeNum+1]||"nbp"===filter.filterRowType&&"nbp"===filter.filterColType||""!==filter.filterRow&&_gameRec[game][rally][filter.unalteredStrikeNum+1][filter.filterRowType]!==filter.filterRow||""!==filter.filterCol&&_gameRec[game][rally][filter.unalteredStrikeNum+1][filter.filterColType]!==filter.filterCol)||(mergeFilterFlag=!0)});var normalFilterFlag=!0;if(null!=filterCond&&filterCond.isFilter&&(void 0==_gameRec[game][rally][filterCond.unalteredStrikeNum]||void 0==_gameRec[game][rally][filterCond.unalteredStrikeNum+1]||"nbp"!==filterCond.filterRowType||"nbp"!==filterCond.filterColType||""!==filterCond.filterRow&&filterCond.filterRow!==_gameRec[game][rally][filterCond.unalteredStrikeNum].nbp||""!==filterCond.filterCol&&filterCond.filterCol!==_gameRec[game][rally][filterCond.unalteredStrikeNum+1].nbp)&&(void 0==_gameRec[game][rally][filterCond.unalteredStrikeNum+1]||"nbp"===filterCond.filterRowType&&"nbp"===filterCond.filterColType||""!==filterCond.filterRow&&_gameRec[game][rally][filterCond.unalteredStrikeNum+1][filterCond.filterRowType]!==filterCond.filterRow||""!==filterCond.filterCol&&_gameRec[game][rally][filterCond.unalteredStrikeNum+1][filterCond.filterColType]!==filterCond.filterCol)&&(normalFilterFlag=!1),normalFilterFlag&&mergeFilterFlag){var servePlayer=_gameRec[game][rally][1].player;servePlayerCond.indexOf(servePlayer)!=-1&&(params.highlightCount>0&&filteredStrikes.push(_gameRec[game][rally][strike].rawStrike),_i12>0&&(_matricesObj.BPMatrixObj[BPRow][BPCol].value++,_gameRec[game][rally][strike].isScore&&_matricesObj.BPMatrixObj[BPRow][BPCol].scoreCount++),_matricesObj.ST_BPMatrixObj[STRow][BPCol].value++,_gameRec[game][rally][strike].isScore&&_matricesObj.ST_BPMatrixObj[STRow][BPCol].scoreCount++,_matricesObj.BP_SPMatrixObj[BPColR][SPCol].value++,_gameRec[game][rally][strike].isScore&&_matricesObj.BP_SPMatrixObj[BPColR][SPCol].scoreCount++,_matricesObj.ST_SPMatrixObj[STRow][SPCol].value++,_gameRec[game][rally][strike].isScore&&_matricesObj.ST_SPMatrixObj[STRow][SPCol].scoreCount++)}}}})}),_matricesObj.tableMatrixObj={},_BPRowLabels.forEach(function(rowLabel,i){_matricesObj.tableMatrixObj["row-"+rowLabel]={name:rowLabel,type:"row",value:0,scoreCount:0,row:Math.floor(i/Math.sqrt(_BPRowLabels.length)),col:i%Math.sqrt(_BPRowLabels.length)}}),_BPColLabels.forEach(function(colLabel,i){_matricesObj.tableMatrixObj["col-"+colLabel]={name:colLabel,type:"col",value:0,scoreCount:0,row:Math.floor(i/Math.sqrt(_BPColLabels.length)),col:i%Math.sqrt(_BPColLabels.length)}});var _matrices={};_matrices.BPMatrix=[],Object.keys(_matricesObj.BPMatrixObj).forEach(function(row,i){Object.keys(_matricesObj.BPMatrixObj[row]).forEach(function(col,j){_matrices.BPMatrix.push({row:parseInt(row),col:parseInt(col),value:_matricesObj.BPMatrixObj[row][col].value,scoreCount:_matricesObj.BPMatrixObj[row][col].scoreCount,rowName:_matricesObj.BPMatrixObj[row][col].rowName,colName:_matricesObj.BPMatrixObj[row][col].colName})})}),_matrices.BPMatrix.forEach(function(cell,i){_matricesObj.tableMatrixObj["row-"+_BPRowLabels[cell.row]].value+=cell.value,_matricesObj.tableMatrixObj["col-"+_BPColLabels[cell.col]].value+=cell.value,_matricesObj.tableMatrixObj["row-"+_BPRowLabels[cell.row]].scoreCount+=cell.scoreCount,_matricesObj.tableMatrixObj["col-"+_BPColLabels[cell.col]].scoreCount+=cell.scoreCount}),updateMatrixObj[iter]=_matricesObj}}),{updateMatrixObj:updateMatrixObj}}},{key:"showCircleOpacity",value:function(params){for(var iterArray=[],i=0;i<params.totalStrikeNum;i++)iterArray.push(i);iterArray.push(-2),iterArray.push(-1);var circleUpdateTime=500;iterArray.forEach(function(i){d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#histogram-"+i).selectAll("rect").transition().duration(circleUpdateTime).style("opacity",1),params.transitLinks&&(d3.select("#squareGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("stroke-opacity",1),d3.select("#squareGroup-"+i).selectAll("#squareGroupStrokeRect").transition().duration(circleUpdateTime).style("stroke-opacity",1).style("opacity",1),d3.select("#squareGroup-"+i).selectAll("#squareGroupFillRect").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#linksGroupHT-"+i).selectAll("line").transition().duration(circleUpdateTime).style("stroke-opacity",1),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("rect.tableCell").transition().duration(circleUpdateTime).style("stroke-opacity",1)),params.transitRects&&(d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BPMapGroup-"+i).select("#BPMapRowLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BPMapGroup-"+i).select("#BPMapColLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_BPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_BPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BP_SPMapGroup-"+i).select("#BP_SPMapRowLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BP_SPMapGroup-"+i).select("#BP_SPMapColLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BP_SPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#BP_SPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_SPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#ST_SPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",1),d3.select("#bgRect-"+i).selectAll("rect").transition().duration(circleUpdateTime).style("opacity",.4))})}},{key:"renderStatGroup",value:function(strikeNum,params,isEnd){var totalStrikeNum=params.totalStrikeNum,matrices=params.matrices,labels=params.labels,height=(params.width,params.height),svg=params.svg.select("#statViewGroup").append("g").attr("id","statViewGroup"+strikeNum).style("opacity",strikeNum>=0?1:0),servePlayerCond=params.servePlayerCond,mergeStartValue=0,mergeEndValue=0;strikeNum<0&&(mergeStartValue=params.mergeStartValue,mergeEndValue=params.mergeEndValue);var mergeStrikes=params.vm.mergeStrikes,isOdd=Math.abs(strikeNum)%2==1,BPRowLabels=labels.BPRowLabels.map(function(d){return d}),BPColLabels=labels.BPColLabels.map(function(d){return d}),BPColLabelsR=labels.BPColLabels.map(function(d){return d}),STLabels=labels.STLabels,SPLabels=labels.SPLabels,unitWidth=height/6.8,margin={top:unitWidth/3.6,right:0,bottom:50,left:params.marginLeft};"st"===params.switchAttrCond?(unitWidth=height/4.5,margin.top=unitWidth/8):"sp"===params.switchAttrCond&&(unitWidth=height/8,margin.top=unitWidth/4);var cellSize=unitWidth/BPRowLabels.length,matrixInterval=3*cellSize,matrixInterval2=5*cellSize,STBP_RectInterval=matrixInterval+.5*cellSize,evenColor=void 0,oddColor=void 0;"A"===servePlayerCond?(evenColor="#ff9933",oddColor="#33cccc"):"B"===servePlayerCond&&(evenColor="#33cccc",oddColor="#ff9933"),"AB"===servePlayerCond&&(evenColor="grey",oddColor="grey"),isOdd||(BPRowLabels=BPRowLabels.reverse(),BPColLabelsR=BPColLabelsR.reverse());var BPMatrix=matrices[strikeNum].BPMatrix,radiusScale=null;radiusScale=d3.scaleLinear().domain([0,params.maxCellValue]).range([cellSize/7,cellSize/2*9/10]),params.radiusScale=radiusScale,0==strikeNum&&(radiusScale=d3.scaleLinear().domain([0,params.maxCellValueS0]).range([cellSize/7,cellSize/2*9/10]),params.radiusScaleS0=radiusScale),strikeNum<0&&(radiusScale=d3.scaleLinear().domain([0,params.maxCellValueMerge]).range([cellSize/7,cellSize/2*9/10]),params.radiusScaleMerge=radiusScale);var colorScale=d3.scaleLinear().domain([0,1]).range(["#aaaaaa","#000000"]),labelNames={BP:{sl:"Short Backhand",sm:"Short Middle",sr:"Short Forehand",ml:"Half Long Backhand",mm:"Half Long Middle",mr:"Half Long Forehand",ll:"Long Backhand",lm:"Long Middle",lr:"Long Forehand"},ST:{ser:"serve",loo:"loop drive",qui:"quick attack",smas:"smash",fli:"flick",cho:"chop long",dro:"drop shot",blo:"block",cut:"cutting",par:"parrel",lob:"lob"},SP:{forehand:"forehand",sideways:"sideways","anti-sideways":"anti-sideways",backhand:"backhand",ser:"serve"}},tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(d){var color="white";return void 0==d.value&&void 0==d.scoreCount?"<span style='color:"+color+"'>"+params.T.t(labelNames[d.labelType][d.labelText])+"</span>":"<span style='color:"+color+"'>"+params.T.t("Total")+":"+d.value+"<br/>"+params.T.t("Score")+":"+d.scoreCount+"</br>"});d3.select("#statViewGroup").call(tip);var circleUpdateTime=300,hideOpacity=.2,mouseLeave=function(mergeFlag){var radiusScale=params.radiusScale,histogramYScale=params.histogramYScale,newMatrixObj=params.vm.preprocess({isFilter:!1},params).totalMatrixObj;if(Object.keys(matrices).forEach(function(groupNum){groupNum>=0&&Object.keys(matrices[groupNum]).forEach(function(matrixName){matrices[groupNum][matrixName].forEach(function(cell,i){"tableMatrix"!==matrixName?(matrices[groupNum][matrixName][i].value=newMatrixObj[groupNum][matrixName+"Obj"][cell.row][cell.col].value,matrices[groupNum][matrixName][i].scoreCount=newMatrixObj[groupNum][matrixName+"Obj"][cell.row][cell.col].scoreCount):matrices[groupNum][matrixName][i].value=newMatrixObj[groupNum][matrixName+"Obj"][cell.type+"-"+cell.name].value})})}),mergeFlag){var mergeResults=mergeStrikes(params),_newMatrixObj=mergeResults.mergeMatricesObj,newMatrixObj2=mergeResults.mergeMatricesObj2;Object.keys(matrices[-2]).forEach(function(matrixName){matrices[-2][matrixName].forEach(function(cell,i){"tableMatrix"!==matrixName?(matrices[-2][matrixName][i].value=_newMatrixObj[matrixName][cell.rowName][cell.colName].value,matrices[-2][matrixName][i].scoreCount=_newMatrixObj[matrixName][cell.rowName][cell.colName].scoreCount):matrices[-2][matrixName][i].value=_newMatrixObj[matrixName][cell.type][cell.name].value})}),Object.keys(matrices[-1]).forEach(function(matrixName){matrices[-1][matrixName].forEach(function(cell,i){"tableMatrix"!==matrixName?(matrices[-1][matrixName][i].value=newMatrixObj2[matrixName][cell.rowName][cell.colName].value,matrices[-1][matrixName][i].scoreCount=newMatrixObj2[matrixName][cell.rowName][cell.colName].scoreCount):matrices[-1][matrixName][i].value=newMatrixObj2[matrixName][cell.type][cell.name].value})})}for(var iterArray=[],i=0;i<totalStrikeNum;i++)iterArray.push(i);iterArray.push(-2),iterArray.push(-1),iterArray.forEach(function(i){radiusScale=0==i?params.radiusScaleS0:i<0?params.radiusScaleMerge:params.radiusScale,histogramYScale=i>=0?params.histogramYScale:params.histogramYScaleMerge,d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("opacity",function(d){return 0==params.highlightConds[i].BPMap.row.length&&0==params.highlightConds[i].BPMap.col.length?1:params.highlightConds[i].BPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].BPMap.col.indexOf(d.col)!=-1?1:hideOpacity}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("opacity",function(d){return 0==params.highlightConds[i].STBPMap.row.length&&0==params.highlightConds[i].STBPMap.col.length?1:params.highlightConds[i].STBPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].STBPMap.col.indexOf(d.col)!=-1?1:hideOpacity}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("opacity",function(d){return 0==params.highlightConds[i].BPSPMap.row.length&&0==params.highlightConds[i].BPSPMap.col.length?1:params.highlightConds[i].BPSPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].BPSPMap.col.indexOf(d.col)!=-1?1:hideOpacity}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("opacity",function(d){return 0==params.highlightConds[i].STSPMap.row.length&&0==params.highlightConds[i].STSPMap.col.length?1:params.highlightConds[i].STSPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].STSPMap.col.indexOf(d.col)!=-1?1:hideOpacity}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",function(d){return 0==params.highlightConds[i].tableMap.row.length&&0==params.highlightConds[i].tableMap.col.length?1:params.highlightConds[i].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}),d3.select("#histogram-"+i).selectAll("rect").transition().duration(circleUpdateTime).style("opacity",function(d){return 0==params.highlightConds[i].tableMap.row.length&&0==params.highlightConds[i].tableMap.col.length?1:params.highlightConds[i].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity}).attr("y",function(d){return 1==Math.abs(i%2)?0:-histogramYScale(d.value)}).attr("height",function(d){return histogramYScale(d.value)}),d3.select("#BPMapGroup-"+i).select("#BPMapRowLabels-"+i).selectAll("text").transition().duration(0).style("fill",function(t){return"black"}),d3.select("#BPMapGroup-"+i).select("#BPMapColLabels-"+i).selectAll("text").transition().duration(0).style("fill",function(t){return"black"}),d3.select("#ST_SPMapGroup-"+i).select("#ST_SPMapRowLabels-"+i).selectAll("text").transition().duration(0).style("fill",function(t){return"black"}),d3.select("#ST_SPMapGroup-"+i).select("#ST_SPMapColLabels-"+i).selectAll("text").transition().duration(0).style("fill",function(t){return"black"}),d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return 0==params.highlightConds[i].BPMap.row.length&&0==params.highlightConds[i].BPMap.col.length?1:params.highlightConds[i].BPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].BPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("rect.tableCell").transition().duration(0).style("stroke-opacity",function(d){return 0==params.highlightConds[i].tableMap.row.length&&0==params.highlightConds[i].tableMap.col.length?1:params.highlightConds[i].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity}),d3.select("#linksGroupHT-"+i).selectAll("line").transition().duration(0).style("stroke-opacity",function(d){return 0==params.highlightConds[i].tableMap.row.length&&0==params.highlightConds[i].tableMap.col.length?1:params.highlightConds[i].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity}),d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return 0==params.highlightConds[i].STBPMap.row.length&&0==params.highlightConds[i].STBPMap.col.length?1:params.highlightConds[i].STBPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].STBPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return 0==params.highlightConds[i].BPSPMap.row.length&&0==params.highlightConds[i].BPSPMap.col.length?1:params.highlightConds[i].BPSPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].BPSPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return 0==params.highlightConds[i].STSPMap.row.length&&0==params.highlightConds[i].STSPMap.col.length?1:params.highlightConds[i].STSPMap.row.indexOf(d.row)!=-1||params.highlightConds[i].STSPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#squareGroup-"+i).selectAll("line").transition().duration(0).attr("stroke-opacity",function(d){return 0==params.highlightConds[i].tableMap.col.length||params.highlightConds[i].tableMap.col.indexOf(d.colName)!=-1?1:hideOpacity})})},tableAnimation=function(row,col,strikeNo){var BPRowLabels=labels.BPRowLabels.map(function(d){return d;
}),BPColLabels=labels.BPColLabels.map(function(d){return d});Math.abs(strikeNo)%2==0&&(BPRowLabels=BPRowLabels.reverse()),d3.select("#tableGroup-"+strikeNo).select(".tablemap").selectAll("rect.tableCell").transition().duration(0).style("stroke-opacity",function(d){return row!=-1&&"row"===d.type&&BPRowLabels[row]===d.name||"col"===d.type&&BPColLabels[col]===d.name||params.highlightConds[strikeNo].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity}),d3.select("#tableGroup-"+strikeNo).select(".tablemap").selectAll("circle").transition().duration(0).style("opacity",function(d){return row!=-1&&"row"===d.type&&BPRowLabels[row]===d.name||"col"===d.type&&BPColLabels[col]===d.name||params.highlightConds[strikeNo].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity}),d3.select("#linksGroupHT-"+strikeNo).selectAll("line").transition().duration(0).style("stroke-opacity",function(d){return row!=-1&&"row"===d.type&&BPRowLabels[row]===d.name||"col"===d.type&&BPColLabels[col]===d.name||params.highlightConds[strikeNo].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity}),d3.select("#histogram-"+strikeNo).selectAll("rect").transition().duration(0).style("opacity",function(d){return row!=-1&&"row"===d.type&&BPRowLabels[row]===d.name||"col"===d.type&&BPColLabels[col]===d.name||params.highlightConds[strikeNo].tableMap[d.type].indexOf(d.name)!=-1?1:hideOpacity})},BPMapLabelAnimation=function(row,col,strikeNo){row!=-1&&d3.select("#BPMapGroup-"+strikeNum).select("#BPMapRowLabels-"+strikeNum).selectAll("text").transition().duration(0).style("fill",function(t){return BPRowLabels[row]===t?"red":"black"}),col!=-1&&d3.select("#BPMapGroup-"+strikeNum).select("#BPMapColLabels-"+strikeNum).selectAll("text").transition().duration(0).style("fill",function(t){return BPColLabels[col]===t?"red":"black"})},ST_SPMapLabelAnimation=function(row,col,strikeNo){row!=-1&&d3.select("#ST_SPMapGroup-"+strikeNum).select("#ST_SPMapRowLabels-"+strikeNum).selectAll("text").transition().duration(0).style("fill",function(t){return STLabels[row]===t?"red":"black"}),col!=-1&&d3.select("#ST_SPMapGroup-"+strikeNum).select("#ST_SPMapColLabels-"+strikeNum).selectAll("text").transition().duration(0).style("fill",function(t){return SPLabels[col]===t?"red":"black"})},BPMapAnimation=function(row,col,strikeNo){d3.select("#BPMapGroup-"+strikeNo).select(".BPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return d.row==row||d.col===col||params.highlightConds[strikeNo].BPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].BPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#BPMapGroup-"+strikeNo).select(".BPMap").selectAll("circle").transition().duration(0).attr("opacity",function(d){return d.row==row||d.col===col||params.highlightConds[strikeNo].BPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].BPMap.col.indexOf(d.col)!=-1?1:hideOpacity})},ST_BPMapAnimation=function(row,col,strikeNo){d3.select("#ST_BPMapGroup-"+strikeNo).select(".ST_BPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return d.row==row||d.col===col||params.highlightConds[strikeNo].STBPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].STBPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#ST_BPMapGroup-"+strikeNo).select(".ST_BPMap").selectAll("circle").transition().duration(0).attr("opacity",function(d){return d.row==row||d.col===col||params.highlightConds[strikeNo].STBPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].STBPMap.col.indexOf(d.col)!=-1?1:hideOpacity})},BP_SPMapAnimation=function(row,col,strikeNo){d3.select("#BP_SPMapGroup-"+strikeNo).select(".BP_SPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return d.row==row||d.col==col||params.highlightConds[strikeNo].BPSPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].BPSPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#BP_SPMapGroup-"+strikeNo).select(".BP_SPMap").selectAll("circle").transition().duration(0).attr("opacity",function(d){return d.row==row||d.col==col||params.highlightConds[strikeNo].BPSPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].BPSPMap.col.indexOf(d.col)!=-1?1:hideOpacity})},ST_SPMapAnimation=function(row,col,strikeNo){d3.select("#ST_SPMapGroup-"+strikeNo).select(".ST_SPMap").selectAll("rect.cell").transition().duration(0).attr("stroke-opacity",function(d){return d.row==row||d.col===col||params.highlightConds[strikeNo].STSPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].STSPMap.col.indexOf(d.col)!=-1?1:hideOpacity}),d3.select("#ST_SPMapGroup-"+strikeNo).select(".ST_SPMap").selectAll("circle").transition().duration(0).attr("opacity",function(d){return d.row==row||d.col===col||params.highlightConds[strikeNo].STSPMap.row.indexOf(d.row)!=-1||params.highlightConds[strikeNo].STSPMap.col.indexOf(d.col)!=-1?1:hideOpacity})},otherLinksAnimation=function(col,strikeNo){d3.select("#squareGroup-"+strikeNo).selectAll("line").transition().duration(0).attr("stroke-opacity",function(d){return d.colName===BPColLabels[col]||params.highlightConds[strikeNo].tableMap.col.indexOf(d.colName)!=-1?1:hideOpacity})},updateCellCircles=function(filterCond,mergeFilterConds,groupNumIter){var radiusScale=params.radiusScale,histogramYScale=params.histogramYScale;if(null!=filterCond||null!=mergeFilterConds&&null!=groupNumIter){var preprocess=params.vm.preprocess_givenGroupNum(filterCond,params,mergeFilterConds,groupNumIter),newMatrixObj_update=preprocess.updateMatrixObj;if(Object.keys(matrices).forEach(function(groupNum){groupNum>=0&&groupNumIter.indexOf(parseInt(groupNum))!=-1&&Object.keys(matrices[groupNum]).forEach(function(matrixName){matrices[groupNum][matrixName].forEach(function(cell,i){"tableMatrix"!==matrixName?(matrices[groupNum][matrixName][i].value=newMatrixObj_update[groupNum][matrixName+"Obj"][cell.row][cell.col].value,matrices[groupNum][matrixName][i].scoreCount=newMatrixObj_update[groupNum][matrixName+"Obj"][cell.row][cell.col].scoreCount):matrices[groupNum][matrixName][i].value=newMatrixObj_update[groupNum][matrixName+"Obj"][cell.type+"-"+cell.name].value})})}),null!=mergeFilterConds||void 0!==params.mergeFirstPlayer){var mergeResults=mergeStrikes(params),newMatrixObj=mergeResults.mergeMatricesObj,newMatrixObj2=mergeResults.mergeMatricesObj2;groupNumIter.indexOf(-2)!=-1&&Object.keys(matrices[-2]).forEach(function(matrixName){matrices[-2][matrixName].forEach(function(cell,i){null!=mergeFilterConds&&("tableMatrix"!==matrixName?(matrices[-2][matrixName][i].value=newMatrixObj[matrixName][cell.rowName][cell.colName].value,matrices[-2][matrixName][i].scoreCount=newMatrixObj[matrixName][cell.rowName][cell.colName].scoreCount):matrices[-2][matrixName][i].value=newMatrixObj[matrixName][cell.type][cell.name].value)})}),groupNumIter.indexOf(-1)!=-1&&Object.keys(matrices[-1]).forEach(function(matrixName){matrices[-1][matrixName].forEach(function(cell,i){null!=mergeFilterConds&&("tableMatrix"!==matrixName?(matrices[-1][matrixName][i].value=newMatrixObj2[matrixName][cell.rowName][cell.colName].value,matrices[-1][matrixName][i].scoreCount=newMatrixObj2[matrixName][cell.rowName][cell.colName].scoreCount):matrices[-1][matrixName][i].value=newMatrixObj2[matrixName][cell.type][cell.name].value)})})}}var iterArray=void 0;if(null!=groupNumIter)iterArray=groupNumIter;else{iterArray=[];for(var i=0;i<totalStrikeNum;i++)iterArray.push(i);null!=mergeFilterConds&&(iterArray.push(-2),iterArray.push(-1))}iterArray.forEach(function(i){radiusScale=0==i?params.radiusScaleS0:i<0?params.radiusScaleMerge:params.radiusScale,histogramYScale=i>=0?params.histogramYScale:params.histogramYScaleMerge,null!=filterCond&&i==filterCond.unalteredStrikeNum&&"nbp"===filterCond.filterRowType&&"nbp"===filterCond.filterColType&&""!==filterCond.filterRow&&""!==filterCond.filterCol||null!=mergeFilterConds&&mergeFilterConds[0].mergeStrikeNum==i&&"nbp"===mergeFilterConds[0].filterRowType&&"nbp"===mergeFilterConds[0].filterColType&&""!==mergeFilterConds[0].filterRow&&""!==mergeFilterConds[0].filterCol||d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),(null==filterCond||i!=filterCond.unalteredStrikeNum||"nbp"!==filterCond.filterRowType||"nbp"!==filterCond.filterColType||""!==filterCond.filterRow&&""!==filterCond.filterCol)&&(null==mergeFilterConds||mergeFilterConds[0].mergeStrikeNum!=i||"nbp"!==mergeFilterConds[0].filterRowType||"nbp"!==mergeFilterConds[0].filterColType||""!==mergeFilterConds[0].filterRow&&""!==mergeFilterConds[0].filterCol)&&(d3.select("#tableGroup-"+i).select(".tablemap").selectAll("circle").transition().duration(circleUpdateTime).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}),d3.select("#histogram-"+i).selectAll("rect").transition().duration(circleUpdateTime).attr("y",function(d){return 1==Math.abs(i%2)?0:-histogramYScale(d.value)}).attr("height",function(d){return histogramYScale(d.value)})),null!=filterCond&&i==filterCond.unalteredStrikeNum&&"st"===filterCond.filterRowType&&"nbp"===filterCond.filterColType||null!=mergeFilterConds&&mergeFilterConds[0].mergeStrikeNum==i&&"st"===mergeFilterConds[0].filterRowType&&"nbp"===mergeFilterConds[0].filterColType||d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),null!=filterCond&&i==filterCond.unalteredStrikeNum&&"nbp"===filterCond.filterRowType&&"sp"===filterCond.filterColType||null!=mergeFilterConds&&mergeFilterConds[0].mergeStrikeNum==i&&"nbp"===mergeFilterConds[0].filterRowType&&"sp"===mergeFilterConds[0].filterColType||d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),null!=filterCond&&i==filterCond.unalteredStrikeNum&&"st"===filterCond.filterRowType&&"sp"===filterCond.filterColType||null!=mergeFilterConds&&mergeFilterConds[0].mergeStrikeNum==i&&"st"===mergeFilterConds[0].filterRowType&&"sp"===mergeFilterConds[0].filterColType||d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("circle").transition().duration(circleUpdateTime).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)})})},BPMapMouseOver=function(d){params.doFilter=!1;var filterCond={isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:BPRowLabels[d.row],filterCol:BPColLabels[d.col]},row=d.row,col=d.col,colR=Math.abs(strikeNum)%2==1?d.col:params.labels.BPColLabels.length-1-d.col;if(BPMapLabelAnimation(row,col),BPMapAnimation(row,col,strikeNum),tableAnimation(row,col,strikeNum),ST_BPMapAnimation(-1,col,strikeNum),BP_SPMapAnimation(colR,-1,strikeNum),otherLinksAnimation(col,strikeNum),isEnd||(tableAnimation(colR,-1,strikeNum+1),BPMapAnimation(colR,-1,strikeNum+1)),0!=strikeNum){var lastCol=Math.abs(strikeNum)%2==0?row:params.labels.BPRowLabels.length-1-row;BPMapAnimation(-1,lastCol,strikeNum-1),tableAnimation(-1,lastCol,strikeNum-1),ST_BPMapAnimation(-1,lastCol,strikeNum-1),BP_SPMapAnimation(row,-1,strikeNum-1),otherLinksAnimation(lastCol,strikeNum-1)}if(strikeNum>=0){var groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(filterCond,null,groupNumIter)}else{var mergeFilterConds=[];params.mergePlayerStrikes.forEach(function(i){mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:BPRowLabels[d.row],filterCol:BPColLabels[d.col]})});var _groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(null,mergeFilterConds,_groupNumIter)}},tableMouseOver=function(d){params.doFilter=!1;var filterCond={};filterCond="row"===d.type?{isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:d.name,filterCol:""}:{isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:"",filterCol:d.name};var row=void 0,col=void 0,colR=void 0;if("row"===d.type){if(row=BPRowLabels.indexOf(d.name),col=-1,colR=-1,0!=strikeNum){var lastCol=Math.abs(strikeNum)%2==0?row:params.labels.BPRowLabels.length-1-row;BPMapAnimation(-1,lastCol,strikeNum-1),tableAnimation(-1,lastCol,strikeNum-1),ST_BPMapAnimation(-1,lastCol,strikeNum-1),BP_SPMapAnimation(row,-1,strikeNum-1),otherLinksAnimation(lastCol,strikeNum-1)}}else row=-1,col=BPColLabels.indexOf(d.name),colR=BPColLabelsR.indexOf(d.name),ST_BPMapAnimation(-1,col,strikeNum),BP_SPMapAnimation(colR,-1,strikeNum),isEnd||(tableAnimation(colR,-1,strikeNum+1),BPMapAnimation(colR,-1,strikeNum+1));if(BPMapLabelAnimation(row,col),BPMapAnimation(row,col,strikeNum),tableAnimation(row,col,strikeNum),otherLinksAnimation(col,strikeNum),strikeNum>=0){var groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(filterCond,null,groupNumIter)}else{var mergeFilterConds=[];params.mergePlayerStrikes.forEach(function(i){"row"===d.type?mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:d.name,filterCol:""}):mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:"",filterCol:d.name})});var _groupNumIter2=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(null,mergeFilterConds,_groupNumIter2)}},ST_BPMapMouseOver=function(d){params.doFilter=!1;var filterCond={isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"st",filterColType:"nbp",filterRow:STLabels[d.row],filterCol:BPColLabels[d.col]},row=d.row,col=d.col,colR=Math.abs(strikeNum)%2==1?d.col:params.labels.BPColLabels.length-1-d.col;if(BPMapLabelAnimation(-1,col),BPMapAnimation(-1,col,strikeNum),tableAnimation(-1,col,strikeNum),isEnd||(tableAnimation(colR,-1,strikeNum+1),BPMapAnimation(colR,-1,strikeNum+1)),ST_BPMapAnimation(row,col,strikeNum),BP_SPMapAnimation(colR,-1,strikeNum),ST_SPMapAnimation(row,-1,strikeNum),ST_SPMapLabelAnimation(row,-1),otherLinksAnimation(col,strikeNum),strikeNum>=0){var groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(filterCond,null,groupNumIter)}else{var mergeFilterConds=[];params.mergePlayerStrikes.forEach(function(i){mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"st",filterColType:"nbp",filterRow:STLabels[d.row],filterCol:BPColLabels[d.col]})});var _groupNumIter3=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(null,mergeFilterConds,_groupNumIter3)}},BP_SPMapMouseOver=function(d){params.doFilter=!1;var filterCond={isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"sp",filterRow:BPColLabelsR[d.row],filterCol:SPLabels[d.col]},row=d.row,col=d.col,colR=Math.abs(strikeNum)%2==1?d.row:params.labels.BPColLabels.length-1-d.row;if(BPMapLabelAnimation(-1,colR),BPMapAnimation(-1,colR,strikeNum),tableAnimation(-1,colR,strikeNum),ST_BPMapAnimation(-1,colR,strikeNum),BP_SPMapAnimation(row,col,strikeNum),ST_SPMapAnimation(-1,col,strikeNum),ST_SPMapLabelAnimation(-1,col),otherLinksAnimation(colR,strikeNum),isEnd||(tableAnimation(row,-1,strikeNum+1),BPMapAnimation(row,-1,strikeNum+1)),strikeNum>=0){var groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(filterCond,null,groupNumIter)}else{var mergeFilterConds=[];params.mergePlayerStrikes.forEach(function(i){mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"sp",filterRow:BPColLabelsR[d.row],filterCol:SPLabels[d.col]})});var _groupNumIter4=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(null,mergeFilterConds,_groupNumIter4)}},ST_SPMapMouseOver=function(d){params.doFilter=!1;var filterCond={isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"st",filterColType:"sp",filterRow:STLabels[d.row],filterCol:SPLabels[d.col]},row=d.row,col=d.col;if(ST_BPMapAnimation(row,-1,strikeNum),BP_SPMapAnimation(-1,col,strikeNum),ST_SPMapAnimation(row,col,strikeNum),ST_SPMapLabelAnimation(row,col),strikeNum>=0){var groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(filterCond,null,groupNumIter)}else{var mergeFilterConds=[];params.mergePlayerStrikes.forEach(function(i){mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"st",filterColType:"sp",filterRow:STLabels[d.row],filterCol:SPLabels[d.col]})});var _groupNumIter5=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(null,mergeFilterConds,_groupNumIter5)}},STSPLabelsMouseOver=function(d){params.doFilter=!1;var filterCond={};filterCond="row"===d.type?{isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"st",filterColType:"sp",filterRow:d.name,filterCol:""}:{isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"st",filterColType:"sp",filterRow:"",filterCol:d.name};var row=void 0,col=void 0;if("row"===d.type?(row=STLabels.indexOf(d.name),col=-1,ST_SPMapAnimation(row,col,strikeNum),ST_BPMapAnimation(row,col,strikeNum)):(row=-1,col=SPLabels.indexOf(d.name),ST_SPMapAnimation(row,col,strikeNum),BP_SPMapAnimation(row,col,strikeNum)),strikeNum>=0){var groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(filterCond,null,groupNumIter)}else{var mergeFilterConds=[];params.mergePlayerStrikes.forEach(function(i){"row"===d.type?mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"st",filterColType:"sp",filterRow:d.name,filterCol:""}):mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"st",filterColType:"sp",filterRow:"",filterCol:d.name})});var _groupNumIter6=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(null,mergeFilterConds,_groupNumIter6)}},BPLabelsMouseOver=function(d){params.doFilter=!1;var filterCond={};filterCond="row"===d.type?{isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:d.name,filterCol:""}:{isFilter:!0,unalteredStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:"",filterCol:d.name};var row=void 0,col=void 0,colR=void 0;if("row"===d.type?(row=BPRowLabels.indexOf(d.name),col=-1,colR=-1):(row=-1,col=BPColLabels.indexOf(d.name),colR=BPColLabelsR.indexOf(d.name)),col!=-1&&(ST_BPMapAnimation(row,col,strikeNum),BP_SPMapAnimation(colR,row,strikeNum)),BPMapLabelAnimation(row,col),BPMapAnimation(row,col,strikeNum),tableAnimation(row,col,strikeNum),isEnd||(tableAnimation(colR,-1,strikeNum+1),BPMapAnimation(colR,-1,strikeNum+1)),0!=strikeNum){var lastCol=Math.abs(strikeNum)%2==0?row:params.labels.BPRowLabels.length-1-row;BPMapAnimation(-1,lastCol,strikeNum-1),tableAnimation(-1,lastCol,strikeNum-1),ST_BPMapAnimation(-1,lastCol,strikeNum-1),BP_SPMapAnimation(row,-1,strikeNum-1),otherLinksAnimation(lastCol,strikeNum-1)}if(otherLinksAnimation(col,strikeNum),strikeNum>=0){var groupNumIter=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(filterCond,null,groupNumIter)}else{var mergeFilterConds=[];params.mergePlayerStrikes.forEach(function(i){"row"===d.type?mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:d.name,filterCol:""}):mergeFilterConds.push({isFilter:!0,unalteredStrikeNum:i,mergeStrikeNum:strikeNum,filterRowType:"nbp",filterColType:"nbp",filterRow:"",filterCol:d.name})});var _groupNumIter7=params.drawnStrikeNumArray.slice(params.strikeViewFinder.strikeStartIndex,params.strikeViewFinder.strikeEndIndex+1);updateCellCircles(null,mergeFilterConds,_groupNumIter7)}},oneStrikeGroupWidth=(BPColLabels.length+SPLabels.length-.5)*cellSize+matrixInterval+matrixInterval2;params.realStrikeWidth=(BPColLabels.length+SPLabels.length-.5)*cellSize+matrixInterval2;var BPMapStartY=isOdd?4*margin.top:4*margin.top+(BPRowLabels.length+STLabels.length)*cellSize+2*matrixInterval;strikeNum>=0?svg.attr("transform","translate("+(margin.left+strikeNum*oneStrikeGroupWidth)+","+BPMapStartY+")"):strikeNum==-2?svg.attr("transform","translate("+(margin.left+mergeStartValue*oneStrikeGroupWidth)+","+BPMapStartY+")"):strikeNum==-1&&svg.attr("transform","translate("+(margin.left+(mergeStartValue+1)*oneStrikeGroupWidth)+","+BPMapStartY+")");var BPMapTran=[0,0],histogramYScale=null;if(void 0==params.switchAttrCond&&strikeNum!=-2&&0!=strikeNum){var tableWidth=cellSize*BPRowLabels.length*Math.sqrt(2),tableInterval=cellSize/3,tableBPMapInterval=2*cellSize,tableCellWidth=(tableWidth-tableInterval)/(2*Math.sqrt(BPRowLabels.length)),tableCellHeight=tableCellWidth-2,tmpA=tableCellHeight*Math.sqrt(BPRowLabels.length),tmpB=tableBPMapInterval+cellSize*BPRowLabels.length/Math.sqrt(2),tableTran=[BPMapTran[0]+(tmpA+tmpB)/Math.sqrt(2),BPMapTran[1]-(tmpA+tmpB)/Math.sqrt(2)];isOdd||(tableTran[0]=BPMapTran[0]+tmpB/Math.sqrt(2),tableTran[1]=BPMapTran[1]+tmpB/Math.sqrt(2)+BPRowLabels.length*cellSize);var tableGroup=svg.append("g").attr("id","tableGroup-"+strikeNum).attr("transform","translate("+tableTran[0]+","+tableTran[1]+") rotate("+(isOdd?45:-45)+")"),tableMatrix=matrices[strikeNum].tableMatrix,maxTableCircleValue=params.maxTableCellValue,baseIncremental=(tableWidth/2-cellSize/(2*Math.sqrt(2))+tableBPMapInterval)/Math.sqrt(2),histoWidth=cellSize/Math.sqrt(2)-2;strikeNum>=0&&(histogramYScale=d3.scaleLinear().domain([0,maxTableCircleValue]).range([0,15]),params.histogramYScale=histogramYScale),strikeNum<0&&(histogramYScale=d3.scaleLinear().domain([0,params.maxTableCellValueMerge]).range([0,15]),params.histogramYScaleMerge=histogramYScale);var histogramTrans=[BPMapTran[0]+cellSize/2+baseIncremental,BPMapTran[1]-baseIncremental];isOdd||(histogramTrans[1]=BPMapTran[1]+baseIncremental+cellSize*BPRowLabels.length);var tableMap=tableGroup.append("g").attr("class","tablemap").selectAll(".cellg").data(tableMatrix,function(d){return d.type+":"+d.row+":"+d.col}).enter(),toArc=(tableMap.append("rect").attr("x",function(d){return"col"===d.type?d.row*tableCellWidth:isOdd?(d.row+Math.sqrt(BPRowLabels.length))*tableCellWidth+tableInterval:(Math.sqrt(BPColLabels.length)-1-d.row+Math.sqrt(BPRowLabels.length))*tableCellWidth+tableInterval}).attr("y",function(d){return isOdd||!isOdd&&"col"===d.type?(Math.sqrt(BPRowLabels.length)-1-d.col)*tableCellHeight:d.col*tableCellHeight}).attr("class",function(d){return"tableCell cr"+d.row+" cc"+d.col}).attr("id",function(d){return"rect-"+d.type+"-"+d.name+"-"+strikeNum}).attr("width",tableCellWidth).attr("height",tableCellHeight).style("stroke",function(d){if(strikeNum>=0)return isOdd?"row"===d.type?oddColor:evenColor:"row"===d.type?evenColor:oddColor;if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return"row"===d.type?params.p1Color:params.p2Color;if("B"===params.mergeFirstPlayer)return"row"===d.type?params.p2Color:params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).style("stroke-width","2px").style("stroke-opacity",params.transitLinks?0:1).style("fill",function(d){return"white"}),tableMap.append("circle").attr("id",function(d){return"circle-"+d.type+"-"+d.name+"-"+strikeNum}).attr("cx",function(d){return"col"===d.type?d.row*tableCellWidth+tableCellWidth/2:isOdd?(d.row+Math.sqrt(BPRowLabels.length))*tableCellWidth+tableInterval+tableCellWidth/2:(Math.sqrt(BPColLabels.length)-1-d.row+Math.sqrt(BPRowLabels.length))*tableCellWidth+tableInterval+tableCellWidth/2}).attr("cy",function(d){return isOdd||!isOdd&&"col"===d.type?(Math.sqrt(BPRowLabels.length)-1-d.col)*tableCellHeight+tableCellHeight/2:d.col*tableCellHeight+tableCellHeight/2}).attr("r",function(d){return radiusScale(d.value)}).style("fill",function(d){if(strikeNum>=0)return isOdd?"row"===d.type?oddColor:evenColor:"row"===d.type?evenColor:oddColor;if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return"row"===d.type?params.p1Color:params.p2Color;if("B"===params.mergeFirstPlayer)return"row"===d.type?params.p2Color:params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).style("opacity",0),function(value){return value/180*Math.PI}),linksGroupHT=tableGroup.append("g").attr("id","linksGroupHT-"+strikeNum).attr("transform","rotate("+(isOdd?-45:45)+") translate("+-tableTran[0]+","+-tableTran[1]+")"),linksRow=linksGroupHT.selectAll(".linksRow").data(tableMatrix,function(d){return d.type+"-"+d.name+"-"+d.row+"-"+d.col}).enter();linksRow.append("line").attr("class",function(d){return"row"===d.type?"linksRow":"linksCol"}).attr("x1",function(d,i){return"row"===d.type?BPMapTran[0]+cellSize*BPColLabels.length:BPMapTran[0]+cellSize*(2*BPColLabels.indexOf(d.name)+1)/2}).attr("y1",function(d,i){return"col"===d.type?isOdd?BPMapTran[1]:BPMapTran[1]+BPRowLabels.length*cellSize:BPMapTran[1]+cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2}).each(function(d,i){var cx=parseFloat(document.getElementById("circle-"+d.type+"-"+d.name+"-"+strikeNum).getAttribute("cx")),cy=parseFloat(document.getElementById("circle-"+d.type+"-"+d.name+"-"+strikeNum).getAttribute("cy")),R=Math.sqrt(cx*cx+cy*cy),angle=isOdd?Math.atan(cy/cx)+toArc(45):toArc(45)-Math.atan(cy/cx),mycx=tableTran[0]+R*Math.cos(angle),mycy=isOdd?tableTran[1]+R*Math.sin(angle):tableTran[1]-R*Math.sin(angle);(isOdd||!isOdd&&"col"==d.type)&&i%Math.sqrt(BPRowLabels.length)>=1||!isOdd&&"row"==d.type&&i%Math.sqrt(BPRowLabels.length)<=0?(this.setAttribute("x2",mycx),isOdd?"row"===d.type?this.setAttribute("y2",BPMapTran[1]+cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2-(mycx-BPMapTran[0]-cellSize*BPColLabels.length)):this.setAttribute("y2",BPMapTran[1]-(mycx-BPMapTran[0]-cellSize*(2*BPColLabels.indexOf(d.name)+1)/2)):"row"===d.type?this.setAttribute("y2",BPMapTran[1]+cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2+(mycx-BPMapTran[0]-cellSize*BPColLabels.length)):this.setAttribute("y2",BPMapTran[1]+cellSize*BPRowLabels.length+(mycx-BPMapTran[0]-cellSize*(2*BPColLabels.indexOf(d.name)+1)/2))):(this.setAttribute("y2",mycy),isOdd?"row"===d.type?this.setAttribute("x2",BPMapTran[0]+cellSize*BPColLabels.length+(BPMapTran[1]+cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2-mycy)):this.setAttribute("x2",BPMapTran[0]+cellSize*(2*BPColLabels.indexOf(d.name)+1)/2+(BPMapTran[1]-mycy)):"row"===d.type?this.setAttribute("x2",BPMapTran[0]+cellSize*BPColLabels.length+(mycy-BPMapTran[1]-cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2)):this.setAttribute("x2",BPMapTran[0]+cellSize*(2*BPColLabels.indexOf(d.name)+1)/2+(mycy-BPMapTran[1]-BPRowLabels.length*cellSize)))}).style("stroke",function(d){if(strikeNum>=0)return isOdd?"row"===d.type?oddColor:evenColor:"row"===d.type?evenColor:oddColor;if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return"row"===d.type?params.p1Color:params.p2Color;if("B"===params.mergeFirstPlayer)return"row"===d.type?params.p2Color:params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).style("stroke-width","1px").style("stroke-opacity",params.transitLinks?0:1).on("mouseover",tableMouseOver).on("mouseout",function(d){mouseLeave(strikeNum<0)}),linksRow.append("line").attr("class",function(d){return"row"===d.type?"linksRow":"linksCol"}).each(function(d,i){var cx=parseFloat(document.getElementById("circle-"+d.type+"-"+d.name+"-"+strikeNum).getAttribute("cx")),cy=parseFloat(document.getElementById("circle-"+d.type+"-"+d.name+"-"+strikeNum).getAttribute("cy")),R=Math.sqrt(cx*cx+cy*cy),angle=isOdd?Math.atan(cy/cx)+toArc(45):toArc(45)-Math.atan(cy/cx),mycx=tableTran[0]+R*Math.cos(angle),mycy=isOdd?tableTran[1]+R*Math.sin(angle):tableTran[1]-R*Math.sin(angle);this.setAttribute("x2",mycx),this.setAttribute("y2",mycy),(isOdd||!isOdd&&"col"==d.type)&&i%Math.sqrt(BPRowLabels.length)>=1||!isOdd&&"row"==d.type&&i%Math.sqrt(BPRowLabels.length)<=0?(this.setAttribute("x1",mycx),isOdd?"row"===d.type?this.setAttribute("y1",BPMapTran[1]+cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2-(mycx-BPMapTran[0]-cellSize*BPColLabels.length)):this.setAttribute("y1",BPMapTran[1]-(mycx-BPMapTran[0]-cellSize*(2*BPColLabels.indexOf(d.name)+1)/2)):"row"===d.type?this.setAttribute("y1",BPMapTran[1]+cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2+(mycx-BPMapTran[0]-cellSize*BPColLabels.length)):this.setAttribute("y1",BPMapTran[1]+cellSize*BPRowLabels.length+(mycx-BPMapTran[0]-cellSize*(2*BPColLabels.indexOf(d.name)+1)/2))):(this.setAttribute("y1",mycy),isOdd?"row"===d.type?this.setAttribute("x1",BPMapTran[0]+cellSize*BPColLabels.length+(BPMapTran[1]+cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2-mycy)):this.setAttribute("x1",BPMapTran[0]+cellSize*(2*BPColLabels.indexOf(d.name)+1)/2+(BPMapTran[1]-mycy)):"row"===d.type?this.setAttribute("x1",BPMapTran[0]+cellSize*BPColLabels.length+(mycy-BPMapTran[1]-cellSize*(2*BPRowLabels.indexOf(d.name)+1)/2)):this.setAttribute("x1",BPMapTran[0]+cellSize*(2*BPColLabels.indexOf(d.name)+1)/2+(mycy-BPMapTran[1]-BPRowLabels.length*cellSize)))}).style("stroke",function(d){if(strikeNum>=0)return isOdd?"row"===d.type?oddColor:evenColor:"row"===d.type?evenColor:oddColor;if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return"row"===d.type?params.p1Color:params.p2Color;if("B"===params.mergeFirstPlayer)return"row"===d.type?params.p2Color:params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).style("stroke-width","1px").style("stroke-opacity",params.transitLinks?0:1);var tableMap_cover=tableGroup.append("g").attr("class","tablemap_cover").on("mouseleave",function(d){mouseLeave(strikeNum<0)}).selectAll(".cellg").data(tableMatrix,function(d){return d.type+":"+d.row+":"+d.col}).enter();tableMap_cover.append("rect").attr("x",function(d){return"col"===d.type?d.row*tableCellWidth:isOdd?(d.row+Math.sqrt(BPRowLabels.length))*tableCellWidth+tableInterval:(Math.sqrt(BPColLabels.length)-1-d.row+Math.sqrt(BPRowLabels.length))*tableCellWidth+tableInterval}).attr("y",function(d){return isOdd||!isOdd&&"col"===d.type?(Math.sqrt(BPRowLabels.length)-1-d.col)*tableCellHeight:d.col*tableCellHeight}).attr("width",tableCellWidth).attr("height",tableCellHeight).attr("class","cover").style("opacity",0).on("mouseover",function(d){tableMouseOver(d),tip.show(d)}).on("mouseout",function(d){tip.hide(d)}),svg.append("g").attr("id","histogram-"+strikeNum).attr("transform","translate("+histogramTrans[0]+","+histogramTrans[1]+") rotate("+(isOdd?45:-45)+")").selectAll(".histogramBar").data(tableMatrix,function(d){return d.type+"-"+d.row+"-"+d.col}).enter().append("rect").attr("x",function(d){var row=d.row,col=d.col;isOdd||"row"!==d.type||(row=Math.sqrt(BPRowLabels.length)-1-row,col=Math.sqrt(BPRowLabels.length)-1-col);var trans=(3*row+col)*cellSize/Math.sqrt(2)-histoWidth/2;return"row"===d.type&&(trans+=tableCellWidth*Math.sqrt(BPRowLabels.length)+tableInterval/2),trans}).attr("y",function(d){return isOdd?0:-histogramYScale(d.value)}).attr("width",histoWidth).attr("height",function(d){return histogramYScale(d.value)}).style("opacity",0).attr("fill",function(d){if(strikeNum>=0)return isOdd?"row"===d.type?oddColor:evenColor:"row"===d.type?evenColor:oddColor;
if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return"row"===d.type?params.p1Color:params.p2Color;if("B"===params.mergeFirstPlayer)return"row"===d.type?params.p2Color:params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).on("mouseover",tableMouseOver).on("mouseout",function(d){mouseLeave(strikeNum<0)})}var ST_BPMatrix=matrices[strikeNum].ST_BPMatrix,ST_BPMapTran=[BPMapTran[0],BPMapTran[1]+cellSize*BPRowLabels.length+matrixInterval];isOdd||(ST_BPMapTran[1]=BPMapTran[1]-matrixInterval-cellSize*STLabels.length);var BP_SPMatrix=matrices[strikeNum].BP_SPMatrix,BP_SPMapTran=[ST_BPMapTran[0]+cellSize*BPColLabels.length+matrixInterval2-.5*cellSize,ST_BPMapTran[1]+cellSize*STLabels.length+matrixInterval];isOdd||(BP_SPMapTran[1]=ST_BPMapTran[1]-matrixInterval-cellSize*BPColLabels.length);var ST_SPMatrix=matrices[strikeNum].ST_SPMatrix,ST_SPMapTran=[BP_SPMapTran[0],ST_BPMapTran[1]],bgRectY=BPMapTran[1]+cellSize*(BPRowLabels.length-1)+matrixInterval,bgRectWidth=cellSize*(BPColLabels.length+SPLabels.length+1.5)+matrixInterval2,bgRectHeight=cellSize*(STLabels.length+BPColLabels.length+.5)+matrixInterval+cellSize;isOdd||(bgRectY=BPMapTran[1]-matrixInterval+cellSize-bgRectHeight),svg.append("g").attr("id","bgRect-"+strikeNum).append("rect").attr("x",BPMapTran[0]-cellSize).attr("y",bgRectY).attr("width",bgRectWidth).attr("height",bgRectHeight).attr("stroke","none").attr("fill","grey").attr("opacity",.4);var ST_BPMapGroup=svg.append("g").attr("id","ST_BPMapGroup-"+strikeNum).attr("transform","translate("+ST_BPMapTran[0]+","+ST_BPMapTran[1]+")"),lineLength=4.4*cellSize;strikeNum<0&&(lineLength="AB"===params.mergeFirstPlayer?6*cellSize:5*cellSize);var labelStart=1.4*cellSize,labelInterval=.4*-cellSize,labelUpTran=-cellSize/10,labelDownTran=7*cellSize/8;ST_BPMapGroup.append("line").attr("x1",labelStart).attr("y1",0).attr("x2",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y2",-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_BPMapGroup.append("line").attr("x1",0).attr("y1",labelStart).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_BPMapGroup.append("line").attr("x1",0).attr("y1",0).attr("x2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.cos(Math.PI/4)).attr("y2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_BPMapGroup.append("line").attr("x1",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y1",-lineLength*Math.sin(Math.PI/4)).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_BPMapGroup.append("text").text(function(){var name="Pla";return"st"===params.switchAttrCond?name="Tech":"sp"===params.switchAttrCond&&(name="Pos"),name=params.T.t(name),strikeNum>=0?name+(strikeNum+1):strikeNum==-1?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P2":"P1"):strikeNum==-2?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P1":"P2"):void 0}).attr("x",labelInterval).attr("y",labelUpTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)"),ST_BPMapGroup.append("text").text(function(){var name="Tech";return"st"===params.switchAttrCond?name="Pla":"sp"===params.switchAttrCond&&(name="Tech"),name=params.T.t(name),strikeNum>=0?name+(strikeNum+1):strikeNum==-1?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P2":"P1"):strikeNum==-2?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P1":"P2"):void 0}).attr("x",labelInterval).attr("y",labelDownTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)");var ST_BPMap=ST_BPMapGroup.append("g").attr("class","ST_BPMap").on("mouseleave",function(d){mouseLeave(strikeNum<0)}).selectAll(".cellg").data(ST_BPMatrix,function(d){return d.row+":"+d.col}).enter(),BP_SPMapGroup=(ST_BPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("class",function(d){return"cell cell-border cr"+d.row+" cc"+d.col}).attr("width",cellSize).attr("height",cellSize).style("stroke","grey").style("stroke-width","1px").style("fill",function(d){return"white"}),ST_BPMap.append("circle").attr("cx",function(d){return d.col*cellSize+cellSize/2}).attr("cy",function(d){return d.row*cellSize+cellSize/2}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("opacity",0).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),ST_BPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("width",cellSize).attr("height",cellSize).attr("class","cover").style("opacity",0).on("mouseover",function(d){ST_BPMapMouseOver(d),tip.show(d)}).on("mouseout",function(d){tip.hide(d)}),svg.append("g").attr("id","BP_SPMapGroup-"+strikeNum).attr("transform","translate("+BP_SPMapTran[0]+","+BP_SPMapTran[1]+")"));lineLength=strikeNum>=0?4.2*cellSize:"AB"===params.mergeFirstPlayer?6*cellSize:5*cellSize,BP_SPMapGroup.append("line").attr("x1",labelStart).attr("y1",0).attr("x2",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y2",-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),BP_SPMapGroup.append("line").attr("x1",0).attr("y1",labelStart).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),BP_SPMapGroup.append("line").attr("x1",0).attr("y1",0).attr("x2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.cos(Math.PI/4)).attr("y2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.sin(Math.PI/4)).attr("stroke","grey"),BP_SPMapGroup.append("line").attr("x1",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y1",-lineLength*Math.sin(Math.PI/4)).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),BP_SPMapGroup.append("text").text(function(){var name="Pos";return"st"===params.switchAttrCond?name="Pos":"sp"===params.switchAttrCond&&(name="Pla"),name=params.T.t(name),strikeNum>=0?name+(strikeNum+1):strikeNum==-1?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P2":"P1"):strikeNum==-2?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P1":"P2"):void 0}).attr("x",labelInterval).attr("y",labelUpTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)"),BP_SPMapGroup.append("text").text(function(){var name="Pla";return"st"===params.switchAttrCond?name="Tech":"sp"===params.switchAttrCond&&(name="Pos"),name=params.T.t(name),strikeNum>=0?name+(strikeNum+1):strikeNum==-1?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P2":"P1"):strikeNum==-2?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P1":"P2"):void 0}).attr("x",labelInterval).attr("y",labelDownTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)");var BP_SPMap=BP_SPMapGroup.append("g").attr("class","BP_SPMap").on("mouseleave",function(d){mouseLeave(strikeNum<0)}).selectAll(".cellg").data(BP_SPMatrix,function(d){return d.row+":"+d.col}).enter(),ST_SPMapGroup=(BP_SPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("class",function(d){return"cell cell-border cr"+d.row+" cc"+d.col}).attr("width",cellSize).attr("height",cellSize).style("stroke","grey").style("stroke-width","1px").style("fill",function(d){return"white"}),BP_SPMap.append("circle").attr("cx",function(d){return d.col*cellSize+cellSize/2}).attr("cy",function(d){return d.row*cellSize+cellSize/2}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("fill",function(d){return colorScale(d.scoreCount/d.value)}).style("opacity",0),BP_SPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("width",cellSize).attr("height",cellSize).attr("class","cover").style("opacity",0).on("mouseover",function(d){BP_SPMapMouseOver(d),tip.show(d)}).on("mouseout",function(d){tip.hide(d)}),svg.append("g").attr("id","ST_SPMapGroup-"+strikeNum).attr("transform","translate("+ST_SPMapTran[0]+","+ST_SPMapTran[1]+")"));lineLength=strikeNum>=0?4.5*cellSize:"AB"===params.mergeFirstPlayer?6*cellSize:5*cellSize,ST_SPMapGroup.append("line").attr("x1",labelStart).attr("y1",0).attr("x2",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y2",-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_SPMapGroup.append("line").attr("x1",0).attr("y1",labelStart).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_SPMapGroup.append("line").attr("x1",0).attr("y1",0).attr("x2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.cos(Math.PI/4)).attr("y2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_SPMapGroup.append("line").attr("x1",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y1",-lineLength*Math.sin(Math.PI/4)).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),ST_SPMapGroup.append("text").text(function(){var name="Pos";return"st"===params.switchAttrCond?name="Pos":"sp"===params.switchAttrCond&&(name="Pla"),name=params.T.t(name),strikeNum>=0?name+(strikeNum+1):strikeNum==-1?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P2":"P1"):strikeNum==-2?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P1":"P2"):void 0}).attr("x",labelInterval).attr("y",labelUpTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)"),ST_SPMapGroup.append("text").text(function(){var name="Tech";return"st"===params.switchAttrCond?name="Pla":"sp"===params.switchAttrCond&&(name="Tech"),name=params.T.t(name),strikeNum>=0?name+(strikeNum+1):strikeNum==-1?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P2":"P1"):strikeNum==-2?name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P1":"P2"):void 0}).attr("x",labelInterval).attr("y",labelDownTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)");var ST_SPMap=ST_SPMapGroup.append("g").attr("class","ST_SPMap").on("mouseleave",function(d){mouseLeave(strikeNum<0)}).selectAll(".cellg").data(ST_SPMatrix,function(d){return d.row+":"+d.col}).enter();ST_SPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("class",function(d){return"cell cell-border cr"+d.row+" cc"+d.col}).attr("width",cellSize).attr("height",cellSize).style("stroke","grey").style("stroke-width","1px").style("fill",function(d){return"white"}),ST_SPMap.append("circle").attr("cx",function(d){return d.col*cellSize+cellSize/2}).attr("cy",function(d){return d.row*cellSize+cellSize/2}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("opacity",0).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),ST_SPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("width",cellSize).attr("height",cellSize).attr("class","cover").style("opacity",0).on("mouseover",function(d){ST_SPMapMouseOver(d),tip.show(d)}).on("mouseout",function(d){tip.hide(d)});ST_SPMapGroup.append("g").attr("id","ST_SPMapRowLabels-"+strikeNum).selectAll(".rowLabelg").data(STLabels).enter().append("text").text(function(d){return d.length>=3?params.T.t(d.substr(0,3)):params.T.t(d)}).attr("x",0).attr("y",function(d,i){return i*cellSize}).style("text-anchor","end").style("font-size",cellSize/12+"em").style("font-weight","bold").style("fill","black").style("font-family","arial").attr("transform","translate(-15,"+cellSize/1.5+")").attr("class",function(d,i){return"rowLabel r"+i}).on("mouseover",function(d){void 0==params.switchAttrCond?tip.show({labelType:"ST",labelText:d}):"st"==params.switchAttrCond?tip.show({labelType:"BP",labelText:d}):"sp"==params.switchAttrCond&&tip.show({labelType:"ST",labelText:d}),d3.select(this).style("fill","red"),STSPLabelsMouseOver({type:"row",name:d})}).on("mouseout",function(d){tip.hide(d),d3.select(this).style("fill","black"),mouseLeave(strikeNum<0)}),ST_SPMapGroup.append("g").attr("id","ST_SPMapColLabels-"+strikeNum).selectAll(".colLabelg").data(SPLabels).enter().append("text").text(function(d){return d.length>=3?params.T.t(d.substr(0,3)):params.T.t(d)}).attr("x",function(d,i){return strikeNum%2===1?i*cellSize+5:i*cellSize-5}).attr("y",0).style("text-anchor",isOdd?"end":"start").style("font-size",cellSize/12+"em").style("font-weight","bold").style("fill","black").style("font-family","arial").attr("transform",function(d,i){return isOdd?"translate("+cellSize+","+(cellSize*STLabels.length+3+12)+") rotate(-90,"+i*cellSize+", 0)":"translate("+cellSize+","+-15+") rotate(-90,"+i*cellSize+", 0)"}).attr("class",function(d,i){return"colLabel c"+i}).on("mouseover",function(d){void 0==params.switchAttrCond?tip.show({labelType:"SP",labelText:d}):"st"==params.switchAttrCond?tip.show({labelType:"SP",labelText:d}):"sp"==params.switchAttrCond&&tip.show({labelType:"BP",labelText:d}),d3.select(this).style("fill","red"),STSPLabelsMouseOver({type:"col",name:d})}).on("mouseout",function(d){tip.hide(d),d3.select(this).style("fill","black"),mouseLeave(strikeNum<0)});var squareTran=[ST_BPMapTran[0]+cellSize/2,ST_BPMapTran[1]+STLabels.length*cellSize+STBP_RectInterval],squareWidth=cellSize*(BPRowLabels.length-1);isOdd||(squareTran[1]=ST_BPMapTran[1]-STBP_RectInterval-squareWidth);var squareGroup=svg.append("g").attr("id","squareGroup-"+strikeNum),linksBtwMatrices=[];BPColLabels.forEach(function(d,i){var startX=BPMapTran[0]+(2*i+1)*cellSize/2,startY=BPMapTran[1]+cellSize*BPRowLabels.length,endX=startX,endY=startY+matrixInterval;isOdd||(startY=BPMapTran[1],endY=startY-matrixInterval),strikeNum!=-2&&0!=strikeNum&&linksBtwMatrices.push({startX:startX,startY:startY,endX:endX,endY:endY,colName:d,className:"BP_STBPLink"}),isOdd?(startY+=matrixInterval+STLabels.length*cellSize,endY=startY+STBP_RectInterval+i*cellSize):(startY-=matrixInterval+STLabels.length*cellSize,endY=startY-STBP_RectInterval-i*cellSize),linksBtwMatrices.push({startX:startX,startY:startY,endX:endX,endY:endY,colName:d,className:"STBP_RectLink"}),startY=endY,endX=BP_SPMapTran[0],linksBtwMatrices.push({startX:startX,startY:startY,endX:endX,endY:endY,colName:d,className:"rect_BPSPLink"}),isEnd||strikeNum!=-1&&(startX=BP_SPMapTran[0]+SPLabels.length*cellSize,endX=startX+matrixInterval,linksBtwMatrices.push({startX:startX,startY:startY,endX:endX,endY:startY,colName:d,className:"endLink"}))}),squareGroup.selectAll(".links").data(linksBtwMatrices).enter().append("line").attr("class",function(d){return d.className}).attr("x1",function(d){return d.startX}).attr("x2",function(d){return d.endX}).attr("y1",function(d){return d.startY}).attr("y2",function(d){return d.endY}).style("stroke-opacity",params.transitLinks?0:1).attr("stroke",function(){if(strikeNum>=0)return isOdd?evenColor:oddColor;if(strikeNum==-2){if("A"===params.mergeFirstPlayer)return params.p1Color;if("B"===params.mergeFirstPlayer)return params.p2Color;if("AB"===params.mergeFirstPlayer)return"grey"}else if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return params.p2Color;if("B"===params.mergeFirstPlayer)return params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).attr("stroke-width","1px"),squareGroup.append("rect").attr("x",squareTran[0]).attr("y",squareTran[1]).attr("width",squareWidth).attr("height",squareWidth).attr("id","squareGroupStrokeRect").attr("stroke",function(){if(strikeNum>=0)return isOdd?evenColor:oddColor;if(strikeNum==-2){if("A"===params.mergeFirstPlayer)return params.p1Color;if("B"===params.mergeFirstPlayer)return params.p2Color;if("AB"===params.mergeFirstPlayer)return"grey"}else if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return params.p2Color;if("B"===params.mergeFirstPlayer)return params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).attr("stroke-width",3).attr("fill","white").style("opacity",params.transitLinks?0:1).style("stroke-opacity",params.transitLinks?0:1);var maxRectWhiteArea=7,rectWhiteArea=.5*cellSize;rectWhiteArea>maxRectWhiteArea&&(rectWhiteArea=maxRectWhiteArea),squareGroup.append("rect").attr("x",squareTran[0]+rectWhiteArea).attr("y",squareTran[1]+rectWhiteArea).attr("width",squareWidth-2*rectWhiteArea).attr("height",squareWidth-2*rectWhiteArea).attr("id","squareGroupFillRect").attr("stroke","none").attr("stroke-width",0).attr("fill",function(){if(strikeNum>=0)return isOdd?evenColor:oddColor;if(strikeNum==-2){if("A"===params.mergeFirstPlayer)return params.p1Color;if("B"===params.mergeFirstPlayer)return params.p2Color;if("AB"===params.mergeFirstPlayer)return"grey"}else if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return params.p2Color;if("B"===params.mergeFirstPlayer)return params.p1Color;if("AB"===params.mergeFirstPlayer)return"grey"}}).style("opacity",params.transitLinks?0:1),squareGroup.append("text").text(function(){if(strikeNum>=0)return strikeNum+1;if(strikeNum==-2){if("A"===params.mergeFirstPlayer)return"P1";if("B"===params.mergeFirstPlayer)return"P2";if("AB"===params.mergeFirstPlayer)return"P1&P2"}else if(strikeNum==-1){if("A"===params.mergeFirstPlayer)return"P2";if("B"===params.mergeFirstPlayer)return"P1";if("AB"===params.mergeFirstPlayer)return"P1&P2"}}).attr("x",squareTran[0]+squareWidth/2).attr("y",squareTran[1]+squareWidth/2).attr("class","strikeNum").attr("stroke","none").style("fill","white").style("text-anchor","middle").style("alignment-baseline","central").style("font-size",function(){var scaleFactor=1;return"st"===params.switchAttrCond?scaleFactor=.8:"sp"===params.switchAttrCond&&(scaleFactor=3),strikeNum>=0?cellSize/1.5/scaleFactor+"em":"A"===params.mergeFirstPlayer?cellSize/2/scaleFactor+"em":"B"===params.mergeFirstPlayer?cellSize/2/scaleFactor+"em":"AB"===params.mergeFirstPlayer?cellSize/5/scaleFactor+"em":void 0}).style("font-family","arial").on("mouseover",function(d){d3.select(this).classed("text-hover",!0)}).on("mouseout",function(d){d3.select(this).classed("text-hover",!1)});var BPLabelsNewNames={sl:"sb",sm:"sm",sr:"sf",ml:"hb",mm:"hm",mr:"hf",ll:"lb",lm:"lm",lr:"lf"};if(strikeNum!=-2&&0!=strikeNum){var BPMapGroup=svg.append("g").attr("id","BPMapGroup-"+strikeNum).attr("transform","translate("+BPMapTran[0]+","+BPMapTran[1]+")");lineLength=strikeNum>=0?4.45*cellSize:"AB"===params.mergeFirstPlayer?6.3*cellSize:5.2*cellSize,BPMapGroup.append("line").attr("x1",labelStart).attr("y1",0).attr("x2",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y2",-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),BPMapGroup.append("line").attr("x1",0).attr("y1",labelStart).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),BPMapGroup.append("line").attr("x1",0).attr("y1",0).attr("x2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.cos(Math.PI/4)).attr("y2",-(lineLength-labelStart*Math.sqrt(2)/2)*Math.sin(Math.PI/4)).attr("stroke","grey"),BPMapGroup.append("line").attr("x1",labelStart-lineLength*Math.cos(Math.PI/4)).attr("y1",-lineLength*Math.sin(Math.PI/4)).attr("x2",-lineLength*Math.cos(Math.PI/4)).attr("y2",labelStart-lineLength*Math.sin(Math.PI/4)).attr("stroke","grey"),BPMapGroup.append("text").text(function(){var name="Pla";return"st"===params.switchAttrCond?name="Tech":"sp"===params.switchAttrCond&&(name="Pos"),name=params.T.t(name),strikeNum>=0?name+(strikeNum+1):name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P2":"P1")}).attr("x",labelInterval-5).attr("y",labelUpTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)"),BPMapGroup.append("text").text(function(){var name="Pla";return"st"===params.switchAttrCond?name="Tech":"sp"===params.switchAttrCond&&(name="Pos"),name=params.T.t(name),strikeNum>=0?name+strikeNum:name+("AB"===params.mergeFirstPlayer?"P1P2":"A"===params.mergeFirstPlayer?"P1":"P2")}).attr("x",labelInterval-5).attr("y",labelDownTran).style("text-anchor","end").style("font-size",cellSize/12+"em").style("fill","black").style("font-family","arial").attr("transform","translate(0,0) rotate(45)"),BPMapGroup.append("g").attr("id","BPMapRowLabels-"+strikeNum).selectAll(".rowLabelg").data(BPRowLabels).enter().append("text").text(function(d){return void 0==params.switchAttrCond?params.T.t(BPLabelsNewNames[d]):d.length>=3?params.T.t(d.substr(0,3)):params.T.t(d)}).attr("x",-3).attr("y",function(d,i){return i*cellSize}).style("text-anchor","end").style("font-size",cellSize/12+"em").style("font-weight","bold").style("fill","black").style("font-family","arial").attr("transform","translate(0,"+cellSize/1.5+")").attr("class",function(d,i){return"strike-"+strikeNum+" rowLabel r"+i}).on("mouseover",function(d){void 0==params.switchAttrCond?tip.show({labelType:"BP",labelText:d}):"st"==params.switchAttrCond?tip.show({labelType:"ST",labelText:d}):"sp"==params.switchAttrCond&&tip.show({labelType:"SP",labelText:d}),d3.select(this).style("fill","red"),BPLabelsMouseOver({type:"row",name:d})}).on("mouseout",function(d){tip.hide(d),d3.select(this).style("fill","black"),mouseLeave(strikeNum<0)}),BPMapGroup.append("g").attr("id","BPMapColLabels-"+strikeNum).selectAll(".colLabelg").data(BPColLabels).enter().append("text").text(function(d){return void 0==params.switchAttrCond?params.T.t(BPLabelsNewNames[d]):d.length>=3?params.T.t(d.substr(0,3)):params.T.t(d)}).attr("x",function(d,i){return i*cellSize}).attr("y",0).style("text-anchor",isOdd?"end":"start").style("font-size",cellSize/12+"em").style("font-weight","bold").style("fill","black").style("font-family","arial").attr("transform",function(d,i){return isOdd?"translate("+cellSize+","+cellSize*(BPColLabels.length+.5)+") rotate(-90,"+i*cellSize+", 0)":"translate("+cellSize+","+-cellSize/2+") rotate(-90,"+i*cellSize+", 0)"}).attr("class",function(d,i){return"strike-"+strikeNum+" colLabel c"+i}).on("mouseover",function(d){void 0==params.switchAttrCond?tip.show({labelType:"BP",labelText:d}):"st"==params.switchAttrCond?tip.show({labelType:"ST",labelText:d}):"sp"==params.switchAttrCond&&tip.show({labelType:"SP",labelText:d}),d3.select(this).style("fill","red"),BPLabelsMouseOver({type:"col",name:d})}).on("mouseout",function(d){tip.hide(d),d3.select(this).style("fill","black"),mouseLeave(strikeNum<0)});var BPMap=BPMapGroup.append("g").attr("class","BPMap").on("mouseleave",function(d){mouseLeave(strikeNum<0)}).selectAll(".cell").data(BPMatrix,function(d){return d.row+":"+d.col}).enter();BPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("class",function(d){return"cell cr"+d.row+" cc"+d.col}).attr("width",cellSize).attr("height",cellSize).style("stroke","grey").style("stroke-width","1px").style("fill",function(d){return"white"}),BPMap.append("circle").attr("cx",function(d){return d.col*cellSize+cellSize/2}).attr("cy",function(d){return d.row*cellSize+cellSize/2}).attr("r",function(d){return 0==d.value?0:radiusScale(d.value)}).style("opacity",0).style("fill",function(d){return colorScale(d.scoreCount/d.value)}),BPMap.append("rect").attr("x",function(d){return d.col*cellSize}).attr("y",function(d){return d.row*cellSize}).attr("width",cellSize).attr("height",cellSize).attr("class","cover").style("opacity",0).on("mouseover",function(d){BPMapMouseOver(d),tip.show(d)}).on("mouseout",function(d){tip.hide(d)})}params.vm.showCircleOpacity(params),strikeNum<0&&updateCellCircles(null)}},{key:"renderSlider",value:function(params){var svg=params.svg,renderStatGroup=params.vm.renderStatGroup,oneGroupWidth=params.oneGroupWidth,totalGroupsWidth=(params.totalStrikeNum,oneGroupWidth*params.totalStrikeNum+2*params.marginLeft),width=params.width,height=params.height,rectWidth=width/totalGroupsWidth*width;if(!(totalGroupsWidth<width)){var rectHeight=10;svg.select("#statBottomSliderGroup").remove();var bottomSlider=svg.append("g").attr("id","statBottomSliderGroup").attr("transform","translate(0,"+(height-rectHeight)+")");bottomSlider.append("rect").attr("id","statBottomSliderBackground").attr("x",0).attr("y",0).attr("width",rectWidth).attr("height",rectHeight).attr("stroke","none").style("fill","white").attr("opacity",1),bottomSlider.append("rect").attr("id","statBottomSlider").attr("x",0).attr("y",0).attr("rx",5).attr("ry",5).attr("width",rectWidth).attr("height",rectHeight).attr("stroke","none").style("fill","grey").attr("opacity",1);var g=d3.select("#statViewGroup"),rectDrag=d3.drag();rectDrag.on("drag",function(){var current_translate=g.attr("transform").substring(g.attr("transform").indexOf("(")+1,g.attr("transform").indexOf(")")).split(","),dx=parseFloat(current_translate[0])-d3.event.dx*(totalGroupsWidth-width)/(width-rectWidth);dx>0&&(dx=0);var minX=-(totalGroupsWidth-width);dx<minX&&(dx=minX),g.attr("transform","translate("+dx+",30)scale(1)");var currentTranslateRect=parseFloat(d3.select("#statBottomSlider").attr("x")),dxRect=currentTranslateRect+d3.event.dx;dxRect<0&&(dxRect=0);var maxX=params.width-parseFloat(d3.select("#statBottomSlider").attr("width"));dxRect>maxX&&(dxRect=maxX),d3.select("#statBottomSlider").attr("x",dxRect);var x0=-dx,x1=x0+width,strikeStartIndex=Math.ceil((x0-params.marginLeft)/params.oneGroupWidth)-1;strikeStartIndex<0&&(strikeStartIndex=0);var strikeEndIndex=Math.ceil((x1-params.marginLeft)/params.oneGroupWidth)-1;params.strikeViewFinder={strikeStartIndex:strikeStartIndex,strikeEndIndex:strikeEndIndex};var finderNum=params.strikeViewFinder.strikeEndIndex+1;if(params.realDrawnStrikeNum<params.totalStrikeNum||params.realDrawnStrikeNum<finderNum){var newRealDrawn=void 0;newRealDrawn=params.totalStrikeNum<finderNum?params.totalStrikeNum:params.realDrawnStrikeNum<finderNum?finderNum:params.realDrawnStrikeNum;for(var iter=params.realDrawnStrikeNum;iter<newRealDrawn;iter++)params.highlightConds[iter]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},renderStatGroup(iter,params,iter===params.totalStrikeNum-1);params.realDrawnStrikeNum=newRealDrawn}}).on("end",function(){}),d3.select("#statBottomSlider").call(rectDrag)}}},{key:"renderStaticParts",value:function(params){var vm=this,mergeStrikes=(params.vm.preprocess,params.vm.renderStatGroup,params.vm.mergeStrikes),renderMergeStrikes=params.vm.renderMergeStrikes,renderSplitStrikes=params.vm.renderSplitStrikes,oneGroupWidth=(params.svg,params.oneGroupWidth);oneGroupWidth*params.totalStrikeNum+2*params.marginLeft,params.width,params.height;params.vm.renderSlider(params);var updateFunc=params.vm.updateFunc,getGameRec=params.vm.getGameRec,switchPlayerBtnP1=d3.select("#statViewSwitchPlayerBtnP1");switchPlayerBtnP1.on("click",function(d){switchPlayerBtnP1.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewSwitchPlayerBtnGroup button").attr("class","btn switchBtn"),switchPlayerBtnP1.attr("class","btn switchBtn choose"),vm.servePlayerCond="A",params.servePlayerCond="A",params.transitLinks=!0,params.transitRects=!1,updateFunc(params),splitBtn.attr("class","btn switchBtn choose"),mergeBtn.attr("class","btn switchBtn"))});var switchPlayerBtnP1P2=d3.select("#statViewSwitchPlayerBtnP1P2");switchPlayerBtnP1P2.on("click",function(d){switchPlayerBtnP1P2.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewSwitchPlayerBtnGroup button").attr("class","btn switchBtn"),switchPlayerBtnP1P2.attr("class","btn switchBtn choose"),vm.servePlayerCond="AB",params.servePlayerCond="AB",params.transitLinks=!0,params.transitRects=!1,updateFunc(params),splitBtn.attr("class","btn switchBtn choose"),mergeBtn.attr("class","btn switchBtn"))});var switchPlayerBtnP2=d3.select("#statViewSwitchPlayerBtnP2");switchPlayerBtnP2.on("click",function(d){switchPlayerBtnP2.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewSwitchPlayerBtnGroup button").attr("class","btn switchBtn"),switchPlayerBtnP2.attr("class","btn switchBtn choose"),vm.servePlayerCond="B",params.servePlayerCond="B",params.transitLinks=!0,params.transitRects=!1,updateFunc(params),splitBtn.attr("class","btn switchBtn choose"),mergeBtn.attr("class","btn switchBtn"))}),switchPlayerBtnP2.attr("class","btn switchBtn"),switchPlayerBtnP1P2.attr("class","btn switchBtn"),switchPlayerBtnP1.attr("class","btn switchBtn"),"A"===params.servePlayerCond?switchPlayerBtnP1.attr("class","btn switchBtn choose"):"B"===params.servePlayerCond?switchPlayerBtnP2.attr("class","btn switchBtn choose"):switchPlayerBtnP1P2.attr("class","btn switchBtn choose");var splitBtn=d3.select("#statViewSplitBtn");splitBtn.on("click",function(d){splitBtn.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewMergeSplitGroup button").attr("class","btn switchBtn"),splitBtn.attr("class","btn switchBtn choose"),renderSplitStrikes(params),params.hasDrawnMerge=!1)});var mergeFunc=function(player){var mergeStartValue=parseInt(document.getElementById("mergeStart").value)-1,mergeEndValue=parseInt(document.getElementById("mergeEnd").value)-1;if("end"===document.getElementById("mergeEnd").value&&(mergeEndValue=params.realTotalStrikeNum),!isNaN(mergeStartValue)&&!isNaN(mergeEndValue)&&mergeStartValue<mergeEndValue&&mergeEndValue<params.totalStrikeNum&&mergeStartValue>=0){params.mergeStartValue=mergeStartValue,params.mergeEndValue=mergeEndValue,params.mergeFirstPlayer=player;var mergeResults=mergeStrikes(params);params.matrices[-2]=mergeResults.mergeMatrices,params.matrices[-1]=mergeResults.mergeMatrices2,renderMergeStrikes(params)}else alert("input error!")},mergeBtn=d3.select("#statViewMergeBtn");mergeBtn.on("click",function(d){mergeBtn.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewMergeSplitGroup button").attr("class","btn switchBtn"),mergeBtn.attr("class","btn switchBtn choose"),mergeFunc("A"))}),splitBtn.attr("class","btn switchBtn choose"),mergeBtn.attr("class","btn switchBtn");var attrPlaBtn=d3.select("#attrPlaBtn");attrPlaBtn.on("click",function(d){attrPlaBtn.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewAttrBtnGroup button").attr("class","btn switchBtn"),attrPlaBtn.attr("class","btn switchBtn choose"),params.labels.BPRowLabels=["sl","sm","sr","ml","mm","mr","ll","lm","lr"],params.labels.BPColLabels=params.labels.BPRowLabels.map(function(d){return d}).reverse(),params.labels.SPLabels=["forehand","sideways","anti-sideways","backhand","ser"],params.labels.STLabels=["ser","loo","qui","smas","fli","cho","dro","blo","cut","par","lob"],params.transitLinks=!0,params.transitRects=!0,vm.switchAttrCond=void 0,params.switchAttrCond=void 0,params.gameRec=getGameRec(params),updateFunc(params,params.vm.resolve))});var attrPosBtn=d3.select("#attrPosBtn");attrPosBtn.on("click",function(d){attrPosBtn.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewAttrBtnGroup button").attr("class","btn switchBtn"),attrPosBtn.attr("class","btn switchBtn choose"),params.labels.BPRowLabels=["forehand","sideways","anti-sideways","backhand","ser"],params.labels.BPColLabels=params.labels.BPRowLabels.map(function(d){return d}).reverse(),params.labels.SPLabels=["sl","sm","sr","ml","mm","mr","ll","lm","lr"],params.labels.STLabels=["ser","loo","qui","smas","fli","cho","dro","blo","cut","par","lob"],params.transitLinks=!0,params.transitRects=!0,vm.switchAttrCond="sp",params.switchAttrCond="sp",params.gameRec=getGameRec(params),updateFunc(params,params.vm.resolve))});var attrTechBtn=d3.select("#attrTechBtn");
attrTechBtn.on("click",function(d){attrTechBtn.attr("class").indexOf("choose")>-1||(d3.selectAll("#statViewAttrBtnGroup button").attr("class","btn switchBtn"),attrTechBtn.attr("class","btn switchBtn choose"),params.labels.BPRowLabels=["ser","loo","qui","smas","fli","cho","dro","blo","cut","par","lob"],params.labels.BPColLabels=params.labels.BPRowLabels.map(function(d){return d}).reverse(),params.labels.STLabels=["sl","sm","sr","ml","mm","mr","ll","lm","lr"],params.labels.SPLabels=["forehand","sideways","anti-sideways","backhand","ser"],params.transitLinks=!0,params.transitRects=!0,vm.switchAttrCond="st",params.switchAttrCond="st",params.gameRec=getGameRec(params),updateFunc(params,params.vm.resolve))}),"sp"===params.switchAttrCond?(attrPlaBtn.attr("class","btn switchBtn"),attrTechBtn.attr("class","btn switchBtn"),attrPosBtn.attr("class","btn switchBtn choose")):"st"===params.switchAttrCond?(attrPlaBtn.attr("class","btn switchBtn"),attrTechBtn.attr("class","btn switchBtn choose"),attrPosBtn.attr("class","btn switchBtn")):(attrPlaBtn.attr("class","btn switchBtn choose"),attrTechBtn.attr("class","btn switchBtn"),attrPosBtn.attr("class","btn switchBtn"))}},{key:"mergeStrikes",value:function(params){for(var start=params.mergeStartValue,end=params.mergeEndValue,mergeFirstPlayer=params.mergeFirstPlayer,BPRowLabels=params.labels.BPRowLabels.map(function(d){return d}),BPColLabels=params.labels.BPColLabels.map(function(d){return d}),STLabels=params.labels.STLabels,SPLabels=params.labels.SPLabels,mergeMatricesObj={ST_BPMatrix:{},BP_SPMatrix:{},ST_SPMatrix:{}},mergeMatrices={ST_BPMatrix:[],BP_SPMatrix:[],ST_SPMatrix:[]},mergeMatricesObj2={BPMatrix:{},ST_BPMatrix:{},BP_SPMatrix:{},ST_SPMatrix:{},tableMatrix:{row:{},col:{}}},mergeMatrices2={BPMatrix:[],ST_BPMatrix:[],BP_SPMatrix:[],ST_SPMatrix:[],tableMatrix:[]},i=0;i<BPRowLabels.length;i++){mergeMatricesObj2.BPMatrix[BPRowLabels[i]]={};for(var j=0;j<BPColLabels.length;j++)mergeMatricesObj2.BPMatrix[BPRowLabels[i]][BPColLabels[j]]={row:i,col:j,value:0,scoreCount:0}}for(var _i13=0;_i13<STLabels.length;_i13++){mergeMatricesObj.ST_BPMatrix[STLabels[_i13]]={},mergeMatricesObj2.ST_BPMatrix[STLabels[_i13]]={};for(var _j11=0;_j11<BPColLabels.length;_j11++)mergeMatricesObj.ST_BPMatrix[STLabels[_i13]][BPColLabels[_j11]]={row:_i13,col:_j11,value:0,scoreCount:0},mergeMatricesObj2.ST_BPMatrix[STLabels[_i13]][BPColLabels[_j11]]={row:_i13,col:_j11,value:0,scoreCount:0}}for(var _i14=0;_i14<BPColLabels.length;_i14++){mergeMatricesObj.BP_SPMatrix[BPColLabels[_i14]]={},mergeMatricesObj2.BP_SPMatrix[BPColLabels[_i14]]={};for(var _j12=0;_j12<SPLabels.length;_j12++)mergeMatricesObj.BP_SPMatrix[BPColLabels[_i14]][SPLabels[_j12]]={row:BPColLabels.length-1-_i14,col:_j12,value:0,scoreCount:0},mergeMatricesObj2.BP_SPMatrix[BPColLabels[_i14]][SPLabels[_j12]]={row:_i14,col:_j12,value:0,scoreCount:0}}for(var _i15=0;_i15<STLabels.length;_i15++){mergeMatricesObj.ST_SPMatrix[STLabels[_i15]]={},mergeMatricesObj2.ST_SPMatrix[STLabels[_i15]]={};for(var _j13=0;_j13<SPLabels.length;_j13++)mergeMatricesObj.ST_SPMatrix[STLabels[_i15]][SPLabels[_j13]]={row:_i15,col:_j13,value:0,scoreCount:0},mergeMatricesObj2.ST_SPMatrix[STLabels[_i15]][SPLabels[_j13]]={row:_i15,col:_j13,value:0,scoreCount:0}}BPRowLabels.forEach(function(d,i){mergeMatricesObj2.tableMatrix.row[d]={name:d,type:"row",value:0,scoreCount:0,row:Math.floor(i/Math.sqrt(BPRowLabels.length)),col:i%Math.sqrt(BPRowLabels.length)}}),BPColLabels.forEach(function(d,i){mergeMatricesObj2.tableMatrix.col[d]={name:d,type:"col",value:0,scoreCount:0,row:Math.floor(i/Math.sqrt(BPColLabels.length)),col:i%Math.sqrt(BPColLabels.length)}}),params.mergePlayerStrikes=[],params.mergePlayer2Strikes=[];for(var _loop2=function(strike){var servePlayer=params.servePlayerCond,hitPlayer=(strike+1)%2==1?servePlayer:"A"===servePlayer?"B":"A";"AB"!==hitPlayer&&mergeFirstPlayer.indexOf(hitPlayer)==-1||(params.mergePlayerStrikes.push(strike),params.mergePlayer2Strikes.push(strike+1),Object.keys(mergeMatricesObj2).forEach(function(matrixName){var matrixOrigin=params.matrices[strike][matrixName],matrixOrigin2=params.matrices[strike+1][matrixName],matrixMergeObj=mergeMatricesObj[matrixName],matrixMergeObj2=mergeMatricesObj2[matrixName];"BPMatrix"===matrixName?matrixOrigin.forEach(function(cellData){matrixMergeObj2[cellData.rowName][cellData.colName].value+=cellData.value,matrixMergeObj2[cellData.rowName][cellData.colName].scoreCount+=cellData.scoreCount}):"tableMatrix"===matrixName?matrixOrigin.forEach(function(cellData){matrixMergeObj2[cellData.type][cellData.name].value+=cellData.value,matrixMergeObj2[cellData.type][cellData.name].scoreCount+=cellData.scoreCount}):(matrixOrigin.forEach(function(cellData){matrixMergeObj[cellData.rowName][cellData.colName].value+=cellData.value,matrixMergeObj[cellData.rowName][cellData.colName].scoreCount+=cellData.scoreCount}),matrixOrigin2.forEach(function(cellData){matrixMergeObj2[cellData.rowName][cellData.colName].value+=cellData.value,matrixMergeObj2[cellData.rowName][cellData.colName].scoreCount+=cellData.scoreCount}))}))},strike=start;strike<end;strike++)_loop2(strike);Object.keys(mergeMatricesObj).forEach(function(matrixName){var matrixMergeObj=mergeMatricesObj[matrixName],matrixMerge=mergeMatrices[matrixName];Object.keys(matrixMergeObj).forEach(function(row){Object.keys(matrixMergeObj[row]).forEach(function(col){matrixMerge.push({row:matrixMergeObj[row][col].row,col:matrixMergeObj[row][col].col,value:matrixMergeObj[row][col].value,scoreCount:matrixMergeObj[row][col].scoreCount,rowName:row,colName:col})})})}),Object.keys(mergeMatricesObj2).forEach(function(matrixName){var matrixMergeObj=mergeMatricesObj2[matrixName],matrixMerge=mergeMatrices2[matrixName];"tableMatrix"!==matrixName?Object.keys(matrixMergeObj).forEach(function(row){Object.keys(matrixMergeObj[row]).forEach(function(col){matrixMerge.push({row:matrixMergeObj[row][col].row,col:matrixMergeObj[row][col].col,value:matrixMergeObj[row][col].value,scoreCount:matrixMergeObj[row][col].scoreCount,rowName:row,colName:col})})}):(Object.keys(matrixMergeObj.row).forEach(function(row){matrixMerge.push({row:matrixMergeObj.row[row].row,col:matrixMergeObj.row[row].col,value:matrixMergeObj.row[row].value,scoreCount:matrixMergeObj.row[row].scoreCount,type:"row",name:row})}),Object.keys(matrixMergeObj.col).forEach(function(col){matrixMerge.push({row:matrixMergeObj.col[col].row,col:matrixMergeObj.col[col].col,value:matrixMergeObj.col[col].value,scoreCount:matrixMergeObj.col[col].scoreCount,type:"col",name:col})}))});var tmpMax=Math.max.apply(Math,mergeMatrices2.BPMatrix.concat(mergeMatrices2.BP_SPMatrix).concat(mergeMatrices2.ST_BPMatrix).concat(mergeMatrices2.ST_SPMatrix).concat(mergeMatrices.BP_SPMatrix).concat(mergeMatrices.ST_BPMatrix).concat(mergeMatrices.ST_SPMatrix).map(function(d){return d.value}));tmpMax>params.maxCellValueMerge&&(params.maxCellValueMerge=tmpMax);var tmpMaxTableCircleValue=Math.max.apply(Math,mergeMatrices2.tableMatrix.map(function(d){return d.value}));return params.maxTableCellValueMerge=tmpMaxTableCircleValue,{mergeMatrices:mergeMatrices,mergeMatrices2:mergeMatrices2,mergeMatricesObj:mergeMatricesObj,mergeMatricesObj2:mergeMatricesObj2}}},{key:"renderSplitStrikes",value:function(params){for(var start=params.mergeStartValue,end=params.mergeEndValue,circleUpdateTime=500,finishOnEnd=!1,_loop3=function(i){d3.select("#statViewGroup"+i).selectAll("g").transition().duration(circleUpdateTime).style("opacity",0).on("end",function(d){d3.select("#statViewGroup"+i).style("display","none"),finishOnEnd||!function(){var finishOnEndInside=!1;d3.select("#statViewGroup-2").remove(),d3.select("#statViewGroup-1").remove(),d3.select("#mergeSwitchPlayerBtn").remove();for(var transGroupCount=end-start-1,transSubX=params.oneGroupWidth*transGroupCount,strike=end;strike<params.totalStrikeNum;strike++){var g=d3.select("#statViewGroup"+strike),current_translate=g.attr("transform").substring(g.attr("transform").indexOf("(")+1,g.attr("transform").indexOf(")")).split(","),currentX=parseFloat(current_translate[0]),currentY=parseFloat(current_translate[1]),tranX=currentX+transSubX;g.transition().duration(circleUpdateTime).attr("transform","translate("+tranX+","+currentY+")").on("end",function(){if(!finishOnEndInside){for(var iter=start;iter<=end;iter++)d3.select("#statViewGroup"+iter).style("display","block"),d3.select("#statViewGroup"+iter).selectAll("g").transition().duration(circleUpdateTime).style("opacity",1).on("end",function(d){});0!=start&&d3.select("#statViewGroup"+(start-1)).select("#squareGroup-"+(start-1)).selectAll(".endLink").transition().duration(circleUpdateTime).style("stroke-opacity",1),finishOnEndInside=!0}})}finishOnEnd=!0,params.drawnStrikeNumArray=[];for(var _i16=0;_i16<params.totalStrikeNum;_i16++)params.drawnStrikeNumArray.push(_i16)}()})},i=-2;i<=-1;i++)_loop3(i)}},{key:"renderMergeStrikes",value:function(params){for(var renderMergeButtons=params.vm.renderMergeButtons,renderStatGroup=params.vm.renderStatGroup,start=params.mergeStartValue,end=params.mergeEndValue,circleUpdateTime=500,finishOnEnd=!1,iter=params.realDrawnStrikeNum;iter<params.totalStrikeNum;iter++)params.highlightConds[iter]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},renderStatGroup(iter,params,iter===params.totalStrikeNum-1);if(params.realDrawnStrikeNum=params.totalStrikeNum,params.hasDrawnMerge){var iterArray=[];iterArray.push(-2),iterArray.push(-1);var finishOnEndElse=!1;iterArray.forEach(function(i){d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0).on("end",function(){if(!finishOnEndElse){d3.select("#statViewGroup-2").remove(),d3.select("#statViewGroup-1").remove(),params.vm.renderStatGroup(-2,params,!1),params.vm.renderStatGroup(-1,params,!1),renderMergeButtons(params);for(var _i18=-2;_i18<=-1;_i18++)d3.select("#statViewGroup"+_i18).transition().duration(0).style("opacity",1);finishOnEndElse=!0}}),d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#histogram-"+i).selectAll("rect").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#squareGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("stroke-opacity",0),d3.select("#squareGroup-"+i).selectAll("#squareGroupStrokeRect").transition().duration(circleUpdateTime).style("stroke-opacity",0).style("opacity",0),d3.select("#squareGroup-"+i).selectAll("#squareGroupFillRect").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#linksGroupHT-"+i).selectAll("line").transition().duration(circleUpdateTime).style("stroke-opacity",0),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("rect.tableCell").transition().duration(circleUpdateTime).style("stroke-opacity",0)})}else{params.vm.renderStatGroup(-2,params,!1),params.vm.renderStatGroup(-1,params,!1);for(var _loop4=function(i){d3.select("#statViewGroup"+i).selectAll("g").transition().duration(circleUpdateTime).style("opacity",0).on("end",function(d){d3.select("#statViewGroup"+i).style("display","none"),finishOnEnd||!function(){for(var finishOnEndInside=!1,transGroupCount=end-start-1,transSubX=params.oneGroupWidth*transGroupCount,strike=end;strike<params.totalStrikeNum;strike++){var g=d3.select("#statViewGroup"+strike),current_translate=g.attr("transform").substring(g.attr("transform").indexOf("(")+1,g.attr("transform").indexOf(")")).split(","),currentX=parseFloat(current_translate[0]),currentY=parseFloat(current_translate[1]),tranX=currentX-transSubX;g.transition().duration(circleUpdateTime).attr("transform","translate("+tranX+","+currentY+")").on("end",function(){finishOnEndInside||!function(){for(var finishOnEndBtn=!1,_i17=-2;_i17<=-1;_i17++)d3.select("#statViewGroup"+_i17).transition().duration(circleUpdateTime).style("opacity",1).on("end",function(){finishOnEndBtn||(renderMergeButtons(params),finishOnEndBtn=!0)});params.hasDrawnMerge=!0,finishOnEndInside=!0}()})}0!=start&&d3.select("#statViewGroup"+(start-1)).select("#squareGroup-"+(start-1)).selectAll(".endLink").transition().duration(circleUpdateTime).style("stroke-opacity",0),finishOnEnd=!0}()})},i=start;i<=end;i++)_loop4(i);params.drawnStrikeNumArray.splice(start,end-start+1,-2,-1)}}},{key:"renderMergeButtons",value:function(params){d3.select("#mergeSwitchPlayerBtn").remove();var renderMergeStrikes=params.vm.renderMergeStrikes,mergeStrikes=params.vm.mergeStrikes,g=d3.select("#statViewGroup-2"),current_translate=g.attr("transform").substring(g.attr("transform").indexOf("(")+1,g.attr("transform").indexOf(")")).split(","),currentX=parseFloat(current_translate[0]),currentY=parseFloat(current_translate[1]),realStrikeWidth=(params.width,params.realStrikeWidth),btnWidth=realStrikeWidth/3,btnHeight=20,switchPlayerBtns=d3.select("#statViewGroup").append("g").attr("id","mergeSwitchPlayerBtn").attr("transform","translate("+currentX+","+currentY+")"),mergeFunc=function(player){var mergeStartValue=parseInt(document.getElementById("mergeStart").value)-1,mergeEndValue=parseInt(document.getElementById("mergeEnd").value)-1;if(!isNaN(mergeStartValue)&&!isNaN(mergeEndValue)&&mergeStartValue<mergeEndValue&&mergeEndValue<params.totalStrikeNum&&mergeStartValue>=0){params.mergeStartValue=mergeStartValue,params.mergeEndValue=mergeEndValue,params.mergeFirstPlayer=player;var mergeResults=mergeStrikes(params);params.matrices[-2]=mergeResults.mergeMatrices,params.matrices[-1]=mergeResults.mergeMatrices2,renderMergeStrikes(params)}};switchPlayerBtns.append("rect").attr("id","mergeSwitchPlayerBtnP1").attr("x",0).attr("y",0).attr("rx",5).attr("ry",5).attr("width",btnWidth+5).attr("height",btnHeight).style("fill","A"===params.mergeFirstPlayer?"#666666":"#aaaaaa").style("cursor","pointer").attr("opacity",1).on("click",function(d){d3.select("#mergeSwitchPlayerBtnP1").transition().duration(0).style("fill","#666666"),d3.select("#mergeSwitchPlayerBtnP2").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP1P2").transition().duration(0).style("fill","#aaaaaa"),mergeFunc("A")}),switchPlayerBtns.append("text").text(params.T.t("P1")).attr("id","mergeSwitchPlayerBtnP1Text").attr("x",btnWidth/2).attr("y",btnHeight/2).style("fill","white").style("cursor","pointer").attr("opacity",1).style("text-anchor","middle").style("alignment-baseline","central").style("font-size","1em").style("font-weight","bold").style("font-family","Arial Rounded").on("click",function(d){d3.select("#mergeSwitchPlayerBtnP1").transition().duration(0).style("fill","#666666"),d3.select("#mergeSwitchPlayerBtnP2").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP1P2").transition().duration(0).style("fill","#aaaaaa"),mergeFunc("A")}),switchPlayerBtns.append("rect").attr("id","mergeSwitchPlayerBtnP1P2").attr("x",2*btnWidth-5).attr("y",0).attr("rx",5).attr("ry",5).attr("width",btnWidth+5).attr("height",btnHeight).style("fill","AB"===params.mergeFirstPlayer?"#666666":"#aaaaaa").style("cursor","pointer").attr("opacity",1).on("click",function(d){d3.select("#mergeSwitchPlayerBtnP1").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP2").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP1P2").transition().duration(0).style("fill","#666666"),mergeFunc("AB")}),switchPlayerBtns.append("text").text(params.T.t("P1-P2")).attr("id","mergeSwitchPlayerBtnP1P2Text").attr("x",2*btnWidth+btnWidth/2).attr("y",btnHeight/2).style("fill","white").style("cursor","pointer").attr("opacity",1).style("text-anchor","middle").style("alignment-baseline","central").style("font-size","1em").style("font-weight","bold").style("font-family","arial").on("click",function(d){d3.select("#mergeSwitchPlayerBtnP1").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP2").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP1P2").transition().duration(0).style("fill","#666666"),mergeFunc("AB")}),switchPlayerBtns.append("rect").attr("id","mergeSwitchPlayerBtnP2").attr("x",btnWidth).attr("y",0).attr("rx",0).attr("ry",0).attr("width",btnWidth).attr("height",btnHeight).style("fill","B"===params.mergeFirstPlayer?"#666666":"#aaaaaa").style("cursor","pointer").attr("opacity",1).on("click",function(d){d3.select("#mergeSwitchPlayerBtnP1").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP2").transition().duration(0).style("fill","#666666"),d3.select("#mergeSwitchPlayerBtnP1P2").transition().duration(0).style("fill","#aaaaaa"),mergeFunc("B")}),switchPlayerBtns.append("text").text(params.T.t("P2")).attr("id","mergeSwitchPlayerBtnP2Text").attr("x",btnWidth+btnWidth/2).attr("y",btnHeight/2).style("fill","white").style("cursor","pointer").attr("opacity",1).style("text-anchor","middle").style("alignment-baseline","central").style("font-size","1em").style("font-weight","bold").style("font-family","arial").on("click",function(d){d3.select("#mergeSwitchPlayerBtnP1").transition().duration(0).style("fill","#aaaaaa"),d3.select("#mergeSwitchPlayerBtnP2").transition().duration(0).style("fill","#666666"),d3.select("#mergeSwitchPlayerBtnP1P2").transition().duration(0).style("fill","#aaaaaa"),mergeFunc("B")})}},{key:"configure",value:function(){this.svg&&this.configureFlows()}},{key:"getTotalStrikeNum",value:function(strikes){return Math.max.apply(Math,strikes.map(function(d){return parseInt(d.strike.StrikeNo)}))}},{key:"getGameRec",value:function(params){var strikes=params.vm.strikes,switchAttrCond=params.switchAttrCond,gameRec={};return strikes.forEach(function(strikeObj,i){var gameNum=parseInt(strikeObj.gameNo),rallyNum=parseInt(strikeObj.rallyNo),strikeNum=parseInt(strikeObj.strikeNo);void 0==gameRec[gameNum]&&(gameRec[gameNum]={}),void 0==gameRec[gameNum][rallyNum]&&(gameRec[gameNum][rallyNum]={}),void 0===switchAttrCond?gameRec[gameNum][rallyNum][strikeNum]={bp:strikeObj.BallPosition2Axis(strikeObj.ballPosition),nbp:strikeObj.BallPosition2Axis(strikeObj.nextBallPosition),st:strikeObj.StrikeTech2Axis(strikeObj.strikeTech),sp:strikeObj.StrikePosition2Axis(strikeObj.strikePosition),isScore:strikeObj.isScore_,player:strikeObj.player,rawStrike:strikeObj}:"st"===switchAttrCond?gameRec[gameNum][rallyNum][strikeNum]={bp:strikeObj.StrikeTech2Axis(strikeObj.strikeTech),nbp:strikeObj.StrikeTech2Axis(strikeObj.nextStrikeTech),st:strikeObj.BallPosition2Axis(strikeObj.nextBallPosition),sp:strikeObj.StrikePosition2Axis(strikeObj.strikePosition),isScore:strikeObj.isScore_,player:strikeObj.player,rawStrike:strikeObj}:"sp"===switchAttrCond&&(gameRec[gameNum][rallyNum][strikeNum]={bp:strikeObj.StrikePosition2Axis(strikeObj.strikePosition),nbp:strikeObj.StrikePosition2Axis(strikeObj.nextStrikePosition),st:strikeObj.StrikeTech2Axis(strikeObj.strikeTech),sp:strikeObj.BallPosition2Axis(strikeObj.nextBallPosition),isScore:strikeObj.isScore_,player:strikeObj.player,rawStrike:strikeObj})}),gameRec}},{key:"updateFunc",value:function(params,resolve){for(var renderStatGroup=params.vm.renderStatGroup,iterArray=[],i=0;i<params.totalStrikeNum;i++)iterArray.push(i);iterArray.push(-2),iterArray.push(-1);var circleUpdateTime=500,finishOnEnd=!1;iterArray.forEach(function(i){d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0).on("end",function(d,i){if(!finishOnEnd){d3.select("#statViewGroup").selectAll("g").remove(),params.matrices=params.vm.preprocess({isFilter:!1},params).totalMatrix,void 0!=resolve?params.realDrawnStrikeNum=params.totalStrikeNum>6?6:params.totalStrikeNum:params.realDrawnStrikeNum=params.totalStrikeNum>params.strikeViewFinder.strikeEndIndex+2?params.strikeViewFinder.strikeEndIndex+2:params.totalStrikeNum;for(var iter=0;iter<params.realDrawnStrikeNum;iter++)params.highlightConds[iter]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},params.vm.renderStatGroup(iter,params,iter===params.totalStrikeNum-1,params.totalStrikeNum);if(params.highlightConds[-2]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},params.highlightConds[-1]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},d3.select("#statViewGroup").attr("drawn","true"),void 0!=resolve&&(resolve(params),params.realDrawnStrikeNum<params.totalStrikeNum||params.realDrawnStrikeNum<2*params.strikeViewFinder.strikeEndIndex))if(params.totalStrikeNum<2*params.strikeViewFinder.strikeEndIndex){for(var _iter=params.realDrawnStrikeNum;_iter<params.totalStrikeNum;_iter++)params.highlightConds[_iter]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},renderStatGroup(_iter,params,_iter===params.totalStrikeNum-1);params.realDrawnStrikeNum=params.totalStrikeNum}else if(params.realDrawnStrikeNum<2*params.strikeViewFinder.strikeEndIndex){for(var _iter2=params.realDrawnStrikeNum;_iter2<2*params.strikeViewFinder.strikeEndIndex;_iter2++)params.highlightConds[_iter2]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},renderStatGroup(_iter2,params,_iter2===params.totalStrikeNum-1);params.realDrawnStrikeNum=2*params.strikeViewFinder.strikeEndIndex}params.drawnStrikeNumArray=[];for(var _i19=0;_i19<params.totalStrikeNum;_i19++)params.drawnStrikeNumArray.push(_i19);params.hasDrawnMerge=!1,finishOnEnd=!0}}),d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("circle").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#histogram-"+i).selectAll("rect").transition().duration(circleUpdateTime).style("opacity",0),params.transitLinks&&(d3.select("#squareGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("stroke-opacity",0),d3.select("#squareGroup-"+i).selectAll("#squareGroupStrokeRect").transition().duration(circleUpdateTime).style("stroke-opacity",0).style("opacity",0),d3.select("#squareGroup-"+i).selectAll("#squareGroupFillRect").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#linksGroupHT-"+i).selectAll("line").transition().duration(circleUpdateTime).style("stroke-opacity",0),d3.select("#tableGroup-"+i).select(".tablemap").selectAll("rect.tableCell").transition().duration(circleUpdateTime).style("stroke-opacity",0)),params.transitRects&&(d3.select("#BPMapGroup-"+i).select(".BPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BPMapGroup-"+i).select("#BPMapRowLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BPMapGroup-"+i).select("#BPMapColLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_BPMapGroup-"+i).select(".ST_BPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_BPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_BPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BP_SPMapGroup-"+i).select(".BP_SPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BP_SPMapGroup-"+i).select("#BP_SPMapRowLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BP_SPMapGroup-"+i).select("#BP_SPMapColLabels-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BP_SPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#BP_SPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_SPMapGroup-"+i).select(".ST_SPMap").selectAll("rect.cell").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_SPMapGroup-"+i).selectAll("line").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#ST_SPMapGroup-"+i).selectAll("text").transition().duration(circleUpdateTime).style("opacity",0),d3.select("#bgRect-"+i).selectAll("rect").transition().duration(circleUpdateTime).style("opacity",0)),params.hasDrawnMerge&&d3.select("#mergeSwitchPlayerBtn").transition().duration(circleUpdateTime).style("opacity",0)})}},{key:"configureFlows",value:function(){var vm=this,width=document.getElementById("statisticView-SVG").parentNode.clientWidth,height=document.getElementById("statisticView-SVG").parentNode.clientHeight,params={};params.vm=vm,params.width=width,params.T=vm.T,params.height=height,params.marginLeft=50,params.realTotalStrikeNum=this.getTotalStrikeNum(vm.strikes);params.totalStrikeNum=params.realTotalStrikeNum;for(var drawnStrikeNumArray=[],i=0;i<params.totalStrikeNum;i++)drawnStrikeNumArray.push(i);params.drawnStrikeNumArray=drawnStrikeNumArray,vm.rally?params.servePlayerCond=vm.rally.strikes[0].player:params.servePlayerCond=vm.servePlayerCond,params.switchAttrCond=vm.switchAttrCond,params.p1Color="#33cccc",params.p2Color="#ff9933";var labels={BPRowLabels:["sl","sm","sr","ml","mm","mr","ll","lm","lr"],BPColLabels:["lr","lm","ll","mr","mm","ml","sr","sm","sl"],STLabels:["ser","loo","qui","smas","fli","cho","dro","blo","cut","par","lob"],SPLabels:["forehand","sideways","anti-sideways","backhand","ser"]};params.labels=labels,"sp"===params.switchAttrCond?(params.labels.BPRowLabels=["forehand","sideways","anti-sideways","backhand","ser"],params.labels.BPColLabels=params.labels.BPRowLabels.map(function(d){return d}).reverse(),params.labels.SPLabels=["sl","sm","sr","ml","mm","mr","ll","lm","lr"],params.labels.STLabels=["ser","loo","qui","smas","fli","cho","dro","blo","cut","par","lob"]):"st"===params.switchAttrCond&&(params.labels.BPRowLabels=["ser","loo","qui","smas","fli","cho","dro","blo","cut","par","lob"],params.labels.BPColLabels=params.labels.BPRowLabels.map(function(d){return d}).reverse(),params.labels.STLabels=["sl","sm","sr","ml","mm","mr","ll","lm","lr"],params.labels.SPLabels=["forehand","sideways","anti-sideways","backhand","ser"]),params.filterConds=[],params.highlightConds={},params.highlightCount=0,params.gameRec=this.getGameRec(params);var matrices=this.preprocess({isFilter:!1},params).totalMatrix;params.matrices=matrices,params.hasDrawnMerge=!1,params.transitLinks=!1,params.transitRects=!1,params.doFilter=!1;var svg=d3.select("#statisticView-SVG").attr("width",width).attr("height",height);svg.select("#statBottomSliderGroup").remove(),svg.select("#statViewGroup").attr("transform","translate(0,30)"),params.svg=svg;var resolve=function(params){var g=d3.select("#statViewGroup");if(g.attr("transform","translate(0,30)"),params.totalStrikeNum>1){params.oneGroupWidth=parseFloat(d3.select("#statViewGroup1").attr("transform").substring(g.attr("transform").indexOf("(")+1,g.attr("transform").indexOf(")")).split(",")[0])-parseFloat(d3.select("#statViewGroup0").attr("transform").substring(g.attr("transform").indexOf("(")+1,g.attr("transform").indexOf(")")).split(",")[0]);var strikeEndIndex=Math.ceil((width-params.marginLeft)/params.oneGroupWidth)-1;strikeEndIndex>params.totalStrikeNum-1&&(strikeEndIndex=params.totalStrikeNum-1),params.strikeViewFinder={strikeStartIndex:0,strikeEndIndex:strikeEndIndex}}else params.oneGroupWidth=void 0,params.strikeViewFinder={strikeStartIndex:0,strikeEndIndex:0};vm.renderStaticParts(params)};params.vm.resolve=resolve,params.realDrawnStrikeNum=params.totalStrikeNum>6?6:params.totalStrikeNum;var isDrawn=d3.select("#statViewGroup").attr("drawn");if("false"===isDrawn){d3.select("#statViewGroup").selectAll("g").remove();for(var iter=0;iter<params.realDrawnStrikeNum;iter++)params.highlightConds[iter]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},this.renderStatGroup(iter,params,iter===params.totalStrikeNum-1);if(params.highlightConds[-1]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},params.highlightConds[-2]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},d3.select("#statViewGroup").attr("drawn","true"),resolve(params),params.realDrawnStrikeNum<params.totalStrikeNum||params.realDrawnStrikeNum<2*params.strikeViewFinder.strikeEndIndex)if(params.totalStrikeNum<2*params.strikeViewFinder.strikeEndIndex){for(var _iter3=params.realDrawnStrikeNum;_iter3<params.totalStrikeNum;_iter3++)params.highlightConds[_iter3]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},this.renderStatGroup(_iter3,params,_iter3===params.totalStrikeNum-1);params.realDrawnStrikeNum=params.totalStrikeNum}else if(params.realDrawnStrikeNum<2*params.strikeViewFinder.strikeEndIndex){for(var _iter4=params.realDrawnStrikeNum;_iter4<2*params.strikeViewFinder.strikeEndIndex;_iter4++)params.highlightConds[_iter4]={BPMap:{row:[],col:[]},STBPMap:{row:[],col:[]},STSPMap:{row:[],col:[]},BPSPMap:{row:[],col:[]},tableMap:{row:[],col:[]}},this.renderStatGroup(_iter4,params,_iter4===params.totalStrikeNum-1);params.realDrawnStrikeNum=2*params.strikeViewFinder.strikeEndIndex}}else this.updateFunc(params,resolve)}},{key:"clickZoomin",value:function(){if("icon icon-zoom-in"===$("#icon-zoom").attr("class")){var dom=$("#statistic-view");dom.attr("class","fullscreen"),dom.find(".view-body").css("font-size","1.5em"),$("#icon-zoom").attr("class","icon icon-zoom-out"),$("#stroke-view").hide(),this.configure()}else{var _dom=$("#statistic-view");_dom.attr("class",""),_dom.find(".view-body").css("font-size","1em"),$("#icon-zoom").attr("class","icon icon-zoom-in"),$("#stroke-view").show(),this.configure()}}}]),StatisticViewController}();angular.module(app.applicationModuleName).controller("StatisticViewController",["Axis","VElement","T",StatisticViewController])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var StrokeViewController=function(){function StrokeViewController(Axis,VElement,T,$timeout){_classCallCheck(this,StrokeViewController),this.config={},this.VElement=VElement,this.$timeout=$timeout,this.strikeInfo={},Axis.call(this),this.T=T}return _createClass(StrokeViewController,[{key:"bindSvg",value:function(svg){this.svg=svg}},{key:"bindCallback",value:function(cb){this.callback=cb}},{key:"init",value:function(){var config=this.config;this.svg;config.margin=[30,50,30,50],config.tableStdWidth=1525,config.tableStdHeight=2740;var prefix="modules/core/client/img/hit/";config.SPimage={forehand:prefix+"forefore_white.png",backhand:prefix+"foreback_white.png",sideways:prefix+"backfore_white.png",anti_sideways:prefix+"backback_white.png"},config.attrLabel=["Ball Position","Strike Position","Strike Technique"],config.ballPositionTicks=["ser","sco","sl","sm","sr","ml","mm","mr","ll","lm","lr"],config.strikePositionTicks=["ser","sco","forehand","backhand","sideways","anti-sideways"],config.strikeTechTicks=["ser","loo","qui","sma","fli","cho","dro","blo","cut","par","lob","oth","sco","los"],config.ballPositionCellLabel=["lr","lm","ll","mr","mm","ml","sr","sm","sl","sco","ser"],config.strikePositionCellLabel=["anti-sideways","sideways","backhand","forehand","sco","ser"],config.strikeTechCellLabel=["los","sco","oth","lob","par","cut","blo","dro","cho","fli","sma","qui","loo","ser"],config.svg={width:0,height:0}}},{key:"configure",value:function(){this.svg&&(this.reconfigureSvg(),this.configureTable())}},{key:"reconfigureSvg",value:function(){var vm=this,svg=vm.svg,config=vm.config,height=svg[0].parentNode.clientHeight;config.svg.height=height}},{key:"configureTable",value:function(){var vm=this;if(!vm.rally)return void vm.hideView();vm.showView();var config=vm.config,height=vm.config.svg.height-config.margin[0]-config.margin[2],x=config.margin[3],y=config.margin[0],areaHeight=height,areaWidth=areaHeight/1.3,tableHeight=height,tableWidth=config.tableStdWidth/config.tableStdHeight*tableHeight;config.tableHeight=tableHeight,config.tableWidth=tableWidth,config.tennisNet={width:tableWidth+20,height:6};var strikeObjArray=vm.preprocess(vm.rally.strikes),TableArray=vm.dispatchTable(strikeObjArray);config.svg.width=areaWidth*TableArray.length+config.margin[2],TableArray.forEach(function(Table){Table.originX=x,Table.originY=y,Table.width=tableWidth,Table.height=tableHeight,vm.configureCell(Table,config.tennisNet),x+=areaWidth}),TableArray.forEach(function(Table){Table.strikes.forEach(function(strike,i){var bp=strike.bp,nbp=strike.nbp,player=strike.player,nplayer="A"===strike.player?"B":"A",bp_cell=Table["cell"+player+"map"].get(bp),nbp_cell=Table["cell"+nplayer+"map"].get(nbp);strike.nbp_cell=nbp_cell;var bpPos={x:bp_cell.centralX,y:bp_cell.centralY},nbpPos=void 0;if(nbp_cell&&(nbpPos={x:nbp_cell.centralX,y:nbp_cell.centralY}),bp_cell.strikes.length>1){var index=bp_cell.strikes.indexOf(strike);0===index?(bpPos.x-=9,i>=1&&(Table.strikes[i-1].nbpPos.x-=9)):1===index&&(bpPos.x+=9,i>=1&&(Table.strikes[i-1].nbpPos.x+=9))}strike.bpPos=bpPos,strike.nbpPos=nbpPos})}),TableArray.forEach(function(Table,t){Table.strikes.forEach(function(strike,i){strike.id="detail"+i+"in"+t;var bp=strike.bp,nbp=strike.nbp,player=strike.player,nplayer="A"===strike.player?"B":"A",nbp_cell=(Table["cell"+player+"map"].get(bp),Table["cell"+nplayer+"map"].get(nbp));if(strike.path={},nbp_cell)if(0===i)if(1===Table.strikes.length)if(Table.strikes[0].nbp){var controlDot=vm.setControlDot("m",strike);strike.path.controlDot=controlDot,strike.path.d=vm.calcPath(controlDot,strike,void 0,"m")}else;else{var curvePos=vm.posCompare(strike,Table.strikes[1],"next"),_controlDot=vm.setControlDot(curvePos,strike);strike.path.controlDot=_controlDot,strike.path.d=vm.calcPath(_controlDot,strike,Table.strikes[1],curvePos)}else{var _curvePos=vm.posCompare(strike,Table.strikes[i-1],"last"),_controlDot2=vm.setControlDot(_curvePos,strike);strike.path.controlDot=_controlDot2,strike.path.d=vm.calcPath(_controlDot2,strike,Table.strikes[i+1],_curvePos)}else;})}),vm.drawTable(TableArray),vm.drawDetails(TableArray)}},{key:"drawTable",value:function(TableArray){var svg=d3.select("#strokeSvg");if(null===svg.select("defs").node()){var defs=svg.append("defs"),arrowMarker_A=defs.append("marker").attr("id","arrowA").attr("markerUnits","strokeWidth").attr("markerWidth","8").attr("markerHeight","8").attr("viewBox","0 0 8 8").attr("refX","4").attr("refY","4").attr("orient","auto"),arrowMarker_B=defs.append("marker").attr("id","arrowB").attr("markerUnits","strokeWidth").attr("markerWidth","8").attr("markerHeight","8").attr("viewBox","0 0 8 8").attr("refX","4").attr("refY","4").attr("orient","auto"),arrow_path="M2,2 L6,4 L2,6 L4,4 L2,2";arrowMarker_A.append("path").attr("d",arrow_path),arrowMarker_B.append("path").attr("d",arrow_path)}svg.selectAll("g").transition().duration(1e3).attr("opacity","0").on("end",function(){this.remove()});var tables=svg.append("g").attr("opacity","0"),table=tables.selectAll("g").data(TableArray).enter().append("g").attr("class","table").attr("id",function(d,i){return"table"+i}),strikes=(table.append("rect").attr("class","tennisNet").attr("x",function(d){return d.originX-10}).attr("y",function(d){return d.originY+d.height/2-3}).attr("width",function(d){return d.width+20}).attr("height","6"),table.append("g").attr("class","cells_B").selectAll("rect").data(function(d){return d.cells_B}).enter().append("rect").attr("x",function(d){return d.x}).attr("y",function(d){return d.y}).attr("width",function(d){return d.width}).attr("height",function(d){return d.height}),table.append("g").attr("class","cells_A").selectAll("rect").data(function(d){return d.cells_A}).enter().append("rect").attr("x",function(d){return d.x}).attr("y",function(d){return d.y}).attr("width",function(d){return d.width}).attr("height",function(d){return d.height}),table.append("g").attr("class","strikes").selectAll("g").data(function(d){return d.strikes}).enter().append("g").attr("class",function(d){return d.player})),ball=(strikes.append("path").attr("class","arrowLine").attr("d",function(d){return d.path.d?d.path.d:""}).attr("marker-end",function(d){return"A"===d.player?"url(#arrowA)":"url(#arrowB)"}),strikes.append("g").attr("class","ball").on("mouseover",function(d){var dom=d3.select("#"+d.id),attr=dom.attr("class");attr.indexOf("lock")==-1&&d3.select("#"+d.id).attr("class","ball_g show")}).on("click",function(d){d3.select("#"+d.id).attr("class","ball_g show lock")}));ball.append("circle").attr("class","background").attr("cx",function(d){return d.bpPos.x}).attr("cy",function(d){return d.bpPos.y}).attr("r","7"),ball.append("text").attr("class","num").attr("x",function(d){return d.bpPos.x}).attr("y",function(d){return d.bpPos.y}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return d.strikeNum}),tables.transition().duration(1e3).attr("opacity","1")}},{key:"drawDetails",value:function(TableArray){var vm=this,svg=d3.select("#strokeSvg"),tables=svg.append("g"),table=tables.selectAll("g").data(TableArray).enter().append("g").attr("class","table"),strikes=table.append("g").attr("class","strikes").selectAll("g").data(function(d){return d.strikes}).enter().append("g").attr("class",function(d){return d.player}),ball_g=strikes.append("g").attr("class","ball_g hide").attr("id",function(d){return d.id}).on("mouseover",function(d){var dom=d3.select("#"+d.id),attr=dom.attr("class");attr.indexOf("lock")==-1&&d3.select("#"+d.id).attr("class","ball_g show")}).on("mouseout",function(d){var dom=d3.select("#"+d.id),attr=dom.attr("class");attr.indexOf("lock")==-1&&d3.select("#"+d.id).attr("class","ball_g hide")}).on("click",function(d){var dom=d3.select("#"+d.id),attr=dom.attr("class");attr.indexOf("lock")>-1?d3.select("#"+d.id).attr("class","ball_g hide"):dom.attr("class","ball_g show lock")}),angle=[-90,30,150],details=ball_g.append("g").attr("class","details").attr("transform",function(d){return"translate("+d.bpPos.x+", "+d.bpPos.y+")"}).selectAll("g").data(function(d){var array=[];return array.push({name:"st",cate:d.st}),array.push({name:"sp",cate:d.sp}),array.push({name:"effect",cate:d.effect}),array}).enter().append("g").attr("transform",function(d,i){return"rotate("+angle[i]+")translate(30, 0)"});details.append("line").attr("x1","0").attr("y1","0").attr("x2","-30").attr("y2","0");var circle=details.append("g").attr("class",function(d){return d.name}).attr("transform",function(d,i){return"rotate("+-angle[i]+")"});circle.append("circle").attr("class","back").attr("cx","0").attr("cy","0").attr("r","15"),circle.append("circle").attr("class","fore").attr("cx","0").attr("cy","0").attr("r","13"),ball_g.selectAll(".st").append("text").attr("x","0").attr("y","0").attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return vm.T.t(d.cate)}),ball_g.selectAll(".effect").append("text").attr("x","0").attr("y","0").attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return"L"+d.cate}),ball_g.selectAll(".sp").append("image").attr("x","-12").attr("y","-12").attr("width","24").attr("height","24").attr("xlink:href",function(d){return vm.config.SPimage[d.cate]});var ball=ball_g.append("g").attr("class","ball");ball.append("circle").attr("class","background").attr("cx",function(d){return d.bpPos.x}).attr("cy",function(d){return d.bpPos.y}).attr("r","8"),ball.append("text").attr("class","num").attr("x",function(d){return d.bpPos.x}).attr("y",function(d){return d.bpPos.y}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return d.strikeNum})}},{key:"setControlDot",value:function(curvePos,strike){if(!strike.nbp_cell)return"";var x1=strike.bpPos.x,y1=strike.bpPos.y,x2=strike.nbpPos.x,y2=strike.nbpPos.y,distance=Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2)),d=5*Math.log(distance),theta=Math.atan((x1-x2)/(y1-y2)),centralX=(x1+x2)/2,centralY=(y1+y2)/2,x=void 0,y=void 0;return"l"===curvePos?(x=centralX-d*Math.cos(theta),y=centralY+d*Math.sin(theta)):"r"===curvePos?(x=centralX+d*Math.cos(theta),y=centralY-d*Math.sin(theta)):(x=centralX,y=centralY),{x:x,y:y}}},{key:"posCompare",value:function(strike,strike2,option){var vm=this,LMRcompTable1={l_m:"r",l_r:"r",m_l:"l",m_r:"r",r_l:"l",r_m:"l"},LMRcompTable2={l_m:"l",l_r:"l",m_l:"r",m_r:"l",r_l:"r",r_m:"r"},SMLcompTable1={s_m:"l",s_l:"l",m_s:"r",m_l:"l",l_s:"r",l_m:"r"},SMLcompTable2={s_m:"r",s_l:"r",m_s:"l",m_l:"r",l_s:"l",l_m:"l"},pos=void 0,pos2=void 0,pubArea=void 0;"next"===option?(pos=strike.bp,pos2=strike2.nbp,pubArea=strike2.player):(pos=strike.nbp,pos2=strike2.bp,pubArea=strike.player);var pos_sml=pos.substr(0,1),pos_lmr=pos.substr(1,1),pos2_sml=pos2.substr(0,1),pos2_lmr=pos2.substr(1,1),dir=vm.directionJudge(strike);if("m"===dir){var dir2=vm.directionJudge(strike2);if(4===strike.strikeNum)return"A"===strike.player?"l":"r";if("m"!=dir2)return"m"}if(pos_lmr!=pos2_lmr)return"A"===pubArea?LMRcompTable1[pos_lmr+"_"+pos2_lmr]:LMRcompTable2[pos_lmr+"_"+pos2_lmr];if(pos_sml!=pos2_sml){var _dir=vm.directionJudge(strike2);return"m"===dir&&"m"===_dir?"A"===strike.player?"r":"l":"A"===pubArea&&"l"===dir||"B"===pubArea&&"r"===dir?SMLcompTable2[pos_sml+"_"+pos2_sml]:SMLcompTable1[pos_sml+"_"+pos2_sml]}return"r"===dir?"A"===strike.player?"l":"r":"A"===strike.player?"r":"l"}},{key:"calcPath",value:function(controlDot,strikeObj,strikeObj2,curvePos){var vm=this,x1=strikeObj.bpPos.x,y1=strikeObj.bpPos.y,x2_=strikeObj.nbpPos.x,y2_=strikeObj.nbpPos.y,x2=void 0,y2=void 0,endAdj=void 0;return endAdj=strikeObj2?vm.posCompare(strikeObj,strikeObj2,"next"):curvePos,y2="A"===strikeObj.player?y2_+11:y2_-11,x2="l"===endAdj?x2_-7:"r"===endAdj?x2_+7:x2_,"M"+x1+","+y1+" Q"+controlDot.x+","+controlDot.y+" "+x2+","+y2}},{key:"initTable",value:function(direction){var vm=this,TableObj={strikes:[],direction:direction};return vm.initCell(TableObj),TableObj}},{key:"initCell",value:function(TableObj){for(var BPCellLabel_B=["lr","lm","ll","mr","mm","ml","sr","sm","sl"],BPCellLabel_A=["sl","sm","sr","ml","mm","mr","ll","lm","lr"],cells_A=[],cells_B=[],cellAmap=new Map,cellBmap=new Map,i=0;i<3;i++)for(var j=0;j<3;j++){var cell={name:BPCellLabel_B[3*i+j],strikes:[]};cells_B.push(cell),cellBmap.set(BPCellLabel_B[3*i+j],cell)}for(var _i=0;_i<3;_i++)for(var _j=0;_j<3;_j++){var _cell={name:BPCellLabel_A[3*_i+_j],strikes:[]};cells_A.push(_cell),cellAmap.set(BPCellLabel_A[3*_i+_j],_cell)}TableObj.cellAmap=cellAmap,TableObj.cellBmap=cellBmap,TableObj.cells_A=cells_A,TableObj.cells_B=cells_B}},{key:"configureCell",value:function(TableObj,tennisNet){for(var x=TableObj.originX,y=TableObj.originY,cellWidth=TableObj.width/3,cellHeight=(TableObj.height-tennisNet.height)/6,i=0;i<3;i++){for(var j=0;j<3;j++){var cell=TableObj.cells_B[3*i+j];cell.x=x,cell.y=y,cell.width=cellWidth,cell.height=cellHeight,cell.centralX=x+cellWidth/2,cell.centralY=y+cellHeight/2,x+=cellWidth}x=TableObj.originX,y+=cellHeight}y+=tennisNet.height;for(var _i2=0;_i2<3;_i2++){for(var _j2=0;_j2<3;_j2++){var _cell2=TableObj.cells_A[3*_i2+_j2];_cell2.x=x,_cell2.y=y,_cell2.width=cellWidth,_cell2.height=cellHeight,_cell2.centralX=x+cellWidth/2,_cell2.centralY=y+cellHeight/2,x+=cellWidth}x=TableObj.originX,y+=cellHeight}}},{key:"dispatchTable",value:function(strikeObjArray){var vm=this,TableArray=[],Table0=vm.initTable("");vm.initCell(Table0),TableArray.push(Table0);var tempTable=vm.initTable("");return vm.initCell(tempTable),strikeObjArray.forEach(function(strikeObj,i){if(i<=2){var Table_old=TableArray[0];Table_old.strikes.push(strikeObj);var cell=Table_old["cell"+strikeObj.player+"map"].get(strikeObj.bp);cell.strikes.push(strikeObj)}if(1<=i&&i<=2){var ObjCopy={strikeNum:strikeObj.strikeNum,bp:strikeObj.bp,nbp:strikeObj.nbp,sp:strikeObj.sp,st:strikeObj.st,isScore:strikeObj.isScore,player:strikeObj.player,effect:strikeObj.effect};tempTable.strikes.push(ObjCopy);var _cell3=tempTable["cell"+strikeObj.player+"map"].get(strikeObj.bp);_cell3.strikes.push(ObjCopy)}if(3===i){tempTable.strikes.push(strikeObj);var _cell4=tempTable["cell"+strikeObj.player+"map"].get(strikeObj.bp);_cell4.strikes.push(strikeObj),TableArray.push(tempTable)}if(i>=4)if(4===i){var direction=vm.directionJudge(strikeObj),newTable=vm.initTable(direction);newTable.strikes.push(strikeObj);var _cell5=newTable["cell"+strikeObj.player+"map"].get(strikeObj.bp);_cell5.strikes.push(strikeObj),TableArray.push(newTable)}else if(vm.isAddNewTable(TableArray,strikeObj)){var _direction=vm.directionJudge(strikeObj),_newTable=vm.initTable(_direction);_newTable.strikes.push(strikeObj);var _cell6=_newTable["cell"+strikeObj.player+"map"].get(strikeObj.bp);_cell6.strikes.push(strikeObj),TableArray.push(_newTable)}else{var _Table_old=TableArray[TableArray.length-1];_Table_old.strikes.push(strikeObj);var _cell7=_Table_old["cell"+strikeObj.player+"map"].get(strikeObj.bp);_cell7.strikes.push(strikeObj)}}),TableArray}},{key:"isAddNewTable",value:function(TableArray,strikeObj){var vm=this,Table_old=TableArray[TableArray.length-1],dire_old=Table_old.direction,direction=vm.directionJudge(strikeObj),player=strikeObj.player,cell=Table_old["cell"+player+"map"].get(strikeObj.bp),cell_count=cell.strikes.length;return 2===cell_count||("m"===dire_old?("m"!=direction&&(Table_old.direction=direction),!1):"m"!==direction&&(direction!==dire_old&&""!=direction))}},{key:"directionJudge",value:function(strikeObj){var directionTable={l_l:"l",l_m:"l",l_r:"m",m_l:"l",m_m:"m",m_r:"r",r_l:"m",r_m:"r",r_r:"r"},bp=strikeObj.bp,nbp=strikeObj.nbp;if(nbp.length>2)return"";var bp_dire=bp.substr(1,1),nbp_dire=nbp.substr(1,1),direction=directionTable[bp_dire+"_"+nbp_dire];return direction}},{key:"preprocess",value:function(strikes){var strikeObjArray=[];return strikes.forEach(function(strikeObj,i){var strikeNum=parseInt(strikeObj.strikeNo),ballPosition=strikeObj.ballPosition,bp=void 0;bp=1<=ballPosition&&ballPosition<=4?1===ballPosition?strikeObj.BallPosition2Axis(22):2===ballPosition?strikeObj.BallPosition2Axis(21):3===ballPosition?strikeObj.BallPosition2Axis(10):strikeObj.BallPosition2Axis(9):strikeObj.BallPosition2Axis(ballPosition),strikeObjArray.push({strikeNum:strikeNum,bp:bp,nbp:strikeObj.BallPosition2Axis(strikeObj.nextBallPosition),st:strikeObj.StrikeTech2Axis(strikeObj.strikeTech),sp:strikeObj.StrikePosition2Axis(strikeObj.strikePosition),effect:strikeObj.strikeEffect,player:strikeObj.player,isScore:strikeObj.isScore_})}),strikeObjArray}},{key:"clickView",value:function(){""===$("#stroke-view").attr("class")?$("#stroke-view").attr("class","show"):$("#stroke-view").attr("class","")}},{key:"showView",value:function(){$("#stroke-view").attr("class","show")}},{key:"hideView",value:function(){$("#stroke-view").attr("class","")}}]),StrokeViewController}();angular.module(app.applicationModuleName).controller("StrokeViewController",["Axis","VElement","T","$timeout",StrokeViewController])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var TacticViewController=function(){function TacticViewController(Axis,VElement,T){_classCallCheck(this,TacticViewController),this.config={},this.VElement=VElement,Axis.call(this),this.T=T}return _createClass(TacticViewController,[{key:"bindSvg",value:function(svg){}},{key:"bindCallback",value:function(cb){this.callback=cb}},{key:"init",value:function(){}},{key:"bindStaticParams",value:function(){void 0==this.strikeTech&&(this.strikeTech="ST_BP_SP"),void 0==this.strikeNums&&(this.strikeNums="5+"),void 0==this.startEndPlayer&&(this.startEndPlayer="A")}},{key:"configure",value:function(){var width=document.getElementById("tacticView-SVG").parentNode.clientWidth,height=document.getElementById("tacticView-SVG").parentNode.clientHeight;this.bindStaticParams();var params={},startEndPlayer=this.startEndPlayer;params.startEndPlayer=startEndPlayer,params.width=width,params.height=height;var pic={},prefix="modules/core/client/img/hit/";pic.forehand=prefix+"forefore.png",pic["anti-sideways"]=prefix+"foreback.png",pic.sideways=prefix+"backfore.png",pic.backhand=prefix+"backback.png",params.pic=pic;var svg=d3.select("#tacticView-SVG").attr("width",width).attr("height",height/5);svg.append("g").attr("id","backGreyRectGroup"),svg.append("g").attr("id","tacticFlowsGroup"),svg.append("g").attr("id","titleGroup"),params.svg=svg,this.fstrikes.doFilter?params.strikes=this.fstrikes.fstrikes:params.strikes=this.strikes,params.vm=this,params.T=this.T,params.tacticData=this.process(params),params.strikeNums=this.strikeNums,params.strikeTech=this.strikeTech,params.lastStrikeTech=this.strikeTech,this.renderTacticView(params),this.renderStaticParts(params),this.renderDropDown(params)}},{key:"reconfigure",value:function(){}},{key:"renderTacticView",value:function(params){var strikeNums=params.strikeNums,strikeTech=params.strikeTech,startEndPlayer=params.startEndPlayer,evenColor=void 0,oddColor=void 0;"A"===startEndPlayer?(evenColor="#33cccc",oddColor="#ff9933"):"B"===startEndPlayer&&(evenColor="#ff9933",oddColor="#33cccc"),"AB"===startEndPlayer&&(evenColor="grey",oddColor="grey");var tacticData=params.tacticData,svg=params.svg;params.pic;svg.select("#tacticFlowsGroup").selectAll("g").remove();var labelNames={BP:{sl:"Short Backhand",sm:"Short Middle",sr:"Short Forehand",ml:"Half Long Backhand",mm:"Half Long Middle",mr:"Half Long Forehand",ll:"Long Backhand",lm:"Long Middle",lr:"Long Forehand"},ST:{ser:"serve",loo:"loop drive",qui:"quick attack",smas:"smash",fli:"flick",cho:"chop long",dro:"drop shot",blo:"block",cut:"cutting",par:"parrel",lob:"lob"},SP:{forehand:"forehand",sideways:"sideways","anti-sideways":"anti-sideways",backhand:"backhand"}},tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(d){var color="white";return"<span style='color:"+color+"'>"+params.T.t(d)});d3.select("#tacticFlowsGroup").call(tip);var statGroupWidth=params.width/6,statWidth=statGroupWidth/2,lineWidth=(params.width-statGroupWidth)/3,lineMargin={top:lineWidth/13,bottom:lineWidth/13,left:lineWidth/6,right:lineWidth/6},unitWidth=lineWidth-lineMargin.left-lineMargin.right,unitHeight=unitWidth/2,lineHeight=unitHeight+lineMargin.top+lineMargin.bottom,topGap=lineHeight/3,legendHeight=1.5*lineHeight,titleX=3*lineWidth-statWidth/2,titleWidth=statWidth,titleHeight=2*statWidth/3;params.lineWidth=lineWidth,params.lineHeight=lineHeight,params.titleWidth=titleWidth,params.titleHeight=titleHeight,params.titleX=titleX,params.legendHeight=legendHeight,params.statWidth=statWidth;var maxFreq=Math.max.apply(Math,tacticData[strikeNums][strikeTech].result.map(function(d){return d.freq})),freqScale=d3.scaleLinear().domain([0,maxFreq]).range([0,2*titleWidth/3]),defaultTransY=-18;svg.select("#tacticFlowsGroup").attr("transform","translate(0,"+defaultTransY+")").selectAll(".tacticFlows").data(tacticData[strikeNums][strikeTech].result).enter().append("g").attr("class","tacticFlows").attr("transform",function(d,i){return"translate(0,"+(topGap+i*lineHeight)+")"}).each(function(d,i){for(var _this=this,_loop=function(strikeNum){for(var datum=d["strike"+strikeNum],BP=datum.BP,SP=datum.SP,ST=datum.ST,tranX=(unitWidth+lineMargin.left)*strikeNum+lineMargin.left,SPPicWidth=2*unitHeight/3,SPGroup=d3.select(_this).append("g").attr("class","SPGroup").attr("transform","translate("+tranX+","+lineMargin.top+")").on("mouseover",function(){params.strikeTech.indexOf("SP")!=-1&&tip.show(labelNames.SP[d["strike"+strikeNum].SP])}).on("mouseout",function(){params.strikeTech.indexOf("SP")!=-1&&tip.hide()}),SPRect=SPGroup.append("rect").attr("x",0).attr("y",0).attr("width",SPPicWidth).attr("height",SPPicWidth).attr("stroke","black").attr("stroke-width","0.5px").style("stroke-opacity",function(d){return params.lastStrikeTech.indexOf("SP")!=-1?1:0}).attr("fill","none"),SPPic=SPGroup.append("svg:image").attr("x",0).attr("y",0).attr("width",SPPicWidth).attr("height",SPPicWidth).style("opacity",function(d){return params.lastStrikeTech.indexOf("SP")!=-1?1:0}).attr("xlink:href",params.pic[SP]),BPGroup=d3.select(_this).append("g").attr("class","BPGroup").attr("transform","translate("+(tranX+7*SPPicWidth/6)+","+lineMargin.top+")"),rectCellWidth=(unitWidth-7*SPPicWidth/6)/3,rectCellHeight=unitHeight/3,BPRectData=[],BPRectFill={sl:[2,2],ml:[1,2],ll:[0,2],sm:[2,1],mm:[1,1],lm:[0,1],sr:[2,0],mr:[1,0],lr:[0,0]},row=0;row<3;row++)for(var col=0;col<3;col++)void 0==BPRectFill[BP]?BPRectData.push({row:row,col:col,fill:"white"}):BPRectData.push({row:row,col:col,fill:BPRectFill[BP][0]==row&&BPRectFill[BP][1]==col?strikeNum%2==1?oddColor:evenColor:"white"});var BPRects=BPGroup.selectAll("rect").data(BPRectData).enter().append("rect").attr("x",function(d){return d.col*rectCellWidth}).attr("y",function(d){return d.row*rectCellHeight}).attr("width",rectCellWidth).attr("height",rectCellHeight).style("stroke",strikeNum%2==1?oddColor:evenColor).style("stroke-width","2px").style("stroke-opacity",function(d){return params.lastStrikeTech.indexOf("BP")!=-1?1:0}).style("fill",function(d){return d.fill}).style("fill-opacity",function(d){return params.lastStrikeTech.indexOf("BP")!=-1?1:0}),BPLine=BPGroup.append("line").attr("x1",-3).attr("x2",3*rectCellWidth+3).attr("y1",3*rectCellHeight).attr("y2",3*rectCellHeight).style("stroke","grey").style("stroke-width","3px").style("stroke-opacity",function(d){return params.lastStrikeTech.indexOf("BP")==-1?0:1}),topRect=BPGroup.append("g").on("mouseover",function(){params.strikeTech.indexOf("BP")!=-1&&tip.show(labelNames.BP[d["strike"+strikeNum].BP])}).on("mouseout",function(){params.strikeTech.indexOf("BP")!=-1&&tip.hide()});topRect.append("rect").attr("x",0).attr("y",0).attr("width",3*rectCellWidth).attr("height",3*rectCellHeight).style("stroke","none").style("stroke-width","0px").style("fill","white").style("opacity",0);var STGroup=d3.select(_this).append("g").attr("class","STGroup");STGroup.attr("transform",function(d){return"ST_BP_SP"===params.lastStrikeTech?"translate("+tranX+","+(lineMargin.top+9*SPPicWidth/8)+")":"translate("+tranX+","+lineMargin.top+")"}).on("mouseover",function(){params.strikeTech.indexOf("ST")!=-1&&tip.show(labelNames.ST[d["strike"+strikeNum].ST])}).on("mouseout",function(){params.strikeTech.indexOf("ST")!=-1&&tip.hide()});var STRectWidth=SPPicWidth,STRectHeight=unitHeight-9*SPPicWidth/8,STRect=STGroup.append("rect").attr("x",0).attr("y",0).attr("width",function(d){return"ST"===params.lastStrikeTech?unitWidth:STRectWidth}).attr("height",function(d){return"ST_BP_SP"===params.lastStrikeTech?STRectHeight:unitHeight}).attr("stroke","black").attr("stroke-width","0.5px").style("stroke-opacity",function(d){return params.lastStrikeTech.indexOf("ST")==-1?0:1}).attr("fill","none"),STText=STGroup.append("text").text(function(){return"ST"===params.lastStrikeTech?params.T.t(labelNames.ST[ST]):params.T.t(ST)}).attr("x",function(d){return"ST"===params.lastStrikeTech?unitWidth/2:STRectWidth/2}).attr("y",function(d){return"ST_BP_SP"===params.lastStrikeTech?STRectHeight/2:unitHeight/2}).style("stroke-opacity",function(d){return params.lastStrikeTech.indexOf("ST")==-1?0:1}).style("fill","black").style("text-anchor","middle").style("alignment-baseline","middle").attr("font-size",function(){return"ST"===params.lastStrikeTech?STRectWidth/20+"em":STRectWidth/30+"em"}).style("font-family","arial"),circleUpdateTime=500;if("ST"===params.lastStrikeTech||"ST_BP"===params.lastStrikeTech&&"ST_BP_SP"===params.strikeTech?(STGroup.transition().duration(circleUpdateTime).attr("transform",function(d){return"ST_BP_SP"===params.strikeTech?"translate("+tranX+","+(lineMargin.top+9*SPPicWidth/8)+")":"translate("+tranX+","+lineMargin.top+")"}),STRect.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("ST")==-1?0:1}).attr("width",function(d){return"ST"===params.strikeTech?unitWidth:STRectWidth}).attr("height",function(d){return"ST_BP_SP"===params.strikeTech?STRectHeight:unitHeight}),STText.transition().duration(circleUpdateTime).text(function(){return"ST"===params.strikeTech?params.T.t(labelNames.ST[ST]):params.T.t(ST)}).attr("x",function(d){return"ST"===params.strikeTech?unitWidth/2:STRectWidth/2}).attr("y",function(d){return"ST_BP_SP"===params.strikeTech?STRectHeight/2:unitHeight/2}).attr("font-size",function(){return"ST"===params.strikeTech?STRectWidth/20+"em":STRectWidth/30+"em"}).on("end",function(){SPRect.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("SP")==-1?0:1}),SPPic.transition().duration(circleUpdateTime).style("opacity",function(d){return params.strikeTech.indexOf("SP")==-1?0:1}),BPRects.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("BP")==-1?0:1}).style("fill-opacity",function(d){return params.strikeTech.indexOf("BP")!=-1?1:0}),BPLine.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("BP")==-1?0:1})})):(SPRect.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("SP")==-1?0:1}),SPPic.transition().duration(circleUpdateTime).style("opacity",function(d){return params.strikeTech.indexOf("SP")==-1?0:1}),BPLine.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("BP")==-1?0:1}),BPRects.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("BP")==-1?0:1}).style("fill-opacity",function(d){return params.strikeTech.indexOf("BP")!=-1?1:0}).on("end",function(){STGroup.transition().duration(circleUpdateTime).attr("transform",function(d){return"ST_BP_SP"===params.strikeTech?"translate("+tranX+","+(lineMargin.top+9*SPPicWidth/8)+")":"translate("+tranX+","+lineMargin.top+")"}),STRect.transition().duration(circleUpdateTime).style("stroke-opacity",function(d){return params.strikeTech.indexOf("ST")==-1?0:1}).attr("width",function(d){return"ST"===params.strikeTech?unitWidth:STRectWidth}).attr("height",function(d){return"ST_BP_SP"===params.strikeTech?STRectHeight:unitHeight}),STText.transition().duration(circleUpdateTime).attr("x",function(d){return"ST"===params.strikeTech?unitWidth/2:STRectWidth/2}).attr("y",function(d){return"ST_BP_SP"===params.strikeTech?STRectHeight/2:unitHeight/2}).attr("font-size",function(){return"ST"===params.strikeTech?STRectWidth/20+"em":STRectWidth/30+"em"}).on("end",function(){STText.transition().duration(circleUpdateTime).text(function(){return"ST"===params.strikeTech?params.T.t(labelNames.ST[ST]):params.T.t(ST)})})})),2!=strikeNum){var greyRectGroup=d3.select(_this).append("g").attr("class","greyRectGroup").attr("transform","translate("+(tranX+unitWidth)+","+(lineMargin.top+rectCellHeight)+")");greyRectGroup.append("rect").attr("x",0).attr("y",0).attr("width",lineMargin.right).attr("height",rectCellHeight).attr("stroke","none").attr("fill","grey").attr("opacity",.5)}},strikeNum=0;strikeNum<3;strikeNum++)_loop(strikeNum);d3.select(this).append("text").text(d.freq).attr("x",3*lineWidth).attr("y",lineHeight/2).style("fill","black").style("text-anchor","middle").style("alignment-baseline","middle").style("font-size",unitHeight/20+"em").style("font-family","arial"),d3.select(this).append("rect").attr("x",3*lineWidth-titleWidth/3).attr("y",2*lineHeight/3).attr("width",freqScale(d.freq)).attr("height",unitHeight/5).attr("fill","grey"),d3.select(this).append("circle").attr("cx",3*lineWidth+5*statWidth/4).attr("cy",lineHeight/2).attr("r",unitHeight/3).style("stroke","grey").style("stroke-width","2px").style("fill","#ddd");var arc=d3.arc().innerRadius(0).outerRadius(unitHeight/3).startAngle(0);d3.select(this).append("g").attr("transform","translate("+(3*lineWidth+5*statWidth/4)+","+lineHeight/2+")").append("path").datum({startAngle:0,endAngle:d.score/d.freq*Math.PI*2}).style("fill","grey").attr("d",arc);var surfaceCircle=d3.select(this).append("g").on("mouseover",function(){tip.show(""+100*(d.score/d.freq).toFixed(2)+"%")}).on("mouseout",function(){tip.hide()});surfaceCircle.append("circle").attr("cx",3*lineWidth+5*statWidth/4).attr("cy",lineHeight/2).attr("r",unitHeight/3).style("stroke","none").style("fill","white").style("opacity",0)});var min_zoom=.1,max_zoom=7,zoom=d3.zoom().scaleExtent([min_zoom,max_zoom]),g=d3.select("#tacticFlowsGroup");zoom.on("zoom",function(){var current_translate=g.attr("transform").substring(g.attr("transform").indexOf("(")+1,g.attr("transform").indexOf(")")).split(",");if(null!=d3.event.sourceEvent){var dy=d3.event.sourceEvent.wheelDeltaY+parseFloat(current_translate[1]);dy>defaultTransY&&(dy=defaultTransY);var minY=-(tacticData[strikeNums][strikeTech].result.length-1)*lineHeight;dy<minY&&(dy=minY),isNaN(dy)||g.attr("transform","translate(0,"+dy+")scale(1)")}}),svg.call(zoom)}},{key:"renderDropDown",value:function(params){var process=this.process,renderTacticView=this.renderTacticView,legendHeight=(params.svg,params.titleX,params.lineWidth,params.lineHeight,params.titleWidth,params.legendHeight),svg=(params.legendWidth,params.statWidth,d3.select("#titleGroup"));svg.selectAll("g").remove(),svg.selectAll("rect").remove(),svg.selectAll("text").remove();var redrawFunc=this.renderTacticView,legend=(svg.append("g").attr("id","statTitles"),svg.append("g").attr("id","legend").attr("transform","translate(0,"+(params.height-legendHeight)+")"));legend.append("rect").attr("x",0).attr("y",0).attr("width",params.width).attr("height",1.1*legendHeight).attr("stroke","none").attr("fill","white").attr("opacity",1);for(var emptyRectData=[],row=0;row<3;row++)for(var col=0;col<3;col++)emptyRectData.push({row:row,col:col,fill:"white"});var legendLineWidth=params.width/3,rectCellHeight=legendHeight/5,rectCellWidth=4*rectCellHeight/3,emptyRectGroupTran=(legendLineWidth-3*rectCellWidth)/2,emptyRectGroup=legend.append("g").attr("class","emptyRectGroup").attr("transform","translate("+emptyRectGroupTran+",10)");emptyRectGroup.selectAll(".emptyRect").data(emptyRectData).enter().append("rect").attr("class","emptyRect").attr("x",function(d){return d.col*rectCellWidth}).attr("y",function(d){return d.row*rectCellHeight}).attr("width",rectCellWidth).attr("height",rectCellHeight).style("stroke","black").style("stroke-width","3px").style("fill",function(d){return d.fill}),emptyRectGroup.append("text").text(params.T.t("stroke placement")).attr("x",emptyRectGroupTran).attr("y",4*rectCellHeight).style("fill","black").style("text-anchor","middle").style("alignment-baseline","middle").style("font-size",rectCellWidth/20+"em").style("font-family","arial");for(var picRectData=[],_row=0;_row<2;_row++)for(var _col=0;_col<2;_col++)picRectData.push({row:_row,col:_col,fill:"white"});var picCellWidth=3*legendHeight/5/2,picCellGap=.1*picCellWidth,picGroupTran=legendLineWidth+(legendLineWidth-2*picCellWidth+picCellGap)/2,picGroup=legend.append("g").attr("class","picGroup").attr("transform","translate("+picGroupTran+",10)"),picGroupEnter=picGroup.selectAll(".picRect").data(picRectData).enter();picGroupEnter.append("rect").attr("class","picRect").attr("x",function(d){return 0!=d.col?d.col*(picCellWidth+picCellGap):d.col*picCellWidth}).attr("y",function(d){return 0!=d.row?d.row*(picCellWidth+picCellGap):d.row*picCellWidth}).attr("width",picCellWidth).attr("height",picCellWidth).style("stroke","black").style("stroke-width","1px").style("fill",function(d){return d.fill});var SPNames=["forehand","sideways","backhand","anti-sideways"];picGroupEnter.append("svg:image").attr("x",function(d){return 0!=d.col?d.col*(picCellWidth+picCellGap):d.col*picCellWidth}).attr("y",function(d){return 0!=d.row?d.row*(picCellWidth+picCellGap):d.row*picCellWidth}).attr("width",picCellWidth).attr("height",picCellWidth).attr("xlink:href",function(d,i){return params.pic[SPNames[i]]}),picGroup.append("text").text(params.T.t("stroke position")).attr("x",picCellWidth).attr("y",4*rectCellHeight).style("fill","black").style("text-anchor","middle").style("alignment-baseline","middle").style("font-size",rectCellWidth/20+"em").style("font-family","arial");var strokeTechWidth=.6*legendLineWidth,strokeTechHeight=picCellWidth,strokeTechGroupTran=2*legendLineWidth+(legendLineWidth-strokeTechWidth)/2,strokeTechGroup=legend.append("g").attr("class","strokeTechGroup").attr("transform","translate("+strokeTechGroupTran+",10)");strokeTechGroup.append("rect").attr("class","strokeTech").attr("x",0).attr("y",rectCellHeight).attr("width",strokeTechWidth).attr("height",strokeTechHeight).style("stroke","black").style("stroke-width","2px").style("fill","white"),strokeTechGroup.append("text").text(params.T.t("stroke technique")).attr("x",strokeTechWidth/2).attr("y",rectCellHeight+strokeTechHeight/2).style("fill","black").style("text-anchor","middle").style("alignment-baseline","middle").style("font-size",rectCellWidth/21+"em").style("font-family","arial"),strokeTechGroup.append("text").text(params.T.t("stroke technique")).attr("x",1.8*rectCellWidth).attr("y",4*rectCellHeight).style("fill","black").style("text-anchor","middle").style("alignment-baseline","middle").style("font-size",rectCellWidth/20+"em").style("font-family","arial"),document.getElementById("dropdown1Option1").onclick=function(){document.getElementById("dropdownMenu1").innerHTML='Tech<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.strikeTech="ST",params.vm.strikeTech="ST",redrawFunc(params)},document.getElementById("dropdown1Option2").onclick=function(){document.getElementById("dropdownMenu1").innerHTML='Tech-Pla<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.strikeTech="ST_BP",params.vm.strikeTech="ST_BP",redrawFunc(params)},document.getElementById("dropdown1Option3").onclick=function(){document.getElementById("dropdownMenu1").innerHTML='Tech-Pla-Pos<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.strikeTech="ST_BP_SP",params.vm.strikeTech="ST_BP_SP",redrawFunc(params)},document.getElementById("dropdown2Option1").onclick=function(){document.getElementById("dropdownMenu2").innerHTML='123<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.strikeNums="123",params.vm.strikeNums="123",redrawFunc(params)},document.getElementById("dropdown2Option2").onclick=function(){document.getElementById("dropdownMenu2").innerHTML='234<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.strikeNums="234",params.vm.strikeNums="234",redrawFunc(params)},document.getElementById("dropdown2Option3").onclick=function(){document.getElementById("dropdownMenu2").innerHTML='5+<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.strikeNums="5+",params.vm.strikeNums="5+",redrawFunc(params)},document.getElementById("dropdown3Option1").onclick=function(){document.getElementById("dropdownMenu3").innerHTML='P1<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.startEndPlayer="A",params.vm.startEndPlayer="A",params.tacticData=process(params),renderTacticView(params)},document.getElementById("dropdown3Option2").onclick=function(){document.getElementById("dropdownMenu3").innerHTML='P2<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.startEndPlayer="B",params.vm.startEndPlayer="B",params.tacticData=process(params),renderTacticView(params)},document.getElementById("dropdown3Option3").onclick=function(){document.getElementById("dropdownMenu3").innerHTML='P1&P2<span class="caret"></span>',params.lastStrikeTech=params.strikeTech,params.startEndPlayer="AB",params.vm.startEndPlayer="AB",params.tacticData=process(params),renderTacticView(params)}}},{key:"renderStaticParts",value:function(params){var titleX=(params.svg,params.titleX),titleWidth=(params.lineWidth,params.lineHeight,params.titleHeight,params.titleWidth),legendHeight=params.legendHeight,statWidth=(params.legendWidth,params.statWidth),svg=d3.select("#backGreyRectGroup");svg.selectAll("g").remove(),svg.selectAll("rect").remove(),svg.selectAll("text").remove(),svg.append("rect").attr("x",titleX).attr("y",0).attr("width",titleWidth).attr("height",params.height-1*legendHeight).attr("rx",5).attr("ry",5).attr("stroke","none").attr("fill","grey").attr("opacity",.3),svg.append("rect").attr("x",titleX+titleWidth+statWidth/4).attr("y",0).attr("width",titleWidth).attr("height",params.height-1*legendHeight).attr("rx",5).attr("ry",5).attr("stroke","none").attr("fill","grey").attr("opacity",.3)}},{key:"process",value:function(params){var strikes=params.strikes,startEndPlayer=params.startEndPlayer,vm=params.vm,gameRec={};strikes.forEach(function(strikeObj,i){var gameNum=parseInt(strikeObj.gameNo),rallyNum=parseInt(strikeObj.rallyNo),strikeNum=parseInt(strikeObj.strikeNo);void 0==gameRec[gameNum]&&(gameRec[gameNum]={}),void 0==gameRec[gameNum][rallyNum]&&(gameRec[gameNum][rallyNum]={}),gameRec[gameNum][rallyNum][strikeNum]={bp:strikeObj.BallPosition2Axis(strikeObj.ballPosition),nbp:strikeObj.BallPosition2Axis(strikeObj.nextBallPosition),st:strikeObj.StrikeTech2Axis(strikeObj.strikeTech),sp:strikeObj.StrikePosition2Axis(strikeObj.strikePosition),isScore:strikeObj.isScore_,player:strikeObj.player}});var tacticStat={};tacticStat[123]={},tacticStat[234]={},tacticStat["5+"]={};for(var obj in tacticStat)tacticStat[obj].ST={},tacticStat[obj].ST.result=[],tacticStat[obj].ST.countMap={},tacticStat[obj].ST_BP={},tacticStat[obj].ST_BP.result=[],tacticStat[obj].ST_BP.countMap={},tacticStat[obj].ST_BP_SP={},tacticStat[obj].ST_BP_SP.result=[],tacticStat[obj].ST_BP_SP.countMap={};Object.keys(gameRec).forEach(function(game){Object.keys(gameRec[game]).forEach(function(rally){var rallyObj=gameRec[game][rally],length=Object.keys(rallyObj).length;if(length>=3&&startEndPlayer.indexOf(rallyObj[1].player)!=-1&&vm.countTactic(tacticStat[123],rallyObj[1],rallyObj[2],rallyObj[3]),length>=4&&startEndPlayer.indexOf(rallyObj[2].player)!=-1&&vm.countTactic(tacticStat[234],rallyObj[2],rallyObj[3],rallyObj[4]),length>=7)for(var i=5;i+2<=length;i++)startEndPlayer.indexOf(rallyObj[i].player)!=-1&&vm.countTactic(tacticStat["5+"],rallyObj[i],rallyObj[i+1],rallyObj[i+2])})});for(var _obj in tacticStat)vm.countTacticResult(tacticStat[_obj],"ST"),vm.countTacticResult(tacticStat[_obj],"ST_BP"),vm.countTacticResult(tacticStat[_obj],"ST_BP_SP");return tacticStat}},{key:"countTactic",value:function(tacticObj,strike0,strike1,strike2){var st0=strike0.st,st1=strike1.st,st2=strike2.st,bp0=strike0.nbp,bp1=strike1.nbp,bp2=strike2.nbp,sp0=strike0.sp,sp1=strike1.sp,sp2=strike2.sp;void 0==tacticObj.ST.countMap[st0]&&(tacticObj.ST.countMap[st0]={}),void 0==tacticObj.ST.countMap[st0][st1]&&(tacticObj.ST.countMap[st0][st1]={}),void 0==tacticObj.ST.countMap[st0][st1][st2]&&(tacticObj.ST.countMap[st0][st1][st2]={freq:0,score:0}),tacticObj.ST.countMap[st0][st1][st2].freq++,strike2.isScore&&tacticObj.ST.countMap[st0][st1][st2].score++,void 0==tacticObj.ST_BP.countMap[st0+"_"+bp0]&&(tacticObj.ST_BP.countMap[st0+"_"+bp0]={}),void 0==tacticObj.ST_BP.countMap[st0+"_"+bp0][st1+"_"+bp1]&&(tacticObj.ST_BP.countMap[st0+"_"+bp0][st1+"_"+bp1]={}),void 0==tacticObj.ST_BP.countMap[st0+"_"+bp0][st1+"_"+bp1][st2+"_"+bp2]&&(tacticObj.ST_BP.countMap[st0+"_"+bp0][st1+"_"+bp1][st2+"_"+bp2]={freq:0,score:0}),tacticObj.ST_BP.countMap[st0+"_"+bp0][st1+"_"+bp1][st2+"_"+bp2].freq++,strike2.isScore&&tacticObj.ST_BP.countMap[st0+"_"+bp0][st1+"_"+bp1][st2+"_"+bp2].score++,void 0==tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0]&&(tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0]={}),void 0==tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0][st1+"_"+bp1+"_"+sp1]&&(tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0][st1+"_"+bp1+"_"+sp1]={}),void 0==tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0][st1+"_"+bp1+"_"+sp1][st2+"_"+bp2+"_"+sp2]&&(tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0][st1+"_"+bp1+"_"+sp1][st2+"_"+bp2+"_"+sp2]={freq:0,score:0}),tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0][st1+"_"+bp1+"_"+sp1][st2+"_"+bp2+"_"+sp2].freq++,strike2.isScore&&tacticObj.ST_BP_SP.countMap[st0+"_"+bp0+"_"+sp0][st1+"_"+bp1+"_"+sp1][st2+"_"+bp2+"_"+sp2].score++}},{key:"countTacticResult",value:function(tacticObj,category){var countMap=tacticObj[category].countMap;for(var strike0 in countMap)for(var strike1 in countMap[strike0])for(var strike2 in countMap[strike0][strike1]){var obj={strike0:this.str2Obj(strike0),strike1:this.str2Obj(strike1),strike2:this.str2Obj(strike2),freq:countMap[strike0][strike1][strike2].freq,score:countMap[strike0][strike1][strike2].score};tacticObj[category].result.push(obj)}tacticObj[category].result.sort(function(a,b){return a.freq!=b.freq?b.freq-a.freq:b.score-a.score})}},{key:"str2Obj",value:function(string){var array=string.split("_");return 1===array.length?{ST:array[0]}:2===array.length?{ST:array[0],BP:array[1]}:3===array.length?{ST:array[0],BP:array[1],SP:array[2]}:{}}}]),TacticViewController}();angular.module(app.applicationModuleName).controller("TacticViewController",["Axis","VElement","T",TacticViewController])}(ApplicationConfiguration);
"use strict";!function(app){function Brush(){return{restrict:"A",scope:{brushcb:"=",extent:"=",brushselection:"=",highlightcb:"="},link:function(scope,ele,attrs){var svg=d3.select(ele[0]),brush=d3.brushX();d3.select(svg._groups[0][0]).on("mousemove",function(){var event=d3.event;scope.highlightcb(event)}),d3.select(svg._groups[0][0]).on("mouseout",function(){d3.selectAll(".strikeHighlight").remove(),d3.selectAll(".strikeContainer").remove()}),brush.on("start",function(){d3.selectAll(".strikeHighlight").remove(),d3.selectAll(".strikeContainer").remove()}),brush.on("brush",function(){d3.selectAll(".fhighlight").attr("fill-opacity","0"),d3.select(".brush .selection").attr("fill-opacity",.3).attr("stroke-opacity",1)}),brush.on("end",function(){var event=d3.event.sourceEvent;if(event){if(!d3.brushSelection(this))return void scope.brushcb();scope.brush=this;var extent=d3.brushSelection(this);scope.brushcb(extent)}}),scope.$watch(function(){return scope.extent},function(value){void 0!==value&&(svg.selectAll(".brush").remove(),brush.extent(scope.extent),svg.append("g").attr("class","brush").call(brush))}),scope.$watch(function(){return scope.brushselection},function(value){var extent=value;void 0!==extent&&svg.select(".brush").transition().call(brush.move,extent)})}}}angular.module(app.applicationModuleName).directive("brush",[Brush])}(ApplicationConfiguration);
"use strict";!function(app){function Load(Storage){return{restrict:"A",scope:{cb:"="},link:function(scope,element,attrs){var item=angular.element(element.find("span")[0]),input=element.find("input")[0];item.on("click",function(){input.click()}),angular.element(input).on("change",function(){var reader=new FileReader;reader.onload=function(){Storage.Load(this.result).then(Storage.ParseStrike.bind(Storage)).then(Storage.ParseRally.bind(Storage)).then(Storage.ParseGame.bind(Storage)).then(function(){scope.cb()}).catch(function(err){console.error(err)})},reader.readAsText(input.files[0])})}}}angular.module(app.applicationModuleName).directive("fileModel",["Storage",Load])}(ApplicationConfiguration);
"use strict";!function(app){function Slide(){return{restrict:"A",link:function(scope,ele,attrs){}}}angular.module(app.applicationModuleName).directive("slide",[Slide])}(ApplicationConfiguration);
"use strict";!function(app){function FilterView(){return{restrict:"A",scope:{filters:"=",cb:"=",rallycb:"="},bindToController:{games:"=",rallies:"="},controller:"FilterViewController",controllerAs:"ctrl",link:function(scope,ele,attrs,ctrl){ctrl.init(),ctrl.bindCallback(scope.cb),ctrl.bindCallbackRally(scope.rallycb),scope.$watch(function(){return ctrl.games},function(value){ctrl.update(),ctrl.render()}),d3.selectAll("#games-view .checkbox").on("click",function(){var target=d3.event.target;$(target).toggleClass("checked"),ctrl.update(),ctrl.render()})},templateUrl:"modules/core/client/templates/view-filter.template.html"}}angular.module(app.applicationModuleName).directive("filterView",[FilterView])}(ApplicationConfiguration);
"use strict";!function(app){function GamesView(){return{restrict:"A",scope:{cb:"=",rallycb:"="},bindToController:{games:"=",update:"=",rallies:"="},controller:"GamesViewController",controllerAs:"ctrl",link:function(scope,ele,attrs,ctrl){var svg=ele.find("svg");ctrl.bindSvg(svg),ctrl.bindCallback(scope.cb),ctrl.bindCallbackRally(scope.rallycb),ctrl.init(),scope.$watch(function(){return ctrl.games},function(value){ctrl.configure()}),scope.$watch(function(){return ctrl.rallies},function(value){ctrl.filter(value)}),scope.$watch(function(){return ctrl.rally},function(value){scope.rallycb(value)})},templateUrl:"modules/core/client/templates/view-games.template.html"}}angular.module(app.applicationModuleName).directive("gamesView",[GamesView])}(ApplicationConfiguration);
"use strict";!function(app){function HistoryView(){return{restrict:"A",scope:{savecb:"=",recovercb:"=",deletecb:"="},bindToController:{history:"=",update:"="},controller:"HistoryViewController",controllerAs:"ctrl",link:function(scope,ele,attrs,ctrl){ctrl.bindSaveStatus(scope.savecb),ctrl.bindRecoverStatus(scope.recovercb),ctrl.bindDeleteStatus(scope.deletecb),ctrl.init(),scope.$watch(function(){return ctrl.history},function(value){ctrl.configure()},!0)},templateUrl:"modules/core/client/templates/view-history.template.html"}}angular.module(app.applicationModuleName).directive("historyView",[HistoryView])}(ApplicationConfiguration);
"use strict";!function(app){function StatisticView(){return{restrict:"A",scope:{changefstrikes:"=",cb:"="},bindToController:{fstrikes:"=",strikes:"=",rally:"=",update:"="},controller:"StatisticViewController",controllerAs:"ctrl",link:function(scope,ele,attrs,ctrl){var svg=ele.find("svg"),strikeRec="";ctrl.bindChangefstrikes(scope.changefstrikes),ctrl.bindSvg(svg),ctrl.bindCallback(scope.cb),ctrl.init(),scope.$watch(function(){return ctrl.strikes},function(value){strikeRec!==ctrl.strikes.toString()&&(strikeRec=ctrl.strikes.toString(),ctrl.configure())})},templateUrl:"modules/core/client/templates/view-statistic.template.html"}}angular.module(app.applicationModuleName).directive("statisticView",[StatisticView])}(ApplicationConfiguration);
"use strict";!function(app){function StrokeView(){return{restrict:"A",scope:{cb:"="},bindToController:{rally:"="},controller:"StrokeViewController",controllerAs:"ctrl",link:function(scope,ele,attrs,ctrl){var svg=ele.find("svg");ctrl.bindSvg(svg),ctrl.init(),scope.$watch(function(){return ctrl.rally},function(value){ctrl.configure()})},templateUrl:"modules/core/client/templates/view-strikes.template.html"}}angular.module(app.applicationModuleName).directive("strokeView",[StrokeView])}(ApplicationConfiguration);
"use strict";!function(app){function TacticView(){return{restrict:"A",scope:{cb:"="},bindToController:{fstrikes:"=",dofilter:"=",strikes:"=",update:"="},controller:"TacticViewController",controllerAs:"ctrl",link:function(scope,ele,attrs,ctrl){var _this=this;scope.$watch(function(){return ctrl.strikes},function(value){ctrl.configure()}),scope.$watch(function(){return ctrl.fstrikes},function(value){_this.fstrikes=ctrl.fstrikes,ctrl.configure()},!0)},templateUrl:"modules/core/client/templates/view-tactic.template.html"}}angular.module(app.applicationModuleName).directive("tacticView",[TacticView])}(ApplicationConfiguration);
"use strict";!function(app){angular.module(app.applicationModuleName).filter("T",["$translate",function($translate){return function(key){if(key)return $translate.instant(key)}}])}(ApplicationConfiguration);
"use strict";!function(app){angular.module(app.applicationModuleName).factory("T",["$translate",function($translate){var T={t:function(key){return key?$translate.instant(key):key}};return T}])}(ApplicationConfiguration);
"use strict";!function(app){angular.module(app.applicationModuleName).factory("Axis",["VElement",function(VElement){var Axis=function(){this.createLeftAxis=function(value,scale,ticks,format){format="function"==typeof format?format:function(_){return _},ticks=ticks instanceof Array?ticks:[],value=parseInt(value);var tickLength=10,axis=VElement.line(value,parseInt(scale.range()[0]),value,parseInt(scale.range()[1]));return axis.ticks=[],ticks.forEach(function(tick,i){var x=value,y=parseInt(scale(tick));axis.ticks.push({tick:VElement.line(x,y,x+tickLength,y),text:VElement.text(x-5,y,format(tick))})}),axis},this.createBottomAxis=function(value,scale,ticks,format){format="function"==typeof format?format:function(_){return _},ticks=ticks instanceof Array?ticks:[];var axis={x1:scale.range()[0],x2:scale.range()[1],y1:value,y2:value,ticks:[]},tickLength=-10;return ticks.forEach(function(tick,i){var x=scale(tick),y=value;axis.ticks.push({tick:VElement.line(x,y,x,y+tickLength),text:VElement.text(x,y+5,format(tick))})}),axis},this.createHivePlotAxis=function(value,scale,ticks,format){format="function"==typeof format?format:function(_){return _},ticks=ticks instanceof Array?ticks:[];var axis={x1:0,x2:scale.range()[1],y1:value,y2:value,ticks:[]},tickLength=-5;return ticks.forEach(function(tick,i){var x=scale(tick),y=value,text=VElement.text(x,y-15,format(tick));text.rotate=90,text.anchor="end",axis.ticks.push({name:format(tick),tick:VElement.line(x,y,x,y+tickLength),text:text})}),axis}};return Axis}])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var TacticLayout=function(){function TacticLayout(){_classCallCheck(this,TacticLayout)}return _createClass(TacticLayout,[{key:"layout",value:function(lines){var _this=this,tmp=[];return lines.forEach(function(line){var p1=line[0],p3=line[1],p2=[(p1[0]+p3[0])/2,(p1[1]+p3[1])/2];_this.move(p1,p2,p3);for(var qx=[p1[0],p2[0],p3[0]],qy=[p1[1],p2[1],p3[1]],_line=[],i=0;i<=1;i+=.02){var x=_this.spline(qx,i,3),y=_this.spline(qy,i,3);_line.push([x,y])}tmp.push(_line)}),tmp}},{key:"move",value:function(p1,p2,p3){var k=void 0,b=void 0;p3[0]!==p1[0]&&(k=(p3[1]-p1[1])/(p3[0]-p1[0])),k=void 0===k?0:0===k?void 0:-1/k,k&&(b=p2[1]-k*p2[0]);var angle=void 0===k?Math.PI/2:Math.atan(k),d=(.1+.3*Math.random())*Math.sqrt(Math.pow(p3[0]-p1[0],2)+Math.pow(p3[1]-p1[1],2));p3[1]<p1[1]?(p2[0]+=d*Math.cos(angle),p2[1]+=d*Math.sin(angle)):(p2[0]-=d*Math.cos(angle),p2[1]-=d*Math.sin(angle)),p2[0]=parseInt(p2[0]),p2[1]=parseInt(p2[1])}},{key:"angle",value:function angle(p1,p3){var k=void 0;p3[0]!==p1[0]&&(k=(p3[1]-p1[1])/(p3[0]-p1[0]));var angle=void 0===k?Math.PI/2:Math.atan(k);return angle*=180/Math.PI,p3[1]>p1[1]&&(angle=(angle+540)%180),p3[1]<p1[1]&&(angle=180+(angle+540)%180),angle}},{key:"spline",value:function(q,id,k){function N(i,k,id,t){if(1==k)return id<=t[i+1]&&id>=t[i]?1:0;var a=(id-t[i])*N(i,k-1,id,t),b=t[i+k-1]-t[i],c=(t[i+k]-id)*N(i+1,k-1,id,t),d=t[i+k]-t[i+1];return 0==b&&(b=1),0==d&&(d=1),a/b+c/d}function genT(k,n){for(var t=[],i=0;i<=n+k;i++)i<k?t.push(0):i>=k&&i<=n?t.push(i-k+1):t.push(n-k+2);var len=t[t.length-1]-t[0];if(0!=len)for(var i=0;i<t.length;i++)t[i]/=len;return t}for(var n=q.length-1,t=genT(k,n),r=0,i=0;i<=n;i++)r+=q[i]*N(i,k,id,t);return r}}]),TacticLayout}();angular.module(app.applicationModuleName).factory("TacticLayout",[TacticLayout])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var Storage=function(){function Storage(Game,Rally,Strike){_classCallCheck(this,Storage),this.Game=Game,this.Rally=Rally,this.Strike=Strike,this.strikes=[],this.rallies=[],this.games=[]}return _createClass(Storage,[{key:"Load",value:function(file){var promise=new Promise(function(resolve,reject){resolve(file)});return promise}},{key:"ParseStrike",value:function(file){if(file){var Strike=this.Strike,data=file.split("\n"),header=data.shift().split(","),strikes=[];return data.forEach(function(_){if(_.length){var d=_.split(","),_strike={};d.forEach(function(_,i){_strike[header[i]]=isNaN(Number(_))?_:Number(_)}),0!==_strike.StrikeNo&&0!==_strike.NextStrikeTech&&strikes.push(new Strike(_strike))}}),this.strikes=strikes,strikes}}},{key:"ParseRally",value:function(strikes){if(strikes){for(var Rally=this.Rally,rallies=[],i=0;i<strikes.length;i++){var _strike=strikes[i];_strike.isServe&&rallies.push(new Rally);var last=rallies[rallies.length-1];last.add(_strike)}return rallies.forEach(function(d){return d.genTactics()}),this.rallies=rallies,rallies}}},{key:"ParseGame",value:function(rallies){if(rallies){for(var Game=this.Game,games=[],i=0;i<rallies.length;i++){var _rally=rallies[i];_rally.isFirst&&games.push(new Game);var last=games[games.length-1];last.add(_rally)}return this.games=games,games}}}]),Storage}();angular.module(app.applicationModuleName).service("Storage",["Game","Rally","Strike",Storage])}(ApplicationConfiguration);
"use strict";!function(app){angular.module(app.applicationModuleName).factory("VElement",[function(){var Rect=function(x,y,width,height){return{x:x,y:y,width:width,height:height}},Line=function(x1,y1,x2,y2){return{x1:x1,x2:x2,y1:y1,y2:y2}},Circle=function(cx,cy,r){return{cx:cx,cy:cy,r:r}},Path=function(d){return{d:d}},Text=function(x,y,text){return{x:x,y:y,text:text}};return{rect:Rect,line:Line,circle:Circle,path:Path,text:Text}}])}(ApplicationConfiguration);
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(app){var StrikeTech={1:"serve",2:"serve",3:"loop drive",4:"loop drive",5:"quick attack",6:"quick attack",7:"smash",8:"smash",9:"flick",10:"flick",11:"chop long",12:"chop long",13:"drop shot",14:"drop shot",15:"block",16:"block",17:"cutting",18:"cutting",19:"parrel",20:"parrel",21:"lob",22:"lob",23:"other",24:"other",25:"scoreA",26:"scoreB"},StrikeTech_class={1:"发球",2:"发球",3:"接发球",4:"接发球",5:"相持",6:"相持",7:"进攻",8:"进攻",9:"防御",10:"防御",11:"控制",12:"控制",13:"得分",14:"得分"},BallPosition={1:"反手发球",2:"反手发球",3:"正手发球",4:"正手发球",5:"正手短球",6:"正手短球",7:"正手半长球",8:"正手半长球",9:"正手长球",10:"正手长球",11:"中路短球",12:"中路短球",13:"中路半长球",14:"中路半长球",15:"中路长球",16:"中路长球",17:"反手短球",18:"反手短球",19:"反手半长球",20:"反手半长球",21:"反手长球",22:"反手长球",23:"意外球",24:"意外球",25:"得分",26:"得分"},TableAreaNumber={1:"ser",2:"ser",3:"ser",4:"ser",25:"sco",26:"sco",9:"lr",15:"lm",21:"ll",7:"mr",13:"mm",19:"ml",5:"sr",11:"sm",17:"sl",18:"sl",12:"sm",6:"sr",20:"ml",14:"mm",8:"mr",22:"ll",16:"lm",10:"lr"},ForehandFA="forehand",ForehandBA="sideways",BackhandFA="anti-sideways",BackhandBA="backhand",ForehandFB="forehand",ForehandBB="sideways",BackhandFB="anti-sideways",BackhandBB="backhand",HitAreaNumber={1:BackhandBA,2:BackhandBB,3:ForehandFA,4:ForehandFB,5:ForehandFA,6:ForehandFB,7:BackhandBA,8:BackhandBB,9:BackhandFA,10:BackhandFB,11:ForehandBA,12:ForehandBB},PHASE={START:0,MIDDLE:1,END:2},StrikePositionLabel={1:"ser",2:"ser",3:"ser",4:"ser",5:"forehand",6:"forehand",7:"backhand",8:"backhand",9:"sideways",10:"sideways",11:"anti-sideways",12:"anti-sideways",13:"sco",14:"sco"},StrikeTechLabel={1:"ser",2:"ser",3:"loo",4:"loo",5:"qui",6:"qui",7:"sma",8:"sma",9:"fli",10:"fli",11:"cho",12:"cho",13:"dro",14:"dro",15:"blo",16:"blo",17:"cut",18:"cut",19:"par",20:"par",21:"lob",22:"lob",23:"oth",24:"oth",25:"sco",26:"sco"};angular.module(app.applicationModuleName).factory("Game",["Rally","Tactic","Strike",function(Rally,Strike,Tactic){var Game=function(){function Game(){_classCallCheck(this,Game),this.rallies=[]}return _createClass(Game,[{key:"add",value:function(rally){this.rallies.push(rally)}},{key:"gameNo",get:function(){return this.rallies.length?this.rallies[0].gameNo:void 0}},{key:"winner",get:function(){return this.rallies.length?this.rallies[this.rallies.length-1].winner:void 0}},{key:"score",get:function(){if(this.rallies.length)return this.rallies.map(function(d){var score=d.score;return score[d.winner]+=1,score})}},{key:"maxScore",get:function(){if(this.rallies){this.score;return this.score.reduce(function(a,b){return Math.max(a,Math.max(b.A,b.B))},0)}}},{key:"rallyLength",get:function(){if(this.rallies)return this.rallies.length}},{key:"maxDiff",get:function(){if(this.rallies)return this.rallies.map(function(d){return d.diff}).reduce(function(a,b){return Math.max(a,Math.abs(b))},0)}},{key:"diff",get:function(){if(this.rallies)return this.rallies.map(function(d){return d.diff})}},{key:"phase",get:function(){var segments=[],phases={};return this.rallies.forEach(function(d,i){void 0===d.phase||phases[d.phase]||(phases[d.phase]=1,segments.push(i))}),segments}}]),Game}();return Game}]).factory("Rally",["Strike","Tactic",function(Strike,Tactic){var Rally=function(){function Rally(){_classCallCheck(this,Rally),this.strikes=[],this.tactics=[]}return _createClass(Rally,[{key:"add",value:function(strike){this.strikes.push(strike)}},{key:"genTactics",value:function(){this.tactics=[],this.strikes.length>=3&&this.tactics.push(new Tactic(this.strikes.slice(0,3),!0)),this.strikes.length>=4&&this.tactics.push(new Tactic(this.strikes.slice(1,4),!1))}},{key:"strikeLength",get:function(){return this.strikes.length?this.strikes.length:void 0}},{key:"gameNo",get:function(){return this.strikes.length?this.strikes[0].gameNo:void 0}},{key:"rallyNo",get:function(){return this.strikes.length?this.strikes[0].rallyNo:void 0}},{key:"winner",get:function(){return this.strikes.length?this.strikes[this.strikes.length-1].winner:void 0}},{key:"score",get:function(){return this.strikes.length?this.strikes[0].score:void 0}},{key:"isFirst",get:function(){return 1===this.rallyNo}},{key:"diff",get:function(){var score=this.score,winner=this.winner;if(score&&winner)return score[winner]++,score.A-score.B}},{key:"phase",get:function(){var score=this.score,middlepoint=4,endpoint=9;if(score)return score.A===middlepoint-1&&score.B===middlepoint-1?PHASE.MIDDLE:score.A===endpoint-1&&score.B===endpoint-1?PHASE.END:score.A<middlepoint&&score.B<middlepoint?PHASE.START:score.A<endpoint&&score.B<endpoint?PHASE.MIDDLE:PHASE.END}},{key:"strikeEffects",get:function(){return["level 1","level 2","level 3","level 4","level 5"]}}]),Rally}();return Rally}]).factory("Tactic",["Strike",function(Strike){var Tactic=function(){function Tactic(strikes,serve){_classCallCheck(this,Tactic),this.strikes=strikes,this.serve=serve}return _createClass(Tactic,[{key:"vec",get:function(){var vector=[];return this.strikes.forEach(function(d){vector.push(d.strikeTech),vector.push(d.ballPosition)}),vector}}],[{key:"isEqual",value:function(a,b){if(a.serve!==b.serve)return!1;for(var i=0;i<a.strikes.length;i++){var sa=a.strikes[i],sb=b.strikes[i];if(sa.strikeTech!==sb.strikeTech)return!1;if(sa.ballPosition!==sb.ballPosition)return!1}return!0}},{key:"Dis",value:function(a,b){a instanceof Tactic&&(a=a.vec),b instanceof Tactic&&(b=b.vec);var dist=0;return a.forEach(function(d,i){if(i%2===0){if(StrikeTech[a[i]]!==StrikeTech[b[i]]&&StrikeTech_class[a[i]]!==StrikeTech_class[b[i]])return void(dist+=1/6);StrikeTech[a[i]]!==StrikeTech[b[i]]&&StrikeTech_class[a[i]]===StrikeTech_class[b[i]]&&(dist+=1/12)}else BallPosition[a[i]]!==BallPosition[b[i]]&&(dist+=1/6)}),dist}}]),Tactic}();return Tactic}]).factory("Strike",[function(){var Strike=function(){function Strike(strike){_classCallCheck(this,Strike),this.strike=strike,this.win=!1}return _createClass(Strike,[{key:"HitArea",value:function(hit){return HitAreaNumber[hit]}},{key:"Ball2Table",value:function(position){return position<=4?1===position?"ll":2===position?"ll":3===position?"lr":4===position?"lr":void 0:position>=23&&position<=24?void 0:position>=25?void 0:TableAreaNumber[position]}},{key:"BallPosition2Axis",value:function(position){return position>=23&&position<=24?void 0:TableAreaNumber[position]}},{key:"StrikePosition2Axis",value:function(strikePosition){return StrikePositionLabel[strikePosition]}},{key:"StrikeTech2Axis",value:function(strikeTech){return StrikeTechLabel[strikeTech]}},{key:"isForehand",value:function(hit){return[3,4,5,6,9,10].indexOf(hit)!==-1}},{key:"player",get:function(){return this.strike.BallPosition%2===1?"A":"B"}},{key:"playerName",get:function(){return this.strike.HitPlayer}},{key:"score",get:function(){return{A:this.strike.ScoreA1,B:this.strike.ScoreB1}}},{key:"gameNo",get:function(){return this.strike.GameNo}},{key:"rallyNo",get:function(){return this.strike.RallyNo}},{key:"strikeNo",get:function(){return this.strike.StrikeNo}},{key:"winner",get:function(){if(this.isScore)return 25===this.nextStrikeTech?"A":"B"}},{key:"strikeTech",get:function(){return this.strike.StrikeTech}},{key:"strikeTechName",get:function(){return StrikeTech[this.strike.StrikeTech]}},{key:"nextStrikeTechName",get:function(){return StrikeTech[this.strike.NextStrikeTech]}},{key:"strikeTechClass",get:function(){return StrikeTech_class[this.strike.GameAction]}},{key:"nextStrikeTech",get:function(){return this.strike.NextStrikeTech}},{key:"nextStrikeTechClass",get:function(){return StrikeTech_class[this.strike.NextGameAction]}},{key:"ballPosition",get:function(){return this.strike.BallPosition}},{key:"nextBallPosition",get:function(){return this.strike.NextBallPosition}},{key:"isServe",get:function(){return"发球"===this.strikeTechClass}},{key:"isScore",get:function(){return this.nextStrikeTech>=25||this.nextStrikeTech<=26}},{key:"isScore_",set:function(s){this.win=s},get:function(){return this.win}},{key:"spinKind",get:function(){var spinkind=void 0;try{this.strike.SpinKind>=1&&this.strike.SpinKind<=4&&(spinkind="上旋"),this.strike.SpinKind>=5&&this.strike.SpinKind<=6&&(spinkind="无旋转"),this.strike.SpinKind>=7&&this.strike.SpinKind<=10&&(spinkind="下旋")}catch(e){console.error("strike spinkind",e)}finally{return spinkind}}},{key:"strikePosition",get:function(){return this.strike.StrikePosition}},{key:"nextStrikePosition",get:function(){return this.strike.NextStrikePosition}},{key:"strikePositionName",get:function(){if(this.strike){var hit=this.strikePosition;return hit>=5&&hit<=6?"forehand":hit>=7&&hit<=8?"backhand":hit>=9&&hit<=10?"sideways":hit>=11&&hit<=12?"anti-sideways":void 0}}},{key:"strikeEffect",get:function(){var effect=this.strike.StrikeEffect;return 0===effect&&(effect=6),Math.ceil(effect/2)}}]),Strike}();return Strike}])}(ApplicationConfiguration);
"use strict";!function(){function templates($templateCache){$templateCache.put("modules/core/client/views/400.client.view.html",'<div class="page-header">\n  <h1>Bad Request</h1>\n</div>\n<div class="alert alert-danger" role="alert">\n  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>\n  <span class="sr-only">Error:</span>\n  <span ng-if="vm.errorMessage" ng-bind="vm.errorMessage"></span>\n  <span ng-if="!vm.errorMessage">You made a bad request</span>\n</div>\n'),$templateCache.put("modules/core/client/views/403.client.view.html",'<div class="page-header">\n  <h1>Forbidden</h1>\n</div>\n<div class="alert alert-danger" role="alert">\n  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>\n  <span class="sr-only">Error:</span>\n  You are not authorized to access this resource\n</div>\n'),$templateCache.put("modules/core/client/views/404.client.view.html",'<div class="page-header">\n  <h1>Page Not Found</h1>\n</div>\n<div class="alert alert-danger" role="alert">\n  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>\n  <span ng-if="vm.errorMessage" ng-bind="vm.errorMessage"></span>\n  <span ng-if="!vm.errorMessage">Page Not Found</span>\n</div>\n'),$templateCache.put("modules/core/client/views/header.client.view.html",'<div class="banner-icon">\n\t<div class="icon dropdown">\n\t\t<div class="dropdown-toggle" id="dropdownMenuLoad" data-toggle="dropdown" style="font-size: 1.6em;">\n\t\t  <span class="glyphicon glyphicon-folder-open"></span>\n\t\t  <span class="caret" style="margin-left: 20px;"></span>\n\t\t</div>\n\t\t<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownOptions">\n\t\t\t<li role="presentation">\n\t\t\t\t<button type="button" class="btn switchBtn" id="example1" ng-click="app.loadData(\'default\')">Example 1</button>\n\t\t\t</li>\n\t\t\t<li role="presentation">\n\t\t\t\t<button type="button" class="btn switchBtn" id="example2" ng-click="app.loadData(\'example2\')">Example 2</button>\n\t\t\t</li>\n\t\t\t<li role="presentation">\n\t\t\t\t<button type="button" class="btn switchBtn" id="example3" ng-click="app.loadData(\'example3\')">Example 3</button>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n\t\t<!-- <div id="load" file-model cb="app.load">\n\t\t  <span class="glyphicon glyphicon-folder-open"></span>\n\t\t  <input type="file"/>\n\t\t</div> -->\n\t<div class="label A">\n\t</div>\n\t<span>{{\'player1\'|T}}</span>\n\t<div class="label B">\n\t</div>\n\t<span>{{\'player2\'|T}}</span>\n</div>\n\n<div id="system-name">{{\'title\'|T}}</div>\n\n<div class="banner-lang">\n\t<div class="dropdown">\n\t\t<button type="button" class="btn switchBtn dropdown-toggle" id="dropdownMenuLang" data-toggle="dropdown">{{app.curLang}}\n\t\t\t<span class="caret"></span>\n\t\t</button>\n\t\t<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownOptions">\n\t\t\t<li role="presentation">\n\t\t\t\t<button type="button" class="btn switchBtn" id="en" ng-click=\'app.changeLang("en")\'>English</button>\n\t\t\t</li>\n\t\t\t<li role="presentation">\n\t\t\t\t<button type="button" class="btn switchBtn" id="cn" ng-click=\'app.changeLang("cn")\'>简体中文</button>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n</div>\n'),$templateCache.put("modules/core/client/views/home.client.view.html",'<section>\n    <div class="vis">\n        <div id="container1">\n            <div id="games-view" class="flex">\n                <div class="view flex-5" games-view\n                    games="app.data.games"\n                    rallies="app.data.rallies"\n                    cb="app.setRallies"\n                    rallycb="app.setRally"\n                    update="app.safeApply">\n                </div>\n                <div id="fView" class="select-view flex-1" filter-view\n                    games="app.data.games"\n                    rallies="app.data.rallies"\n                    cb="app.setRallies"\n                    rallycb="app.setRally">\n                    <!-- <svg style="height: 450px;position: absolute;top: 8px;" id="filterSvg">\n                    </svg>\n                    <ul style="position: absolute;top: 8px;">\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="sphase" />\n                            <span class="checkname">Start Phase</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="mphase" />\n                            <span class="checkname">Middle Phase</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="ephase" />\n                            <span class="checkname">End Phase</span>\n                        </li>\n\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="game1" />\n                            <span class="checkname">Game1</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="game2" />\n                            <span class="checkname">Game2</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="game3" />\n                            <span class="checkname">Game3</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="game4" />\n                            <span class="checkname">Game4</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="game5" />\n                            <span class="checkname">Game5</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="game6" />\n                            <span class="checkname">Game6</span>\n                        </li>\n\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="Awin"  />\n                            <span class="checkname">Wang wins</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="Bwin" />\n                            <span class="checkname">Wu wins</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="Aleads" />\n                            <span class="checkname">Wang at Advantage</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="Bleads" />\n                            <span class="checkname">Wu at Advantage</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="draw" />\n                            <span class="checkname">Draw</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="Aserve" />\n                            <span class="checkname">Wang serve</span>\n                        </li>\n                        <li class="flex">\n                            <input type="checkbox" class="checkbox" name="Bserve" />\n                            <span class="checkname">Wu server</span>\n                        </li>\n                    </ul> -->\n\n                </div>\n            </div>\n\n            <div id="container2">\n                <div id="statistic-view">\n                    <div class="view" id="statistic" statistic-view\n                         fstrikes="app.filteredStriks"\n                         changefstrikes="app.changeFilteredStrikes"\n                         strikes="app.data.wholestrikes"\n                         rally="app.data.rally"\n                         cb="app.selectArea"\n                         update="app.safeApply">\n                    </div>\n                </div>\n                <div id="container3">\n                    <div class="view" id="tactic" tactic-view\n                         fstrikes="app.filteredStrikes"\n                         strikes="app.data.wholestrikes"\n                         update="app.safeApply">\n                    </div>\n                    <div class="view" id="history" history-view\n                        history="app.history"\n                        savecb="app.saveStatus"\n                        deletecb="app.deleteStatus"\n                        recovercb="app.recoverStatus"\n                        update="app.safeApply">\n                    </div>\n                </div>\n                <div id="stroke-view" class="{{app.strokeViewClass}}">\n                    <div class="view-float" stroke-view\n                        rally="app.data.rally">\n                    </div>\n                </div>\n            </div>\n\n        </div>\n\n    </div>\n</section>\n')}angular.module("core").run(templates),templates.$inject=["$templateCache"]}();